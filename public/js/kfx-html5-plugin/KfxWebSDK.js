var compatibility=function(){"use strict";var e=0,t=!0,i=window.URL||window.webkitURL,a=function(t,i){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,i){var a=(new Date).getTime(),r=Math.max(0,16-(a-e)),n=window.setTimeout(function(){t(a+r)},r);return e=a+r,n};return a.call(window,t,i)},r=function(e){var t=window.cancelAnimationFrame||function(e){clearTimeout(e)};return t.call(window,e)},n=function(e,t,i){if(!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia){var a=window.navigator.getUserMedia||window.navigator.mozGetUserMedia||window.navigator.webkitGetUserMedia||window.navigator.msGetUserMedia||function(e,t,i){i()};return a.call(window.navigator,e,t,i)}window.navigator.mediaDevices.getUserMedia(e).then(function(e){t(e)})["catch"](function(e){i(e)})},o=function(){var e=new ArrayBuffer(8),i=new Uint32Array(e);return i[0]=4278190080,t=!0,255===e[0]&&(t=!1),t};return{URL:i,requestAnimationFrame:a,cancelAnimationFrame:r,getUserMedia:n,detectEndian:o,isLittleEndian:t}}();/*
The MIT License (MIT)

Copyright (c) 2008 Jacob Seidelin

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
(function(){"use strict";function e(e){return!!e.exifdata}function t(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),a=i.length,r=new ArrayBuffer(a),n=new Uint8Array(r),o=0;o<a;o++)n[o]=i.charCodeAt(o);return r}function i(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){200!=this.status&&0!==this.status||t(this.response)},i.send()}function a(e,a){function o(t){var i=r(t),o=n(t);e.exifdata=i||{},e.iptcdata=o||{},a&&a.call(e)}if(e.src)if(/^data\:/i.test(e.src)){var s=t(e.src);o(s)}else if(/^blob\:/i.test(e.src)){var l=new FileReader;l.onload=function(e){o(e.target.result)},i(e.src,function(e){l.readAsArrayBuffer(e)})}else{var u=new XMLHttpRequest;u.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";o(u.response),u=null},u.open("GET",e.src,!0),u.responseType="arraybuffer",u.send(null)}else if(window.FileReader&&(e instanceof window.Blob||e instanceof window.File)){var l=new FileReader;l.onload=function(e){f&&console.log("Got file of length "+e.target.result.byteLength),o(e.target.result)},l.readAsArrayBuffer(e)}}function r(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var i,a=2,r=e.byteLength;a<r;){if(255!=t.getUint8(a))return f&&console.log("Not a valid marker at offset "+a+", found: "+t.getUint8(a)),!1;if(i=t.getUint8(a+1),f&&console.log(i),225==i)return f&&console.log("Found 0xFFE1 marker"),c(t,a+4,t.getUint16(a+2)-2);a+=2+t.getUint16(a+2)}}function n(e){var t=new DataView(e);if(f&&console.log("Got file of length "+e.byteLength),255!=t.getUint8(0)||216!=t.getUint8(1))return f&&console.log("Not a valid JPEG"),!1;for(var i=2,a=e.byteLength,r=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};i<a;){if(r(t,i)){var n=t.getUint8(i+7);n%2!==0&&(n+=1),0===n&&(n=4);var s=i+8+n,l=t.getUint16(i+6+n);return o(e,s,l)}i++}}function o(e,t,i){for(var a,r,n,o,s,l=new DataView(e),c={},f=t;f<t+i;)28===l.getUint8(f)&&2===l.getUint8(f+1)&&(o=l.getUint8(f+2),o in S&&(n=l.getInt16(f+3),s=n+5,r=S[o],a=u(l,f+5,n),c.hasOwnProperty(r)?c[r]instanceof Array?c[r].push(a):c[r]=[c[r],a]:c[r]=a)),f++;return c}function s(e,t,i,a,r){var n,o,s,u=e.getUint16(i,!r),c={};for(s=0;s<u;s++)n=i+12*s+2,o=a[e.getUint16(n,!r)],!o&&f&&console.log("Unknown tag: "+e.getUint16(n,!r)),c[o]=l(e,n,t,i,r);return c}function l(e,t,i,a,r){var n,o,s,l,c,f,h=e.getUint16(t+2,!r),d=e.getUint32(t+4,!r),p=e.getUint32(t+8,!r)+i;switch(h){case 1:case 7:if(1==d)return e.getUint8(t+8,!r);for(n=d>4?p:t+8,o=[],l=0;l<d;l++)o[l]=e.getUint8(n+l);return o;case 2:return n=d>4?p:t+8,u(e,n,d-1);case 3:if(1==d)return e.getUint16(t+8,!r);for(n=d>2?p:t+8,o=[],l=0;l<d;l++)o[l]=e.getUint16(n+2*l,!r);return o;case 4:if(1==d)return e.getUint32(t+8,!r);for(o=[],l=0;l<d;l++)o[l]=e.getUint32(p+4*l,!r);return o;case 5:if(1==d)return c=e.getUint32(p,!r),f=e.getUint32(p+4,!r),s=new Number(c/f),s.numerator=c,s.denominator=f,s;for(o=[],l=0;l<d;l++)c=e.getUint32(p+8*l,!r),f=e.getUint32(p+4+8*l,!r),o[l]=new Number(c/f),o[l].numerator=c,o[l].denominator=f;return o;case 9:if(1==d)return e.getInt32(t+8,!r);for(o=[],l=0;l<d;l++)o[l]=e.getInt32(p+4*l,!r);return o;case 10:if(1==d)return e.getInt32(p,!r)/e.getInt32(p+4,!r);for(o=[],l=0;l<d;l++)o[l]=e.getInt32(p+8*l,!r)/e.getInt32(p+4+8*l,!r);return o}}function u(e,t,i){var a="";for(d=t;d<t+i;d++)a+=String.fromCharCode(e.getUint8(d));return a}function c(e,t){if("Exif"!=u(e,t,4))return f&&console.log("Not valid EXIF data! "+u(e,t,4)),!1;var i,a,r,n,o,l=t+6;if(18761==e.getUint16(l))i=!1;else{if(19789!=e.getUint16(l))return f&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;i=!0}if(42!=e.getUint16(l+2,!i))return f&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var c=e.getUint32(l+4,!i);if(c<8)return f&&console.log("Not valid TIFF data! (First offset less than 8)",e.getUint32(l+4,!i)),!1;if(a=s(e,l,l+c,g,i),a.ExifIFDPointer){n=s(e,l,l+a.ExifIFDPointer,m,i);for(r in n){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":n[r]=y[r][n[r]];break;case"ExifVersion":case"FlashpixVersion":n[r]=String.fromCharCode(n[r][0],n[r][1],n[r][2],n[r][3]);break;case"ComponentsConfiguration":n[r]=y.Components[n[r][0]]+y.Components[n[r][1]]+y.Components[n[r][2]]+y.Components[n[r][3]]}a[r]=n[r]}}if(a.GPSInfoIFDPointer){o=s(e,l,l+a.GPSInfoIFDPointer,v,i);for(r in o){switch(r){case"GPSVersionID":o[r]=o[r][0]+"."+o[r][1]+"."+o[r][2]+"."+o[r][3]}a[r]=o[r]}}return a}var f=!1,h=this,d=0,p=function(e){return e instanceof p?e:this instanceof p?void(this.EXIFwrapped=e):new p(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports.EXIF=p):h.EXIF=p;var m=p.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},g=p.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},v=p.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},y=p.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},S={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};p.getData=function(t,i){return!((t instanceof Image||t instanceof HTMLImageElement)&&!t.complete)&&(e(t)?i&&i.call(t):a(t,i),!0)},p.getTag=function(t,i){if(e(t))return t.exifdata[i]},p.getAllTags=function(t){if(!e(t))return{};var i,a=t.exifdata,r={};for(i in a)a.hasOwnProperty(i)&&(r[i]=a[i]);return r},p.pretty=function(t){if(!e(t))return"";var i,a=t.exifdata,r="";for(i in a)a.hasOwnProperty(i)&&(r+="object"==typeof a[i]?a[i]instanceof Number?i+" : "+a[i]+" ["+a[i].numerator+"/"+a[i].denominator+"]\r\n":i+" : ["+a[i].length+" values]\r\n":i+" : "+a[i]+"\r\n");return r},p.readFromBinaryFile=function(e){return r(e)},"function"==typeof define&&define.amd?define("exif-js",[],function(){return p}):"undefined"!=typeof exports?exports.EXIF=p:window.EXIF=p}).call(this);/*
The MIT License

Copyright (c) 2012 Eugene Zatepyakin

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
var jsfeat=jsfeat||{REVISION:"ALPHA"};!function(e){"use strict";var t=1.192092896e-7,i=1e-37,a=256,r=512,n=1024,o=2048,s=4096,l=1,u=2,c=3,f=4,h=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),d=function(){return function(e){return 65280&e}}(),p=function(){return function(e){return 255&e}}(),m=function(){return function(e){return h[(65280&e)>>8]}}(),g=0,v=1,y=2,S=3,w=1,b=1,P=2,_=function(){function e(e,t){this.size=(e+7|0)&-8,"undefined"==typeof t?this.buffer=new ArrayBuffer(this.size):(this.buffer=t,this.size=t.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return e}(),T=function(){function e(e,t,i,o){this.type=0|d(i),this.channel=0|p(i),this.cols=0|e,this.rows=0|t,"undefined"==typeof o?this.allocate():(this.buffer=o,this.data=this.type&a?this.buffer.u8:this.type&r?this.buffer.i32:this.type&n?this.buffer.f32:this.buffer.f64)}return e.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new _(this.cols*m(this.type)*this.channel*this.rows),this.data=this.type&a?this.buffer.u8:this.type&r?this.buffer.i32:this.type&n?this.buffer.f32:this.buffer.f64},e.prototype.copy_to=function(e){for(var t=e.data,i=this.data,a=0,r=this.cols*this.rows*this.channel|0;a<r-4;a+=4)t[a]=i[a],t[a+1]=i[a+1],t[a+2]=i[a+2],t[a+3]=i[a+3];for(;a<r;++a)t[a]=i[a]},e.prototype.resize=function(e,t,i){"undefined"==typeof i&&(i=this.channel);var a=e*m(this.type)*i*t;a>this.buffer.size?(this.cols=e,this.rows=t,this.channel=i,this.allocate()):(this.cols=e,this.rows=t,this.channel=i)},e}(),I=function(){function e(e){this.levels=0|e,this.data=new Array(e),this.pyrdown=jsfeat.imgproc.pyrdown}return e.prototype.allocate=function(e,t,i){for(var a=this.levels;--a>=0;)this.data[a]=new T(e>>a,t>>a,i)},e.prototype.build=function(e,t){"undefined"==typeof t&&(t=!0);var i=2,a=e,r=this.data[0];if(!t)for(var n=e.cols*e.rows;--n>=0;)r.data[n]=e.data[n];for(r=this.data[1],this.pyrdown(a,r);i<this.levels;++i)a=r,r=this.data[i],this.pyrdown(a,r)},e}(),C=function(){function e(e,t,i,a,r){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=0),"undefined"==typeof i&&(i=0),"undefined"==typeof a&&(a=0),"undefined"==typeof r&&(r=-1),this.x=e,this.y=t,this.score=i,this.level=a,this.angle=r}return e}();e.U8_t=a,e.S32_t=r,e.F32_t=n,e.S64_t=o,e.F64_t=s,e.C1_t=l,e.C2_t=u,e.C3_t=c,e.C4_t=f,e.U8C1_t=a|l,e.U8C3_t=a|c,e.U8C4_t=a|f,e.F32C1_t=n|l,e.F32C2_t=n|u,e.S32C1_t=r|l,e.S32C2_t=r|u,e.EPSILON=t,e.FLT_MIN=i,e.COLOR_RGBA2GRAY=g,e.COLOR_RGB2GRAY=v,e.COLOR_BGRA2GRAY=y,e.COLOR_BGR2GRAY=S,e.BOX_BLUR_NOSCALE=w,e.SVD_U_T=b,e.SVD_V_T=P,e.get_data_type=d,e.get_channel=p,e.get_data_type_size=m,e.data_t=_,e.matrix_t=T,e.pyramid_t=I,e.keypoint_t=C}(jsfeat),function(e){var t=function(){var e,t,i=function(){function e(e){this.next=null,this.data=new jsfeat.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return e.prototype.resize=function(e){delete this.data,this.data=new jsfeat.data_t(e),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},e}(),a=0;return{allocate:function(r,n){e=t=new i(n);for(var o=0;o<r;++o){var s=new i(n);t=t.next=s,a++}},get_buffer:function(t){var i=e;return e=e.next,a--,t>i.size&&i.resize(t),i},put_buffer:function(e){t=t.next=e,a++}}}();e.cache=t,t.allocate(30,2560)}(jsfeat),function(e){var t=function(){var e=new Int32Array(96);return{get_gaussian_kernel:function(e,t,i,a){var r=0,n=0,o=0,s=0,l=0,u=0,c=jsfeat.cache.get_buffer(e<<2),f=c.f32;if(1==(1&e)&&e<=7&&t<=0)switch(e>>1){case 0:f[0]=1,u=1;break;case 1:f[0]=.25,f[1]=.5,f[2]=.25,u=1;break;case 2:f[0]=.0625,f[1]=.25,f[2]=.375,f[3]=.25,f[4]=.0625,u=1;break;case 3:f[0]=.03125,f[1]=.109375,f[2]=.21875,f[3]=.28125,f[4]=.21875,f[5]=.109375,f[6]=.03125,u=1}else for(s=t>0?t:.3*(.5*(e-1)-1)+.8,l=-.5/(s*s);r<e;++r)n=r-.5*(e-1),o=Math.exp(l*n*n),f[r]=o,u+=o;if(a&jsfeat.U8_t)for(u=256/u,r=0;r<e;++r)i[r]=f[r]*u+.5|0;else for(u=1/u,r=0;r<e;++r)i[r]=f[r]*u;jsfeat.cache.put_buffer(c)},perspective_4point_transform:function(e,t,i,a,r,n,o,s,l,u,c,f,h,d,p,m,g){var v=t,y=u,S=o,w=v*y*S,b=p,P=v*b,_=y*P,T=c,I=v*T,C=n,A=i,x=d,E=A*x,D=E*C,R=x*C*T,M=x*S,L=x*T,O=y*S,k=b*y,j=b*C,U=T*C,F=1/(M-L-O+k-j+U),N=v*x,G=A*C,B=S*v,V=b*B,H=A*y,W=E*T,z=A*T*C,K=S*b*y,q=b*A,X=-(_-w+I*C-C*P-E*y+D-R+M*y)*F,Y=(w-_-N*S+N*T+D-y*G+j*y-R)*F,Z=v,J=(-T*P+V+H*S-E*S+W-z+j*T-K)*F,Q=(-V+B*T-q*y+W-z+q*C+K-M*T)*F,$=A,ee=(-I+B+H-G+L-M-k+j)*F,te=(-P+I+E-H+j-U-M+O)*F;v=a,y=f,S=l,w=v*y*S,b=g,P=v*b,_=y*P,T=h,I=v*T,C=s,A=r,x=m,E=A*x,D=E*C,R=x*C*T,M=x*S,L=x*T,O=y*S,k=b*y,j=b*C,U=T*C,F=1/(M-L-O+k-j+U),N=v*x,G=A*C,B=S*v,V=b*B,H=A*y,W=E*T,z=A*T*C,K=S*b*y,q=b*A;var ie=-(_-w+I*C-C*P-E*y+D-R+M*y)*F,ae=(w-_-N*S+N*T+D-y*G+j*y-R)*F,re=v,ne=(-T*P+V+H*S-E*S+W-z+j*T-K)*F,oe=(-V+B*T-q*y+W-z+q*C+K-M*T)*F,se=A,le=(-I+B+H-G+L-M-k+j)*F,ue=(-P+I+E-H+j-U-M+O)*F;y=Q-te*$,S=X*Q,w=X*$,P=J*Y,_=Z*J,I=Y*ee;var ce=Z*ee;x=1/(S-w*te-P+_*te+I*$-ce*Q),D=-J+$*ee;var fe=-J*te+Q*ee;U=-Y+Z*te;var he=X-ce;G=X*te-I,B=-Y*$+Z*Q;var de=w-_,pe=S-P;z=y*x;var me=U*x,ge=B*x,ve=e.data;ve[0]=ie*z+ae*(D*x)-re*(fe*x),ve[1]=ie*me+ae*(he*x)-re*(G*x),ve[2]=-ie*ge-ae*(de*x)+re*(pe*x),ve[3]=ne*z+oe*(D*x)-se*(fe*x),ve[4]=ne*me+oe*(he*x)-se*(G*x),ve[5]=-ne*ge-oe*(de*x)+se*(pe*x),ve[6]=le*z+ue*(D*x)-fe*x,ve[7]=le*me+ue*(he*x)-G*x,ve[8]=-le*ge-ue*(de*x)+pe*x},qsort:function(t,i,a,r){var n,o,s,l,u=7,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=e;if(!(a-i+1<=1))for(x[0]=i,x[1]=a;c>=0;)for(f=x[c<<1],h=x[(c<<1)+1],c--;;){if(p=h-f+1,p<=u){for(g=f+1;g<=h;g++)for(v=g;v>f&&r(t[v],t[v-1]);v--)n=t[v],t[v]=t[v-1],t[v-1]=n;break}for(A=0,S=f,b=h,_=f+(p>>1),p>40&&(y=p>>3,T=f,I=f+y,C=f+(y<<1),o=t[T],s=t[I],l=t[C],f=r(o,s)?r(s,l)?I:r(o,l)?C:T:r(l,s)?I:r(o,l)?T:C,T=_-y,I=_,C=_+y,o=t[T],s=t[I],l=t[C],_=r(o,s)?r(s,l)?I:r(o,l)?C:T:r(l,s)?I:r(o,l)?T:C,T=h-(y<<1),I=h-y,C=h,o=t[T],s=t[I],l=t[C],h=r(o,s)?r(s,l)?I:r(o,l)?C:T:r(l,s)?I:r(o,l)?T:C),T=f,I=_,C=h,o=t[T],s=t[I],l=t[C],_=r(o,s)?r(s,l)?I:r(o,l)?C:T:r(l,s)?I:r(o,l)?T:C,_!=S&&(n=t[_],t[_]=t[S],t[S]=n,_=S),f=w=S+1,h=P=b,o=t[_];;){for(;f<=h&&!r(o,t[f]);)r(t[f],o)||(f>w&&(n=t[w],t[w]=t[f],t[f]=n),A=1,w++),f++;for(;f<=h&&!r(t[h],o);)r(o,t[h])||(h<P&&(n=t[P],t[P]=t[h],t[h]=n),A=1,P--),h--;if(f>h)break;n=t[f],t[f]=t[h],t[h]=n,A=1,f++,h--}if(0==A){for(f=S,h=b,g=f+1;g<=h;g++)for(v=g;v>f&&r(t[v],t[v-1]);v--)n=t[v],t[v]=t[v-1],t[v-1]=n;break}for(p=Math.min(w-S,f-w),m=f-p|0,d=0;d<p;++d,++m)n=t[S+d],t[S+d]=t[m],t[m]=n;for(p=Math.min(b-P,P-h),m=b-p+1|0,d=0;d<p;++d,++m)n=t[f+d],t[f+d]=t[m],t[m]=n;if(p=f-w,m=P-h,p>1)m>1?p>m?(++c,x[c<<1]=S,x[(c<<1)+1]=S+p-1,f=b-m+1,h=b):(++c,x[c<<1]=b-m+1,x[(c<<1)+1]=b,f=S,h=S+p-1):(f=S,h=S+p-1);else{if(!(m>1))break;f=b-m+1,h=b}}},median:function(e,t,i){for(var a,r=0,n=0,o=0,s=t+i>>1;;){if(i<=t)return e[s];if(i==t+1)return e[t]>e[i]&&(a=e[t],e[t]=e[i],e[i]=a),e[s];for(r=t+i>>1,e[r]>e[i]&&(a=e[r],e[r]=e[i],e[i]=a),e[t]>e[i]&&(a=e[t],e[t]=e[i],e[i]=a),e[r]>e[t]&&(a=e[r],e[r]=e[t],e[t]=a),n=t+1,a=e[r],e[r]=e[n],e[n]=a,o=i;;){do++n;while(e[t]>e[n]);do--o;while(e[o]>e[t]);if(o<n)break;a=e[n],e[n]=e[o],e[o]=a}a=e[t],e[t]=e[o],e[o]=a,o<=s?t=n:o>=s&&(i=o-1)}}}}();e.math=t}(jsfeat),function(e){var t=function(){return{identity:function(e,t){"undefined"==typeof t&&(t=1);for(var i=e.data,a=e.rows,r=e.cols,n=r+1|0,o=a*r,s=o;--o>=0;)i[o]=0;for(o=s,s=0;s<o;)i[s]=t,s+=n},transpose:function(e,t){for(var i=0,a=0,r=t.rows,n=t.cols,o=0,s=0,l=0,u=t.data,c=e.data;i<r;s+=1,o+=n,i++)for(l=s,a=0;a<n;l+=r,a++)c[l]=u[o+a]},multiply:function(e,t,i){for(var a=0,r=0,n=0,o=0,s=0,l=0,u=0,c=0,f=t.cols,h=t.rows,d=i.cols,p=t.data,m=i.data,g=e.data,v=0;a<h;o+=f,a++)for(u=0,r=0;r<d;c++,u++,r++){for(l=u,s=o,v=0,n=0;n<f;s++,l+=d,n++)v+=p[s]*m[l];g[c]=v}},multiply_ABt:function(e,t,i){for(var a=0,r=0,n=0,o=0,s=0,l=0,u=0,c=t.cols,f=t.rows,h=i.rows,d=t.data,p=i.data,m=e.data,g=0;a<f;o+=c,a++)for(l=0,r=0;r<h;u++,r++){for(s=o,g=0,n=0;n<c;s++,l++,n++)g+=d[s]*p[l];m[u]=g}},multiply_AtB:function(e,t,i){for(var a=0,r=0,n=0,o=0,s=0,l=0,u=0,c=0,f=t.cols,h=t.rows,d=i.cols,p=t.data,m=i.data,g=e.data,v=0;a<f;o++,a++)for(u=0,r=0;r<d;c++,u++,r++){for(l=u,s=o,v=0,n=0;n<h;s+=f,l+=d,n++)v+=p[s]*m[l];g[c]=v}},multiply_AAt:function(e,t){for(var i=0,a=0,r=0,n=0,o=0,s=0,l=0,u=0,c=0,f=t.cols,h=t.rows,d=t.data,p=e.data,m=0;i<h;n+=h+1,o=s,i++)for(u=n,c=n,l=o,a=i;a<h;u++,c+=h,a++){for(s=o,m=0,r=0;r<f;r++)m+=d[s++]*d[l++];p[u]=m,p[c]=m}},multiply_AtA:function(e,t){for(var i=0,a=0,r=0,n=0,o=0,s=0,l=0,u=0,c=0,f=t.cols,h=t.rows,d=t.data,p=e.data,m=0;i<f;l+=f,i++)for(n=i,c=l+i,u=c,a=i;a<f;u++,c+=f,a++){for(o=n,s=a,m=0,r=0;r<h;o+=f,s+=f,r++)m+=d[o]*d[s];p[u]=m,p[c]=m}},identity_3x3:function(e,t){"undefined"==typeof t&&(t=1);var i=e.data;i[0]=i[4]=i[8]=t,i[1]=i[2]=i[3]=0,i[5]=i[6]=i[7]=0},invert_3x3:function(e,t){var i=e.data,a=t.data,r=i[4],n=i[8],o=i[5],s=i[7],l=i[0],u=l*r,c=l*o,f=i[3],h=i[1],d=f*h,p=i[2],m=f*p,g=i[6],v=g*h,y=g*p,S=1/(u*n-c*s-d*n+m*s+v*o-y*r);a[0]=(r*n-o*s)*S,a[1]=-(h*n-p*s)*S,a[2]=-(-h*o+p*r)*S,a[3]=-(f*n-o*g)*S,a[4]=(l*n-y)*S,a[5]=-(c-m)*S,a[6]=-(-f*s+r*g)*S,a[7]=-(l*s-v)*S,a[8]=(u-d)*S},multiply_3x3:function(e,t,i){var a=e.data,r=t.data,n=i.data,o=r[0],s=r[1],l=r[2],u=r[3],c=r[4],f=r[5],h=r[6],d=r[7],p=r[8],m=n[0],g=n[1],v=n[2],y=n[3],S=n[4],w=n[5],b=n[6],P=n[7],_=n[8];a[0]=o*m+s*y+l*b,a[1]=o*g+s*S+l*P,a[2]=o*v+s*w+l*_,a[3]=u*m+c*y+f*b,a[4]=u*g+c*S+f*P,a[5]=u*v+c*w+f*_,a[6]=h*m+d*y+p*b,a[7]=h*g+d*S+p*P,a[8]=h*v+d*w+p*_},mat3x3_determinant:function(e){var t=e.data;return t[0]*t[4]*t[8]-t[0]*t[5]*t[7]-t[3]*t[1]*t[8]+t[3]*t[2]*t[7]+t[6]*t[1]*t[5]-t[6]*t[2]*t[4]},determinant_3x3:function(e,t,i,a,r,n,o,s,l){return e*r*l-e*n*s-a*t*l+a*i*s+o*t*n-o*i*r}}}();e.matmath=t}(jsfeat),function(e){var t=function(){var e=function(e,t,i,a){a=e[t],e[t]=e[i],e[i]=a},t=function(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0},i=function(i,a,r,n,o,s){var l=jsfeat.EPSILON,u=0,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=s*s*30,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=jsfeat.cache.get_buffer(s<<2),E=jsfeat.cache.get_buffer(s<<2),D=x.i32,R=E.i32;if(n)for(;u<s;u++){for(f=u*o,c=0;c<s;c++)n[f+c]=0;n[f+u]=1}for(f=0;f<s;f++){if(r[f]=i[(a+1)*f],f<s-1){for(h=f+1,S=Math.abs(i[a*f+h]),u=f+2;u<s;u++)w=Math.abs(i[a*f+u]),S<w&&(S=w,h=u);D[f]=h}if(f>0){for(h=0,S=Math.abs(i[f]),u=1;u<f;u++)w=Math.abs(i[a*u+f]),S<w&&(S=w,h=u);R[f]=h}}if(s>1)for(;v<y;v++){for(f=0,S=Math.abs(i[D[0]]),u=1;u<s-1;u++)w=Math.abs(i[a*u+D[u]]),S<w&&(S=w,f=u);for(d=D[f],u=1;u<s;u++)w=Math.abs(i[a*R[u]+u]),S<w&&(S=w,f=R[u],d=u);if(b=i[a*f+d],Math.abs(b)<=l)break;for(P=.5*(r[d]-r[f]),_=Math.abs(P)+t(b,P),T=t(b,_),I=_/T,T=b/T,_=b/_*b,P<0&&(T=-T,_=-_),i[a*f+d]=0,r[f]-=_,r[d]+=_,u=0;u<f;u++)m=a*u+f,g=a*u+d,C=i[m],A=i[g],i[m]=C*I-A*T,i[g]=C*T+A*I;for(u=f+1;u<d;u++)m=a*f+u,g=a*u+d,C=i[m],A=i[g],i[m]=C*I-A*T,i[g]=C*T+A*I;for(u=d+1,m=a*f+u,g=a*d+u;u<s;u++,m++,g++)C=i[m],A=i[g],i[m]=C*I-A*T,i[g]=C*T+A*I;if(n)for(m=o*f,g=o*d,u=0;u<s;u++,m++,g++)C=n[m],A=n[g],n[m]=C*I-A*T,n[g]=C*T+A*I;for(c=0;c<2;c++){if(p=0==c?f:d,p<s-1){for(h=p+1,S=Math.abs(i[a*p+h]),u=p+2;u<s;u++)w=Math.abs(i[a*p+u]),S<w&&(S=w,h=u);D[p]=h}if(p>0){for(h=0,S=Math.abs(i[p]),u=1;u<p;u++)w=Math.abs(i[a*u+p]),S<w&&(S=w,h=u);R[p]=h}}}for(f=0;f<s-1;f++){for(h=f,u=f+1;u<s;u++)r[h]<r[u]&&(h=u);if(f!=h&&(e(r,h,f,S),n))for(u=0;u<s;u++)e(n,o*h+u,o*f+u,S)}jsfeat.cache.put_buffer(x),jsfeat.cache.put_buffer(E)},a=function(i,a,r,n,o,s,l,u){for(var c=2*jsfeat.EPSILON,f=jsfeat.FLT_MIN,h=0,d=0,p=0,m=0,g=Math.max(s,30),v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=0,E=0,D=0,R=0,M=0,L=0,O=4660,k=0,j=0,U=0,F=jsfeat.cache.get_buffer(l<<3),N=F.f64;h<l;h++){for(p=0,A=0;p<s;p++)T=i[h*a+p],A+=T*T;if(N[h]=A,n){for(p=0;p<l;p++)n[h*o+p]=0;n[h*o+h]=1}}for(;m<g;m++){for(b=0,h=0;h<l-1;h++)for(d=h+1;d<l;d++){for(v=h*a|0,y=d*a|0,R=N[h],M=0,L=N[d],p=2,M+=i[v]*i[y],M+=i[v+1]*i[y+1];p<s;p++)M+=i[v+p]*i[y+p];if(!(Math.abs(M)<=c*Math.sqrt(R*L))){for(M*=2,x=R-L,E=t(M,x),x<0?(D=.5*(E-x),_=Math.sqrt(D/E),P=M/(E*_*2)):(P=Math.sqrt((E+x)/(2*E)),_=M/(E*P*2)),R=0,L=0,p=2,I=P*i[v]+_*i[y],C=-_*i[v]+P*i[y],i[v]=I,i[y]=C,R+=I*I,L+=C*C,I=P*i[v+1]+_*i[y+1],C=-_*i[v+1]+P*i[y+1],i[v+1]=I,i[y+1]=C,R+=I*I,L+=C*C;p<s;p++)I=P*i[v+p]+_*i[y+p],C=-_*i[v+p]+P*i[y+p],i[v+p]=I,i[y+p]=C,R+=I*I,L+=C*C;if(N[h]=R,N[d]=L,b=1,n)for(S=h*o|0,w=d*o|0,p=2,I=P*n[S]+_*n[w],C=-_*n[S]+P*n[w],n[S]=I,n[w]=C,I=P*n[S+1]+_*n[w+1],C=-_*n[S+1]+P*n[w+1],n[S+1]=I,n[w+1]=C;p<l;p++)I=P*n[S+p]+_*n[w+p],C=-_*n[S+p]+P*n[w+p],n[S+p]=I,n[w+p]=C}}if(0==b)break}for(h=0;h<l;h++){for(p=0,A=0;p<s;p++)T=i[h*a+p],A+=T*T;N[h]=Math.sqrt(A)}for(h=0;h<l-1;h++){for(d=h,p=h+1;p<l;p++)N[d]<N[p]&&(d=p);if(h!=d&&(e(N,h,d,A),n)){for(p=0;p<s;p++)e(i,h*a+p,d*a+p,T);for(p=0;p<l;p++)e(n,h*o+p,d*o+p,T)}}for(h=0;h<l;h++)r[h]=N[h];if(!n)return void jsfeat.cache.put_buffer(F);for(h=0;h<u;h++){for(A=h<l?N[h]:0;A<=f;){for(j=1/s,p=0;p<s;p++)O=214013*O+2531011,k=0!=(O>>16&32767&256)?j:-j,i[h*a+p]=k;for(m=0;m<2;m++)for(d=0;d<h;d++){for(A=0,p=0;p<s;p++)A+=i[h*a+p]*i[d*a+p];for(U=0,p=0;p<s;p++)T=i[h*a+p]-A*i[d*a+p],i[h*a+p]=T,U+=Math.abs(T);for(U=U?1/U:0,p=0;p<s;p++)i[h*a+p]*=U}for(A=0,p=0;p<s;p++)T=i[h*a+p],A+=T*T;A=Math.sqrt(A)}for(_=1/A,p=0;p<s;p++)i[h*a+p]*=_}jsfeat.cache.put_buffer(F)};return{lu_solve:function(t,i){var a,r,n,o,s=0,l=0,u=0,c=1,f=t.cols,h=t.data,d=i.data;for(s=0;s<f;s++){for(u=s,l=s+1;l<f;l++)Math.abs(h[l*f+s])>Math.abs(h[u*f+s])&&(u=l);if(Math.abs(h[u*f+s])<jsfeat.EPSILON)return 0;if(u!=s){for(l=s;l<f;l++)e(h,s*f+l,u*f+l,a);e(d,s,u,a),c=-c}for(n=-1/h[s*f+s],l=s+1;l<f;l++){for(r=h[l*f+s]*n,u=s+1;u<f;u++)h[l*f+u]+=r*h[s*f+u];d[l]+=r*d[s]}h[s*f+s]=-n}for(s=f-1;s>=0;s--){for(o=d[s],u=s+1;u<f;u++)o-=h[s*f+u]*d[u];d[s]=o*h[s*f+s]}return 1},cholesky_solve:function(e,t){var i,a,r=0,n=0,o=0,s=0,l=0,u=0,c=0,f=e.cols,h=e.data,d=t.data;for(r=0;r<f;r++)for(a=1,s=r*f,l=s,n=r;n<f;n++){for(i=h[l+r],o=0;o<r;o++)i-=h[o*f+r]*h[l+o];if(n==r){if(h[l+r]=i,0==i)return 0;a=1/i}else h[s+n]=i,h[l+r]=i*a;l+=f}for(s=0,u=0;u<f;u++){for(i=d[u],c=0;c<u;c++)i-=h[s+c]*d[c];d[u]=i,s+=f}for(s=0,u=0;u<f;u++)d[u]/=h[s+u],s+=f;for(u=f-1;u>=0;u--){for(i=d[u],c=u+1,s=c*f;c<f;c++)i-=h[s+u]*d[c],s+=f;d[u]=i}return 1},svd_decompose:function(e,t,i,r,n){"undefined"==typeof n&&(n=0);var o=0,s=0,l=e.rows,u=e.cols,c=l,f=u,h=e.type|jsfeat.C1_t;c<f&&(o=1,s=c,c=f,f=s);var d=jsfeat.cache.get_buffer(c*c<<3),p=jsfeat.cache.get_buffer(f<<3),m=jsfeat.cache.get_buffer(f*f<<3),g=new jsfeat.matrix_t(c,c,h,d.data),v=new jsfeat.matrix_t(1,f,h,p.data),y=new jsfeat.matrix_t(f,f,h,m.data);if(0==o)jsfeat.matmath.transpose(g,e);else{for(s=0;s<u*l;s++)g.data[s]=e.data[s];for(;s<f*c;s++)g.data[s]=0}if(a(g.data,c,v.data,y.data,f,c,f,c),t){for(s=0;s<f;s++)t.data[s]=v.data[s];for(;s<u;s++)t.data[s]=0}if(0==o){if(i&&n&jsfeat.SVD_U_T)for(s=c*c;--s>=0;)i.data[s]=g.data[s];else i&&jsfeat.matmath.transpose(i,g);if(r&&n&jsfeat.SVD_V_T)for(s=f*f;--s>=0;)r.data[s]=y.data[s];else r&&jsfeat.matmath.transpose(r,y)}else{if(i&&n&jsfeat.SVD_U_T)for(s=f*f;--s>=0;)i.data[s]=y.data[s];else i&&jsfeat.matmath.transpose(i,y);if(r&&n&jsfeat.SVD_V_T)for(s=c*c;--s>=0;)r.data[s]=g.data[s];else r&&jsfeat.matmath.transpose(r,g)}jsfeat.cache.put_buffer(d),jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m)},svd_solve:function(e,t,i){var a=0,r=0,n=0,o=0,s=0,l=e.rows,u=e.cols,c=0,f=0,h=0,d=e.type|jsfeat.C1_t,p=jsfeat.cache.get_buffer(l*l<<3),m=jsfeat.cache.get_buffer(u<<3),g=jsfeat.cache.get_buffer(u*u<<3),v=new jsfeat.matrix_t(l,l,d,p.data),y=new jsfeat.matrix_t(1,u,d,m.data),S=new jsfeat.matrix_t(u,u,d,g.data),w=i.data,b=v.data,P=y.data,_=S.data;for(this.svd_decompose(e,y,v,S,0),h=jsfeat.EPSILON*P[0]*u;a<u;a++,s+=u){for(f=0,r=0;r<u;r++)if(P[r]>h){for(n=0,c=0,o=0;n<l;n++,o+=u)c+=b[o+r]*w[n];f+=c*_[s+r]/P[r]}t.data[a]=f}jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(g)},svd_invert:function(e,t){var i=0,a=0,r=0,n=0,o=0,s=0,l=t.rows,u=t.cols,c=0,f=0,h=t.type|jsfeat.C1_t,d=jsfeat.cache.get_buffer(l*l<<3),p=jsfeat.cache.get_buffer(u<<3),m=jsfeat.cache.get_buffer(u*u<<3),g=new jsfeat.matrix_t(l,l,h,d.data),v=new jsfeat.matrix_t(1,u,h,p.data),y=new jsfeat.matrix_t(u,u,h,m.data),S=e.data,w=g.data,b=v.data,P=y.data;for(this.svd_decompose(t,v,g,y,0),f=jsfeat.EPSILON*b[0]*u;i<u;i++,o+=u)for(a=0,n=0;a<l;a++,s++){for(r=0,c=0;r<u;r++,n++)b[r]>f&&(c+=P[o+r]*w[n]/b[r]);S[s]=c}jsfeat.cache.put_buffer(d),jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m)},eigenVV:function(e,t,a){for(var r=e.cols,n=r*r,o=e.type|jsfeat.C1_t,s=jsfeat.cache.get_buffer(r*r<<3),l=jsfeat.cache.get_buffer(r<<3),u=new jsfeat.matrix_t(r,r,o,s.data),c=new jsfeat.matrix_t(1,r,o,l.data);--n>=0;)u.data[n]=e.data[n];if(i(u.data,r,c.data,t?t.data:null,r,r),a)for(;--r>=0;)a.data[r]=c.data[r];jsfeat.cache.put_buffer(s),jsfeat.cache.put_buffer(l)}}}();e.linalg=t}(jsfeat),function(e){var t=function(){var e=function(e){return e*e},t=function(e,t,i,a,r){for(var n=0,o=0,s=0,l=0,u=0,c=0,f=0,h=0,d=0,p=0,m=0;n<r;++n)o+=e[n].x,s+=e[n].y,c+=t[n].x,f+=t[n].y;for(o/=r,s/=r,c/=r,f/=r,n=0;n<r;++n)p=e[n].x-o,m=e[n].y-s,l+=Math.sqrt(p*p+m*m),p=t[n].x-c,m=t[n].y-f,h+=Math.sqrt(p*p+m*m);l/=r,h/=r,u=Math.SQRT2/l,d=Math.SQRT2/h,i[0]=i[4]=u,i[2]=-o*u,i[5]=-s*u,i[1]=i[3]=i[6]=i[7]=0,i[8]=1,a[0]=a[4]=d,a[2]=-c*d,a[5]=-f*d,a[1]=a[3]=a[6]=a[7]=0,a[8]=1},i=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),a=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),r=new jsfeat.matrix_t(6,6,jsfeat.F32_t|jsfeat.C1_t),n=new jsfeat.matrix_t(6,1,jsfeat.F32_t|jsfeat.C1_t),o=function(){function o(){}return o.prototype.run=function(e,o,s,l){var u,c,f=0,h=0,d=s.type|jsfeat.C1_t,p=s.data,m=i.data,g=a.data,v=0,y=0;t(e,o,m,g,l);for(var S=jsfeat.cache.get_buffer(2*l*6<<3),w=jsfeat.cache.get_buffer(2*l<<3),b=new jsfeat.matrix_t(6,2*l,d,S.data),P=new jsfeat.matrix_t(1,2*l,d,w.data),_=b.data,T=P.data;f<l;++f)u=e[f],c=o[f],v=m[0]*u.x+m[1]*u.y+m[2],y=m[3]*u.x+m[4]*u.y+m[5],h=2*f*6,_[h]=v,_[h+1]=y,_[h+2]=1,_[h+3]=0,_[h+4]=0,_[h+5]=0,h+=6,_[h]=0,_[h+1]=0,_[h+2]=0,_[h+3]=v,_[h+4]=y,_[h+5]=1,T[f<<1]=g[0]*c.x+g[1]*c.y+g[2],T[(f<<1)+1]=g[3]*c.x+g[4]*c.y+g[5];return jsfeat.matmath.multiply_AtA(r,b),jsfeat.matmath.multiply_AtB(n,b,P),jsfeat.linalg.lu_solve(r,n),p[0]=n.data[0],p[1]=n.data[1],p[2]=n.data[2],p[3]=n.data[3],p[4]=n.data[4],p[5]=n.data[5],p[6]=0,p[7]=0,p[8]=1,jsfeat.matmath.invert_3x3(a,a),jsfeat.matmath.multiply_3x3(s,a,s),jsfeat.matmath.multiply_3x3(s,s,i),jsfeat.cache.put_buffer(S),jsfeat.cache.put_buffer(w),1},o.prototype.error=function(t,i,a,r,n){for(var o,s,l=0,u=a.data;l<n;++l)o=t[l],s=i[l],r[l]=e(s.x-u[0]*o.x-u[1]*o.y-u[2])+e(s.y-u[3]*o.x-u[4]*o.y-u[5])},o.prototype.check_subset=function(e,t,i){return!0},o}(),s=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),l=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),u=function(){function e(){}return e.prototype.run=function(e,t,r,n){for(var o=0,u=0,c=r.data,f=i.data,h=a.data,d=s.data,p=l.data,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0;o<n;++o)b+=t[o].x,P+=t[o].y,I+=e[o].x,C+=e[o].y;for(b/=n,P/=n,I/=n,C/=n,o=0;o<n;++o)S+=Math.abs(t[o].x-b),w+=Math.abs(t[o].y-P),_+=Math.abs(e[o].x-I),T+=Math.abs(e[o].y-C);if(Math.abs(S)<jsfeat.EPSILON||Math.abs(w)<jsfeat.EPSILON||Math.abs(_)<jsfeat.EPSILON||Math.abs(T)<jsfeat.EPSILON)return 0;for(S=n/S,w=n/w,_=n/_,T=n/T,f[0]=_,f[1]=0,f[2]=-I*_,f[3]=0,f[4]=T,f[5]=-C*T,f[6]=0,f[7]=0,f[8]=1,h[0]=1/S,h[1]=0,h[2]=b,h[3]=0,h[4]=1/w,h[5]=P,h[6]=0,h[7]=0,h[8]=1,o=81;--o>=0;)d[o]=0;for(o=0;o<n;++o)m=(t[o].x-b)*S,g=(t[o].y-P)*w,v=(e[o].x-I)*_,y=(e[o].y-C)*T,d[0]+=v*v,d[1]+=v*y,d[2]+=v,d[6]+=v*-m*v,d[7]+=v*-m*y,d[8]+=v*-m,d[10]+=y*y,d[11]+=y,d[15]+=y*-m*v,d[16]+=y*-m*y,d[17]+=y*-m,d[20]+=1,d[24]+=-m*v,d[25]+=-m*y,d[26]+=-m,d[30]+=v*v,d[31]+=v*y,d[32]+=v,d[33]+=v*-g*v,d[34]+=v*-g*y,d[35]+=v*-g,d[40]+=y*y,d[41]+=y,d[42]+=y*-g*v,d[43]+=y*-g*y,d[44]+=y*-g,d[50]+=1,d[51]+=-g*v,d[52]+=-g*y,d[53]+=-g,d[60]+=-m*v*-m*v+-g*v*-g*v,d[61]+=-m*v*-m*y+-g*v*-g*y,d[62]+=-m*v*-m+-g*v*-g,d[70]+=-m*y*-m*y+-g*y*-g*y,d[71]+=-m*y*-m+-g*y*-g,d[80]+=-m*-m+-g*-g;for(o=0;o<9;++o)for(u=0;u<o;++u)d[9*o+u]=d[9*u+o];return jsfeat.linalg.eigenVV(s,l),c[0]=p[72],c[1]=p[73],c[2]=p[74],c[3]=p[75],c[4]=p[76],c[5]=p[77],c[6]=p[78],c[7]=p[79],c[8]=p[80],jsfeat.matmath.multiply_3x3(r,a,r),jsfeat.matmath.multiply_3x3(r,r,i),m=1/c[8],c[0]*=m,c[1]*=m,c[2]*=m,c[3]*=m,c[4]*=m,c[5]*=m,c[6]*=m,c[7]*=m,c[8]=1,1},e.prototype.error=function(e,t,i,a,r){for(var n,o,s=0,l=0,u=0,c=0,f=i.data;s<r;++s)n=e[s],o=t[s],l=1/(f[6]*n.x+f[7]*n.y+1),u=(f[0]*n.x+f[1]*n.y+f[2])*l-o.x,c=(f[3]*n.x+f[4]*n.y+f[5])*l-o.y,a[s]=u*u+c*c},e.prototype.check_subset=function(e,t,i){if(4==i){var a=0,r=e[0],n=e[1],o=e[2],s=e[3],l=t[0],u=t[1],c=t[2],f=t[3],h=r.x,d=r.y,p=1,m=n.x,g=n.y,v=1,y=o.x,S=o.y,w=1,b=l.x,P=l.y,_=1,T=u.x,I=u.y,C=1,A=c.x,x=c.y,E=1,D=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,y,S,w),R=jsfeat.matmath.determinant_3x3(b,P,_,T,I,C,A,x,E);if(D*R<0&&a++,h=n.x,d=n.y,m=o.x,g=o.y,y=s.x,S=s.y,b=u.x,P=u.y,T=c.x,I=c.y,A=f.x,x=f.y,D=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,y,S,w),R=jsfeat.matmath.determinant_3x3(b,P,_,T,I,C,A,x,E),D*R<0&&a++,h=r.x,d=r.y,m=o.x,g=o.y,y=s.x,S=s.y,b=l.x,P=l.y,T=c.x,I=c.y,A=f.x,x=f.y,D=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,y,S,w),R=jsfeat.matmath.determinant_3x3(b,P,_,T,I,C,A,x,E),D*R<0&&a++,h=r.x,d=r.y,m=n.x,g=n.y,y=s.x,S=s.y,b=l.x,P=l.y,T=u.x,I=u.y,A=f.x,x=f.y,D=jsfeat.matmath.determinant_3x3(h,d,p,m,g,v,y,S,w),R=jsfeat.matmath.determinant_3x3(b,P,_,T,I,C,A,x,E),D*R<0&&a++,0!=a&&4!=a)return!1}return!0},e}();return{affine2d:o,homography2d:u}}(),i=function(){function e(e,t,i,a){"undefined"==typeof e&&(e=0),"undefined"==typeof t&&(t=.5),"undefined"==typeof i&&(i=.5),"undefined"==typeof a&&(a=.99),this.size=e,this.thresh=t,this.eps=i,this.prob=a}return e.prototype.update_iters=function(e,t){var i=Math.log(1-this.prob),a=Math.log(1-Math.pow(1-e,this.size));return 0|(a>=0||-i>=t*-a?t:Math.round(i/a))},e}(),a=function(){var e=function(e,t,i,a,r,n,o){for(var s=1e3,l=[],u=0,c=0,f=0,h=0,d=!1;f<s;++f){for(u=0;u<a&&f<s;){for(d=!1,h=0;!d;)for(d=!0,h=l[u]=0|Math.floor(Math.random()*r),c=0;c<u;++c)if(h==l[c]){d=!1;break}n[u]=t[h],o[u]=i[h],e.check_subset(n,o,u+1)?++u:f++}break}return u==a&&f<s},t=function(e,t,i,a,r,n,o,s){var l=0,u=0,c=0,f=n*n;for(e.error(i,a,t,o,r);u<r;++u)c=o[u]<=f,s[u]=c,l+=c;return l};return{ransac:function(i,a,r,n,o,s,l,u){if("undefined"==typeof u&&(u=1e3),o<i.size)return!1;var c=i.size,f=u,h=0,d=!1,p=[],m=[],g=!1,v=s.cols,y=s.rows,S=s.type|jsfeat.C1_t,w=jsfeat.cache.get_buffer(v*y<<3),b=jsfeat.cache.get_buffer(o),P=jsfeat.cache.get_buffer(o<<2),_=new jsfeat.matrix_t(v,y,S,w.data),T=new jsfeat.matrix_t(o,1,jsfeat.U8C1_t,b.data),I=-1,C=0,A=0,x=P.f32;if(o==c){if(a.run(r,n,_,o)<=0)return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!1;if(_.copy_to(s),l)for(;--o>=0;)l.data[o]=1;return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!0}for(;h<f;++h){if(g=e(a,r,n,c,o,p,m),!g){if(0==h)return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!1;break}A=a.run(p,m,_,c),A<=0||(C=t(a,_,r,n,o,i.thresh,x,T.data),C>Math.max(I,c-1)&&(_.copy_to(s),I=C,l&&T.copy_to(l),f=i.update_iters((o-C)/o,f),d=!0))}return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),d},lmeds:function(i,a,r,n,o,s,l,u){if("undefined"==typeof u&&(u=1e3),o<i.size)return!1;var c=i.size,f=u,h=0,d=!1,p=[],m=[],g=!1,v=s.cols,y=s.rows,S=s.type|jsfeat.C1_t,w=jsfeat.cache.get_buffer(v*y<<3),b=jsfeat.cache.get_buffer(o),P=jsfeat.cache.get_buffer(o<<2),_=new jsfeat.matrix_t(v,y,S,w.data),T=new jsfeat.matrix_t(o,1,jsfeat.U8_t|jsfeat.C1_t,b.data),I=0,C=0,A=P.f32,x=1e9,E=0,D=0;if(i.eps=.45,f=i.update_iters(i.eps,f),o==c){if(a.run(r,n,_,o)<=0)return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!1;if(_.copy_to(s),l)for(;--o>=0;)l.data[o]=1;return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!0}for(;h<f;++h){if(g=e(a,r,n,c,o,p,m),!g){if(0==h)return jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),!1;break}C=a.run(p,m,_,c),C<=0||(a.error(r,n,_,A,o),D=jsfeat.math.median(A,0,o-1),D<x&&(x=D,_.copy_to(s),d=!0))}return d&&(E=2.5*1.4826*(1+5/(o-c))*Math.sqrt(x),E=Math.max(E,.001),I=t(a,s,r,n,o,E,A,T.data),l&&T.copy_to(l),d=I>=c),jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),d}}}();e.ransac_params_t=i,e.motion_model=t,e.motion_estimator=a}(jsfeat),function(e){var t=function(){var e=function(e,t,i,a){for(var r=0,n=e.channel,o=e.cols,s=e.rows,l=e.data,u=t.data,c=o/i,f=s/a,h=c*f*65536|0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=0,E=jsfeat.cache.get_buffer(i*n<<2),D=jsfeat.cache.get_buffer(i*n<<2),R=jsfeat.cache.get_buffer(2*o*3<<2),M=E.i32,L=D.i32,O=R.i32;d<i;d++){for(b=d*c,P=b+c,v=b+1-1e-6|0,y=0|P,v=Math.min(v,o-1),y=Math.min(y,o-1),v>b&&(O[w++]=d*n|0,O[w++]=(v-1)*n|0,O[w++]=256*(v-b)|0,r++),m=v;m<y;m++)r++,O[w++]=d*n|0,O[w++]=m*n|0,O[w++]=256;P-y>.001&&(r++,O[w++]=d*n|0,O[w++]=y*n|0,O[w++]=256*(P-y)|0)}for(d=0;d<i*n;d++)M[d]=L[d]=0;for(p=0,g=0;g<s;g++){for(_=o*g,w=0;w<r;w++)for(I=O[3*w],v=O[3*w+1],C=O[3*w+2],S=0;S<n;S++)M[I+S]+=l[_+v+S]*C;if((p+1)*f<=g+1||g==s-1){if(A=256*Math.max(g+1-(p+1)*f,0)|0,x=256-A,T=i*p,A<=0)for(d=0;d<i*n;d++)u[T+d]=Math.min(Math.max((L[d]+256*M[d])/h,0),255),L[d]=M[d]=0;else for(d=0;d<i*n;d++)u[T+d]=Math.min(Math.max((L[d]+M[d]*x)/h,0),255),L[d]=M[d]*A,M[d]=0;p++}else for(d=0;d<i*n;d++)L[d]+=256*M[d],M[d]=0}jsfeat.cache.put_buffer(D),jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(R)},t=function(e,t,i,a){for(var r=0,n=e.channel,o=e.cols,s=e.rows,l=e.data,u=t.data,c=o/i,f=s/a,h=1/(c*f),d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=0,E=jsfeat.cache.get_buffer(i*n<<2),D=jsfeat.cache.get_buffer(i*n<<2),R=jsfeat.cache.get_buffer(2*o*3<<2),M=E.f32,L=D.f32,O=R.f32;d<i;d++){for(b=d*c,P=b+c,v=b+1-1e-6|0,y=0|P,v=Math.min(v,o-1),y=Math.min(y,o-1),v>b&&(r++,O[w++]=(v-1)*n|0,O[w++]=d*n|0,O[w++]=(v-b)*h),m=v;m<y;m++)r++,O[w++]=m*n|0,O[w++]=d*n|0,O[w++]=h;P-y>.001&&(r++,O[w++]=y*n|0,O[w++]=d*n|0,O[w++]=(P-y)*h)}for(d=0;d<i*n;d++)M[d]=L[d]=0;for(p=0,g=0;g<s;g++){for(_=o*g,w=0;w<r;w++)for(v=0|O[3*w],I=0|O[3*w+1],C=O[3*w+2],S=0;S<n;S++)M[I+S]+=l[_+v+S]*C;if((p+1)*f<=g+1||g==s-1){if(A=Math.max(g+1-(p+1)*f,0),x=1-A,T=i*p,Math.abs(A)<.001)for(d=0;d<i*n;d++)u[T+d]=L[d]+M[d],L[d]=M[d]=0;else for(d=0;d<i*n;d++)u[T+d]=L[d]+M[d]*x,L[d]=M[d]*A,M[d]=0;p++}else for(d=0;d<i*n;d++)L[d]+=M[d],M[d]=0}jsfeat.cache.put_buffer(D),jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(R)},i=function(e,t,i,a,r,n,o,s){for(var l=0,u=0,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=n[0],y=0,S=a<<1,w=3*a,b=a<<2;l<r;++l){for(d=t[f],u=0;u<s;++u)e[u]=d;for(u=0;u<=a-2;u+=2)e[u+s]=t[f+u],e[u+s+1]=t[f+u+1];for(;u<a;++u)e[u+s]=t[f+u];for(d=t[f+a-1],u=a;u<s+a;++u)e[u+s]=d;for(u=0;u<=a-4;u+=4){for(d=e[u]*v,p=e[u+1]*v,m=e[u+2]*v,g=e[u+3]*v,c=1;c<o;++c)y=n[c],d+=e[c+u]*y,p+=e[c+u+1]*y,m+=e[c+u+2]*y,g+=e[c+u+3]*y;i[h+u]=Math.min(d>>8,255),i[h+u+1]=Math.min(p>>8,255),i[h+u+2]=Math.min(m>>8,255),i[h+u+3]=Math.min(g>>8,255)}for(;u<a;++u){for(d=e[u]*v,c=1;c<o;++c)d+=e[c+u]*n[c];i[h+u]=Math.min(d>>8,255)}f+=a,h+=a}for(l=0;l<a;++l){for(d=i[l],u=0;u<s;++u)e[u]=d;for(c=l,u=0;u<=r-2;u+=2,c+=S)e[u+s]=i[c],e[u+s+1]=i[c+a];for(;u<r;++u,c+=a)e[u+s]=i[c];for(d=i[(r-1)*a+l],u=r;u<s+r;++u)e[u+s]=d;for(h=l,u=0;u<=r-4;u+=4,h+=b){for(d=e[u]*v,p=e[u+1]*v,m=e[u+2]*v,g=e[u+3]*v,c=1;c<o;++c)y=n[c],d+=e[c+u]*y,p+=e[c+u+1]*y,m+=e[c+u+2]*y,g+=e[c+u+3]*y;i[h]=Math.min(d>>8,255),i[h+a]=Math.min(p>>8,255),i[h+S]=Math.min(m>>8,255),i[h+w]=Math.min(g>>8,255)}for(;u<r;++u,h+=a){for(d=e[u]*v,c=1;c<o;++c)d+=e[c+u]*n[c];i[h]=Math.min(d>>8,255)}}},a=function(e,t,i,a,r,n,o,s){for(var l=0,u=0,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=n[0],y=0,S=a<<1,w=3*a,b=a<<2;l<r;++l){for(d=t[f],u=0;u<s;++u)e[u]=d;for(u=0;u<=a-2;u+=2)e[u+s]=t[f+u],e[u+s+1]=t[f+u+1];for(;u<a;++u)e[u+s]=t[f+u];for(d=t[f+a-1],u=a;u<s+a;++u)e[u+s]=d;for(u=0;u<=a-4;u+=4){for(d=e[u]*v,p=e[u+1]*v,m=e[u+2]*v,g=e[u+3]*v,c=1;c<o;++c)y=n[c],d+=e[c+u]*y,p+=e[c+u+1]*y,m+=e[c+u+2]*y,g+=e[c+u+3]*y;i[h+u]=d,i[h+u+1]=p,i[h+u+2]=m,i[h+u+3]=g}for(;u<a;++u){for(d=e[u]*v,c=1;c<o;++c)d+=e[c+u]*n[c];i[h+u]=d}f+=a,h+=a}for(l=0;l<a;++l){for(d=i[l],u=0;u<s;++u)e[u]=d;for(c=l,u=0;u<=r-2;u+=2,c+=S)e[u+s]=i[c],e[u+s+1]=i[c+a];for(;u<r;++u,c+=a)e[u+s]=i[c];for(d=i[(r-1)*a+l],u=r;u<s+r;++u)e[u+s]=d;for(h=l,u=0;u<=r-4;u+=4,h+=b){for(d=e[u]*v,p=e[u+1]*v,m=e[u+2]*v,g=e[u+3]*v,c=1;c<o;++c)y=n[c],d+=e[c+u]*y,p+=e[c+u+1]*y,m+=e[c+u+2]*y,g+=e[c+u+3]*y;i[h]=d,i[h+a]=p,i[h+S]=m,i[h+w]=g}for(;u<r;++u,h+=a){for(d=e[u]*v,c=1;c<o;++c)d+=e[c+u]*n[c];i[h]=d}}};return{grayscale:function(e,t,i,a,r){"undefined"==typeof r&&(r=jsfeat.COLOR_RGBA2GRAY);var n=0,o=0,s=0,l=0,u=0,c=0,f=4899,h=9617,d=1868,p=4;r!=jsfeat.COLOR_BGRA2GRAY&&r!=jsfeat.COLOR_BGR2GRAY||(f=1868,d=4899),r!=jsfeat.COLOR_RGB2GRAY&&r!=jsfeat.COLOR_BGR2GRAY||(p=3);var m=p<<1,g=3*p|0;a.resize(t,i,1);var v=a.data;for(o=0;o<i;++o,l+=t,s+=t*p){for(n=0,u=s,c=l;n<=t-4;n+=4,u+=p<<2,c+=4)v[c]=e[u]*f+e[u+1]*h+e[u+2]*d+8192>>14,v[c+1]=e[u+p]*f+e[u+p+1]*h+e[u+p+2]*d+8192>>14,v[c+2]=e[u+m]*f+e[u+m+1]*h+e[u+m+2]*d+8192>>14,v[c+3]=e[u+g]*f+e[u+g+1]*h+e[u+g+2]*d+8192>>14;for(;n<t;++n,++c,u+=p)v[c]=e[u]*f+e[u+1]*h+e[u+2]*d+8192>>14}},resample:function(i,a,r,n){var o=i.rows,s=i.cols;o>n&&s>r&&(a.resize(r,n,i.channel),i.type&jsfeat.U8_t&&a.type&jsfeat.U8_t&&o*s/(n*r)<256?e(i,a,r,n):t(i,a,r,n))},box_blur_gray:function(e,t,i,a){"undefined"==typeof a&&(a=0);var r=e.cols,n=e.rows,o=n<<1,s=r<<1,l=0,u=0,c=0,f=0,h=(i<<1)+1|0,d=i+1|0,p=d+1|0,m=a&jsfeat.BOX_BLUR_NOSCALE?1:1/(h*h),g=jsfeat.cache.get_buffer(r*n<<2),v=0,y=0,S=0,w=0,b=0,P=g.i32,_=e.data,T=0;for(t.resize(r,n,e.channel),c=0;c<n;++c){for(y=c,v=d*_[S],l=S+1|0,f=S+i|0;l<=f;++l)v+=_[l];for(w=S+d|0,b=S,T=_[b],u=0;u<i;++u,y+=n)P[y]=v,v+=_[w]-T,w++;for(;u<r-p;u+=2,y+=o)P[y]=v,v+=_[w]-_[b],P[y+n]=v,v+=_[w+1]-_[b+1],w+=2,b+=2;for(;u<r-d;++u,y+=n)P[y]=v,v+=_[w]-_[b],w++,b++;for(T=_[w-1];u<r;++u,y+=n)P[y]=v,v+=T-_[b],b++;S+=r}if(S=0,_=t.data,1==m)for(c=0;c<r;++c){for(y=c,v=d*P[S],l=S+1|0,f=S+i|0;l<=f;++l)v+=P[l];for(w=S+d,b=S,T=P[b],u=0;u<i;++u,y+=r)_[y]=v,v+=P[w]-T,w++;for(;u<n-p;u+=2,y+=s)_[y]=v,v+=P[w]-P[b],_[y+r]=v,v+=P[w+1]-P[b+1],w+=2,b+=2;for(;u<n-d;++u,y+=r)_[y]=v,v+=P[w]-P[b],w++,b++;for(T=P[w-1];u<n;++u,y+=r)_[y]=v,v+=T-P[b],b++;S+=n}else for(c=0;c<r;++c){for(y=c,v=d*P[S],l=S+1|0,f=S+i|0;l<=f;++l)v+=P[l];for(w=S+d,b=S,T=P[b],u=0;u<i;++u,y+=r)_[y]=v*m,v+=P[w]-T,w++;for(;u<n-p;u+=2,y+=s)_[y]=v*m,v+=P[w]-P[b],_[y+r]=v*m,v+=P[w+1]-P[b+1],w+=2,b+=2;for(;u<n-d;++u,y+=r)_[y]=v*m,v+=P[w]-P[b],w++,b++;for(T=P[w-1];u<n;++u,y+=r)_[y]=v*m,v+=T-P[b],b++;S+=n}jsfeat.cache.put_buffer(g)},gaussian_blur:function(e,t,r,n){"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0),r=0==r?2*Math.max(1,4*n+1-1e-8)+1|0:r;var o=r>>1,s=e.cols,l=e.rows,u=e.type,c=u&jsfeat.U8_t;t.resize(s,l,e.channel);var f,h,d=e.data,p=t.data,m=r+Math.max(l,s)|0,g=jsfeat.cache.get_buffer(m<<2),v=jsfeat.cache.get_buffer(r<<2);c?(f=g.i32,h=v.i32):u&jsfeat.S32_t?(f=g.i32,h=v.f32):(f=g.f32,h=v.f32),jsfeat.math.get_gaussian_kernel(r,n,h,u),c?i(f,d,p,s,l,h,r,o):a(f,d,p,s,l,h,r,o),jsfeat.cache.put_buffer(g),jsfeat.cache.put_buffer(v)},pyrdown:function(e,t,i,a){"undefined"==typeof i&&(i=0),"undefined"==typeof a&&(a=0);var r=e.cols,n=e.rows,o=r>>1,s=n>>1,l=o-(i<<1),u=s-(a<<1),c=0,f=0,h=i+a*r,d=0,p=0,m=0;t.resize(o,s,e.channel);var g=e.data,v=t.data;for(f=0;f<u;++f){for(d=h,m=p,c=0;c<=l-2;c+=2,m+=2,d+=4)v[m]=g[d]+g[d+1]+g[d+r]+g[d+r+1]+2>>2,v[m+1]=g[d+2]+g[d+3]+g[d+r+2]+g[d+r+3]+2>>2;for(;c<l;++c,++m,d+=2)v[m]=g[d]+g[d+1]+g[d+r]+g[d+r+1]+2>>2;h+=r<<1,p+=o}},scharr_derivatives:function(e,t){var i,a,r,n,o,s,l,u,c=e.cols,f=e.rows,h=c<<1,d=0,p=0,m=0,g=0,v=0,y=0,S=0;t.resize(c,f,2);var w=e.data,b=t.data,P=jsfeat.cache.get_buffer(c+2<<2),_=jsfeat.cache.get_buffer(c+2<<2);for(e.type&jsfeat.U8_t||e.type&jsfeat.S32_t?(l=P.i32,u=_.i32):(l=P.f32,u=_.f32);p<f;++p,v+=c){for(g=(p>0?p-1:1)*c|0,y=(p<f-1?p+1:f-2)*c|0,S=p*h|0,d=0,m=1;d<=c-2;d+=2,
m+=2)i=w[g+d],a=w[y+d],l[m]=3*(i+a)+10*w[v+d],u[m]=a-i,i=w[g+d+1],a=w[y+d+1],l[m+1]=3*(i+a)+10*w[v+d+1],u[m+1]=a-i;for(;d<c;++d,++m)i=w[g+d],a=w[y+d],l[m]=3*(i+a)+10*w[v+d],u[m]=a-i;for(d=c+1|0,l[0]=l[1],l[d]=l[c],u[0]=u[1],u[d]=u[c],d=0;d<=c-4;d+=4)i=u[d+2],a=u[d+1],r=u[d+3],n=u[d+4],o=l[d+2],s=l[d+3],b[S++]=o-l[d],b[S++]=3*(i+u[d])+10*a,b[S++]=s-l[d+1],b[S++]=3*(r+a)+10*i,b[S++]=l[d+4]-o,b[S++]=3*(n+i)+10*r,b[S++]=l[d+5]-s,b[S++]=3*(u[d+5]+r)+10*n;for(;d<c;++d)b[S++]=l[d+2]-l[d],b[S++]=3*(u[d+2]+u[d])+10*u[d+1]}jsfeat.cache.put_buffer(P),jsfeat.cache.put_buffer(_)},sobel_derivatives:function(e,t){var i,a,r,n,o,s,l,u,c=e.cols,f=e.rows,h=c<<1,d=0,p=0,m=0,g=0,v=0,y=0,S=0;t.resize(c,f,2);var w=e.data,b=t.data,P=jsfeat.cache.get_buffer(c+2<<2),_=jsfeat.cache.get_buffer(c+2<<2);for(e.type&jsfeat.U8_t||e.type&jsfeat.S32_t?(l=P.i32,u=_.i32):(l=P.f32,u=_.f32);p<f;++p,v+=c){for(g=(p>0?p-1:1)*c|0,y=(p<f-1?p+1:f-2)*c|0,S=p*h|0,d=0,m=1;d<=c-2;d+=2,m+=2)i=w[g+d],a=w[y+d],l[m]=i+a+2*w[v+d],u[m]=a-i,i=w[g+d+1],a=w[y+d+1],l[m+1]=i+a+2*w[v+d+1],u[m+1]=a-i;for(;d<c;++d,++m)i=w[g+d],a=w[y+d],l[m]=i+a+2*w[v+d],u[m]=a-i;for(d=c+1|0,l[0]=l[1],l[d]=l[c],u[0]=u[1],u[d]=u[c],d=0;d<=c-4;d+=4)i=u[d+2],a=u[d+1],r=u[d+3],n=u[d+4],o=l[d+2],s=l[d+3],b[S++]=o-l[d],b[S++]=i+u[d]+2*a,b[S++]=s-l[d+1],b[S++]=r+a+2*i,b[S++]=l[d+4]-o,b[S++]=n+i+2*r,b[S++]=l[d+5]-s,b[S++]=u[d+5]+r+2*n;for(;d<c;++d)b[S++]=l[d+2]-l[d],b[S++]=u[d+2]+u[d]+2*u[d+1]}jsfeat.cache.put_buffer(P),jsfeat.cache.put_buffer(_)},compute_integral_image:function(e,t,i,a){var r=0|e.cols,n=0|e.rows,o=e.data,s=r+1|0,l=0,u=0,c=0,f=0,h=0,d=0,p=0,m=0;if(t&&i){for(;h<s;++h)t[h]=0,i[h]=0;for(c=s+1|0,f=1,h=0,m=0;h<n;++h,++c,++f){for(l=u=0,d=0;d<=r-2;d+=2,m+=2,c+=2,f+=2)p=o[m],l+=p,u+=p*p,t[c]=t[f]+l,i[c]=i[f]+u,p=o[m+1],l+=p,u+=p*p,t[c+1]=t[f+1]+l,i[c+1]=i[f+1]+u;for(;d<r;++d,++m,++c,++f)p=o[m],l+=p,u+=p*p,t[c]=t[f]+l,i[c]=i[f]+u}}else if(t){for(;h<s;++h)t[h]=0;for(c=s+1|0,f=1,h=0,m=0;h<n;++h,++c,++f){for(l=0,d=0;d<=r-2;d+=2,m+=2,c+=2,f+=2)l+=o[m],t[c]=t[f]+l,l+=o[m+1],t[c+1]=t[f+1]+l;for(;d<r;++d,++m,++c,++f)l+=o[m],t[c]=t[f]+l}}else if(i){for(;h<s;++h)i[h]=0;for(c=s+1|0,f=1,h=0,m=0;h<n;++h,++c,++f){for(u=0,d=0;d<=r-2;d+=2,m+=2,c+=2,f+=2)p=o[m],u+=p*p,i[c]=i[f]+u,p=o[m+1],u+=p*p,i[c+1]=i[f+1]+u;for(;d<r;++d,++m,++c,++f)p=o[m],u+=p*p,i[c]=i[f]+u}}if(a){for(h=0;h<s;++h)a[h]=0;for(c=s+1|0,f=0,h=0,m=0;h<n;++h,++c,++f){for(d=0;d<=r-2;d+=2,m+=2,c+=2,f+=2)a[c]=o[m]+a[f],a[c+1]=o[m+1]+a[f+1];for(;d<r;++d,++m,++c,++f)a[c]=o[m]+a[f]}for(c=s+r|0,f=r,h=0;h<n;++h,c+=s,f+=s)a[c]+=a[f];for(d=r-1;d>0;--d)for(c=d+n*s,f=c-s,h=n;h>0;--h,c-=s,f-=s)a[c]+=a[f]+a[f+1]}},equalize_histogram:function(e,t){var i=e.cols,a=e.rows,r=e.data;t.resize(i,a,e.channel);var n,o,s=t.data,l=i*a,u=0,c=0,f=jsfeat.cache.get_buffer(1024);for(n=f.i32;u<256;++u)n[u]=0;for(u=0;u<l;++u)++n[r[u]];for(c=n[0],u=1;u<256;++u)c=n[u]+=c;for(o=255/l,u=0;u<l;++u)s[u]=n[r[u]]*o+.5|0;jsfeat.cache.put_buffer(f)},canny:function(e,t,i,a){var r=e.cols,n=e.rows;e.data;t.resize(r,n,e.channel);var o=t.data,s=0,l=0,u=0,c=r<<1,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,S=jsfeat.cache.get_buffer(n*c<<2),w=jsfeat.cache.get_buffer(3*(r+2)<<2),b=jsfeat.cache.get_buffer((n+2)*(r+2)<<2),P=jsfeat.cache.get_buffer(n*r<<2),_=w.i32,T=b.i32,I=P.i32,C=S.i32,A=new jsfeat.matrix_t(r,n,jsfeat.S32C2_t,S.data),x=1,E=r+2+1|0,D=2*(r+2)+1|0,R=r+2|0,M=R+1|0,L=0;for(this.sobel_derivatives(e,A),i>a&&(s=i,i=a,a=s),s=3*(r+2)|0;--s>=0;)_[s]=0;for(s=(n+2)*(r+2)|0;--s>=0;)T[s]=0;for(;l<r;++l,u+=2)p=C[u],m=C[u+1],_[E+l]=(p^p>>31)-(p>>31)+((m^m>>31)-(m>>31));for(s=1;s<=n;++s,u+=c){if(s==n)for(l=D+r;--l>=D;)_[l]=0;else for(l=0;l<r;l++)p=C[u+(l<<1)],m=C[u+(l<<1)+1],_[D+l]=(p^p>>31)-(p>>31)+((m^m>>31)-(m>>31));for(f=u-c|0,T[M-1]=0,h=0,l=0;l<r;++l,f+=2){if(d=_[E+l],d>i)if(p=C[f],m=C[f+1],g=p^m,p=(p^p>>31)-(p>>31)|0,m=(m^m>>31)-(m>>31)|0,v=13573*p,y=v+(p+p<<15),m<<=15,m<v){if(d>_[E+l-1]&&d>=_[E+l+1]){d>a&&!h&&2!=T[M+l-R]?(T[M+l]=2,h=1,I[L++]=M+l):T[M+l]=1;continue}}else if(m>y){if(d>_[x+l]&&d>=_[D+l]){d>a&&!h&&2!=T[M+l-R]?(T[M+l]=2,h=1,I[L++]=M+l):T[M+l]=1;continue}}else if(g=g<0?-1:1,d>_[x+l-g]&&d>_[D+l+g]){d>a&&!h&&2!=T[M+l-R]?(T[M+l]=2,h=1,I[L++]=M+l):T[M+l]=1;continue}T[M+l]=0,h=0}T[M+r]=0,M+=R,l=x,x=E,E=D,D=l}for(l=M-R-1,s=0;s<R;++s,++l)T[l]=0;for(;L>0;)M=I[--L],M-=R+1,1==T[M]&&(T[M]=2,I[L++]=M),M+=1,1==T[M]&&(T[M]=2,I[L++]=M),M+=1,1==T[M]&&(T[M]=2,I[L++]=M),M+=R,1==T[M]&&(T[M]=2,I[L++]=M),M-=2,1==T[M]&&(T[M]=2,I[L++]=M),M+=R,1==T[M]&&(T[M]=2,I[L++]=M),M+=1,1==T[M]&&(T[M]=2,I[L++]=M),M+=1,1==T[M]&&(T[M]=2,I[L++]=M);for(M=R+1,x=0,s=0;s<n;++s,M+=R)for(l=0;l<r;++l)o[x++]=255*(2==T[M+l]);jsfeat.cache.put_buffer(S),jsfeat.cache.put_buffer(w),jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P)},warp_perspective:function(e,t,i,a){"undefined"==typeof a&&(a=0);for(var r=0|e.cols,n=0|e.rows,o=0|t.cols,s=0|t.rows,l=e.data,u=t.data,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=i.data,C=I[0],A=I[1],x=I[2],E=I[3],D=I[4],R=I[5],M=I[6],L=I[7],O=I[8],k=0;f<s;++f)for(v=A*f+x,y=D*f+R,S=L*f+O,c=0;c<o;++c,++k,v+=C,y+=E,S+=M)w=1/S,m=v*w,g=y*w,d=0|m,p=0|g,m>0&&g>0&&d<r-1&&p<n-1?(b=Math.max(m-d,0),P=Math.max(g-p,0),h=r*p+d|0,_=l[h]+b*(l[h+1]-l[h]),T=l[h+r]+b*(l[h+r+1]-l[h+r]),u[k]=_+P*(T-_)):u[k]=a},warp_affine:function(e,t,i,a){"undefined"==typeof a&&(a=0);for(var r=e.cols,n=e.rows,o=t.cols,s=t.rows,l=e.data,u=t.data,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=i.data,P=b[0],_=b[1],T=b[2],I=b[3],C=b[4],A=b[5],x=0;f<s;++f)for(m=_*f+T,g=C*f+A,c=0;c<o;++c,++x,m+=P,g+=I)d=0|m,p=0|g,d>=0&&p>=0&&d<r-1&&p<n-1?(v=m-d,y=g-p,h=r*p+d,S=l[h]+v*(l[h+1]-l[h]),w=l[h+r]+v*(l[h+r+1]-l[h+r]),u[x]=S+y*(w-S)):u[x]=a},skindetector:function(e,t){for(var i,a,r,n,o=e.width*e.height;o--;)n=4*o,i=e.data[n],a=e.data[n+1],r=e.data[n+2],i>95&&a>40&&r>20&&i>a&&i>r&&i-Math.min(a,r)>15&&Math.abs(i-a)>15?t[o]=255:t[o]=0}}}();e.imgproc=t}(jsfeat),function(e){var t=function(){var e=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),t=new Uint8Array(512),i=new Int32Array(25),a=new Int32Array(25),r=function(t,i,a){for(var r=0,n=e;r<a;++r)t[r]=n[r<<1]+n[(r<<1)+1]*i;for(;r<25;++r)t[r]=t[r-a]},n=function(e,t,i,a,r){for(var n=25,o=0,s=e[t],l=r,u=0,c=0,f=0;o<n;++o)a[o]=s-e[t+i[o]];for(o=0;o<16;o+=2)u=Math.min(a[o+1],a[o+2]),u=Math.min(u,a[o+3]),u<=l||(u=Math.min(u,a[o+4]),u=Math.min(u,a[o+5]),u=Math.min(u,a[o+6]),u=Math.min(u,a[o+7]),u=Math.min(u,a[o+8]),l=Math.max(l,Math.min(u,a[o])),l=Math.max(l,Math.min(u,a[o+9])));for(c=-l,o=0;o<16;o+=2)f=Math.max(a[o+1],a[o+2]),f=Math.max(f,a[o+3]),f=Math.max(f,a[o+4]),f=Math.max(f,a[o+5]),f>=c||(f=Math.max(f,a[o+6]),f=Math.max(f,a[o+7]),f=Math.max(f,a[o+8]),c=Math.min(c,Math.max(f,a[o])),c=Math.min(c,Math.max(f,a[o+9])));return-c-1},o=20;return{set_threshold:function(e){o=Math.min(Math.max(e,0),255);for(var i=-255;i<=255;++i)t[i+255]=i<-o?1:i>o?2:0;return o},detect:function(e,s,l){"undefined"==typeof l&&(l=3);var u,c=8,f=25,h=e.data,d=e.cols,p=e.rows,m=0,g=0,v=0,y=0,S=0,w=0,b=jsfeat.cache.get_buffer(3*d),P=jsfeat.cache.get_buffer(3*(d+1)<<2),_=b.u8,T=P.i32,I=i,C=a,A=Math.max(3,l),x=Math.min(p-2,p-l),E=Math.max(3,l),D=Math.min(d-3,d-l),R=0,M=0,L=n,O=t,k=o,j=0,U=0,F=0,N=0,G=0,B=0,V=0,H=0,W=0,z=0,K=0,q=0;r(I,d,16);var X=I[0],Y=I[1],Z=I[2],J=I[3],Q=I[4],$=I[5],ee=I[6],te=I[7],ie=I[8],ae=I[9],re=I[10],ne=I[11],oe=I[12],se=I[13],le=I[14],ue=I[15];for(m=0;m<3*d;++m)_[m]=0;for(m=A;m<x;++m){for(V=m*d+E|0,w=(m-3)%3,B=w*d|0,G=w*(d+1)|0,g=0;g<d;++g)_[B+g]=0;if(N=0,m<x-1)for(g=E;g<D;++g,++V)if(j=h[V],U=-j+255,F=O[U+h[V+X]]|O[U+h[V+ie]],0!=F&&(F&=O[U+h[V+Z]]|O[U+h[V+re]],F&=O[U+h[V+Q]]|O[U+h[V+oe]],F&=O[U+h[V+ee]]|O[U+h[V+le]],0!=F)){if(F&=O[U+h[V+Y]]|O[U+h[V+ae]],F&=O[U+h[V+J]]|O[U+h[V+ne]],F&=O[U+h[V+$]]|O[U+h[V+se]],F&=O[U+h[V+te]]|O[U+h[V+ue]],1&F)for(y=j-k,R=0,v=0;v<f;++v)if(S=h[V+I[v]],S<y){if(++R,R>c){++N,T[G+N]=g,_[B+g]=L(h,V,I,C,k);break}}else R=0;if(2&F)for(y=j+k,R=0,v=0;v<f;++v)if(S=h[V+I[v]],S>y){if(++R,R>c){++N,T[G+N]=g,_[B+g]=L(h,V,I,C,k);break}}else R=0}if(T[G+d]=N,m!=A)for(w=(m-4+3)%3,H=w*d|0,G=w*(d+1)|0,w=(m-5+3)%3,W=w*d|0,N=T[G+d],v=0;v<N;++v)g=T[G+v],z=g+1|0,K=g-1|0,q=_[H+g],q>_[H+z]&&q>_[H+K]&&q>_[W+K]&&q>_[W+g]&&q>_[W+z]&&q>_[B+K]&&q>_[B+g]&&q>_[B+z]&&(u=s[M],u.x=g,u.y=m-1,u.score=q,M++)}return jsfeat.cache.put_buffer(b),jsfeat.cache.put_buffer(P),M}}}();e.fast_corners=t,t.set_threshold(20)}(jsfeat),function(e){var t=function(){var e=function(e,t,i,a,r,n,o,s,l,u){var c=0,f=0,h=s*i+o|0,d=h;for(c=s;c<u;++c,h+=i,d=h)for(f=o;f<l;++f,++d)t[d]=-4*e[d]+e[d+r]+e[d-r]+e[d+n]+e[d-n]},t=function(e,t,i,a,r,n,o){var s=-2*e[t]+e[t+a]+e[t-a],l=-2*e[t]+e[t+r]+e[t-r],u=e[t+n]+e[t-n]-e[t+o]-e[t-o],c=0|Math.sqrt((s-l)*(s-l)+4*u*u);return Math.min(Math.abs(i-c),Math.abs(-(i+c)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(i,a,r){"undefined"==typeof r&&(r=5);var n,o=0,s=0,l=i.cols,u=i.rows,c=i.data,f=5,h=5*l|0,d=3+3*l|0,p=3-3*l|0,m=jsfeat.cache.get_buffer(l*u<<2),g=m.i32,v=0,y=0,S=0,w=0,b=0,P=this.laplacian_threshold,_=this.min_eigen_value_threshold,T=0|Math.max(5,r),I=0|Math.max(3,r),C=0|Math.min(l-5,l-r),A=0|Math.min(u-3,u-r);for(o=l*u;--o>=0;)g[o]=0;for(e(c,g,l,u,f,h,T,I,C,A),y=I*l+T|0,s=I;s<A;++s,y+=l)for(o=T,S=y;o<C;++o,++S)v=g[S],(v<-P&&v<g[S-1]&&v<g[S+1]&&v<g[S-l]&&v<g[S+l]&&v<g[S-l-1]&&v<g[S+l-1]&&v<g[S-l+1]&&v<g[S+l+1]||v>P&&v>g[S-1]&&v>g[S+1]&&v>g[S-l]&&v>g[S+l]&&v>g[S-l-1]&&v>g[S+l-1]&&v>g[S-l+1]&&v>g[S+l+1])&&(w=t(c,S,v,f,h,d,p),w>_&&(n=a[b],n.x=o,n.y=s,n.score=w,++b,++o,++S));return jsfeat.cache.put_buffer(m),b}}}();e.yape06=t}(jsfeat),function(e){var t=function(){var e=function(e,t,i){var a,r,n=0;for(a=i,r=0;r<a;r++,n++)a=Math.sqrt(i*i-r*r)+.5|0,t[n]=a+e*r;for(a--;a<r&&a>=0;a--,n++)r=Math.sqrt(i*i-a*a)+.5|0,t[n]=a+e*r;for(;-a<r;a--,n++)r=Math.sqrt(i*i-a*a)+.5|0,t[n]=a+e*r;for(r--;r>=0;r--,n++)a=-Math.sqrt(i*i-r*r)-.5|0,t[n]=a+e*r;for(;r>a;r--,n++)a=-Math.sqrt(i*i-r*r)-.5|0,t[n]=a+e*r;for(a++;a<=0;a++,n++)r=-Math.sqrt(i*i-a*a)-.5|0,t[n]=a+e*r;for(;a<-r;a++,n++)r=-Math.sqrt(i*i-a*a)-.5|0,t[n]=a+e*r;for(r++;r<0;r++,n++)a=Math.sqrt(i*i-r*r)+.5|0,t[n]=a+e*r;return t[n]=t[0],t[n+1]=t[1],n},t=function(e,t,i){var a=0;return 0!=e[t+1]&&a++,0!=e[t-1]&&a++,0!=e[t+i]&&a++,0!=e[t+i+1]&&a++,0!=e[t+i-1]&&a++,0!=e[t-i]&&a++,0!=e[t-i+1]&&a++,0!=e[t-i-1]&&a++,a},i=function(e,t,i,a,r){var n,o;if(i>0)for(t-=a*r,o=-r;o<=r;++o){for(n=-r;n<=r;++n)if(e[t+n]>i)return!1;t+=a}else for(t-=a*r,o=-r;o<=r;++o){for(n=-r;n<=r;++n)if(e[t+n]<i)return!1;t+=a}return!0},a=function(e,t,i,a,r,n,o,s){var l=0,u=0,c=o-1|0,f=0,h=0,d=0,p=0,m=0;if(f=e[t+n[u]],f<=r)if(f>=a)if(h=e[t+n[c]],h<=r){if(h>=a)return void(i[t]=0);if(c++,d=e[t+n[c]],d>r)if(c++,p=e[t+n[c]],p>r)m=3;else{if(!(p<a))return void(i[t]=0);m=6}else if(c++,p=e[t+n[c]],p>r)m=7;else{if(!(p<a))return void(i[t]=0);m=2}}else if(c++,d=e[t+n[c]],d>r)if(c++,p=e[t+n[c]],p>r)m=3;else{if(!(p<a))return void(i[t]=0);m=6}else{if(!(d<a))return void(i[t]=0);if(c++,p=e[t+n[c]],p>r)m=7;else{if(!(p<a))return void(i[t]=0);m=2}}else{if(h=e[t+n[c]],h>r)return void(i[t]=0);if(c++,d=e[t+n[c]],d>r)return void(i[t]=0);if(c++,p=e[t+n[c]],p>r)return void(i[t]=0);m=1}else{if(h=e[t+n[c]],h<a)return void(i[t]=0);if(c++,d=e[t+n[c]],d<a)return void(i[t]=0);if(c++,p=e[t+n[c]],p<a)return void(i[t]=0);m=0}for(u=1;u<=o;u++)switch(f=e[t+n[u]],m){case 0:if(f>r){if(d=p,c++,p=e[t+n[c]],p<a)return void(i[t]=0);l-=f+d,m=0;break}if(f<a){if(d>r)return void(i[t]=0);if(p>r)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p>r)return void(i[t]=0);l-=f+d,m=8;break}if(d<=r)return void(i[t]=0);if(p<=r)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p>r){l-=f+d,m=3;break}if(p<a){l-=f+d,m=6;break}return void(i[t]=0);case 1:if(f<a){if(d=p,c++,p=e[t+n[c]],p>r)return void(i[t]=0);l-=f+d,m=1;break}if(f>r){if(d<a)return void(i[t]=0);if(p<a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p<a)return void(i[t]=0);l-=f+d,m=9;break}if(d>=a)return void(i[t]=0);if(p>=a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p<a){l-=f+d,m=2;break}if(p>r){l-=f+d,m=7;break}return void(i[t]=0);case 2:if(f>r)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],f<a){if(p>r)return void(i[t]=0);l-=f+d,m=4;break}if(p>r){l-=f+d,m=7;break}if(p<a){l-=f+d,m=2;break}return void(i[t]=0);case 3:if(f<a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],f>r){if(p<a)return void(i[t]=0);l-=f+d,m=5;break}if(p>r){l-=f+d,m=3;break}if(p<a){l-=f+d,m=6;break}return void(i[t]=0);case 4:if(f>r)return void(i[t]=0);if(f<a){if(d=p,c++,p=e[t+n[c]],p>r)return void(i[t]=0);l-=f+d,m=1;break}if(p>=a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p<a){l-=f+d,m=2;break}if(p>r){l-=f+d,m=7;break}return void(i[t]=0);case 5:if(f<a)return void(i[t]=0);if(f>r){if(d=p,c++,p=e[t+n[c]],p<a)return void(i[t]=0);l-=f+d,m=0;break}if(p<=r)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p>r){l-=f+d,m=3;break}if(p<a){l-=f+d,m=6;break}return void(i[t]=0);case 7:if(f>r)return void(i[t]=0);if(f<a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p>r){l-=f+d,m=3;break}if(p<a){l-=f+d,m=6;break}return void(i[t]=0);case 6:if(f>r)return void(i[t]=0);if(f<a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p<a){l-=f+d,m=2;break}if(p>r){l-=f+d,m=7;break}return void(i[t]=0);case 8:if(f>r){if(p<a)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p<a)return void(i[t]=0);l-=f+d,m=9;break}if(f<a){if(d=p,c++,p=e[t+n[c]],p>r)return void(i[t]=0);l-=f+d,m=1;break}return void(i[t]=0);case 9:if(f<a){if(p>r)return void(i[t]=0);if(d=p,c++,p=e[t+n[c]],p>r)return void(i[t]=0);l-=f+d,m=8;break}if(f>r){if(d=p,c++,p=e[t+n[c]],p<a)return void(i[t]=0);l-=f+d,m=0;break}return void(i[t]=0)}i[t]=l+s*e[t]},r=function(){function t(t,i,a){this.dirs=new Int32Array(1024),this.dirs_count=0|e(t,this.dirs,a),this.scores=new Int32Array(t*i),this.radius=0|a}return t}();return{level_tables:[],tau:7,init:function(e,t,i,a){"undefined"==typeof a&&(a=1);var n;for(i=Math.min(i,7),i=Math.max(i,3),n=0;n<a;++n)this.level_tables[n]=new r(e>>n,t>>n,i)},detect:function(e,r,n){"undefined"==typeof n&&(n=4);var o,s=this.level_tables[0],l=0|s.radius,u=l-1|0,c=s.dirs,f=0|s.dirs_count,h=f>>1,d=e.data,p=0|e.cols,m=0|e.rows,g=p>>1,v=s.scores,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0|this.tau,A=0,x=0|Math.max(l+1,n),E=0|Math.max(l+1,n),D=0|Math.min(p-l-2,p-n),R=0|Math.min(m-l-2,m-n);for(w=E*p+x|0,S=E;S<R;++S,w+=p)for(y=x,b=w;y<D;++y,++b)P=d[b]+C,_=d[b]-C,_<d[b+l]&&d[b+l]<P&&_<d[b-l]&&d[b-l]<P?v[b]=0:a(d,b,v,_,P,c,h,f);for(w=E*p+x|0,S=E;S<R;++S,w+=p)for(y=x,b=w;y<D;++y,++b)I=v[b],T=Math.abs(I),T<5?(++y,++b):t(v,b,p)>=3&&i(v,b,I,g,l)&&(o=r[A],o.x=y,o.y=S,o.score=T,++A,y+=u,b+=u);return A}}}();e.yape=t}(jsfeat),function(e){var t=function(){var e=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),t=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),i=new jsfeat.matrix_t(32,32,jsfeat.U8_t|jsfeat.C1_t),a=function(e,i,a,r,n,o){var s=Math.cos(a),l=Math.sin(a);t.data[0]=s,t.data[1]=-l,t.data[2]=(-s+l)*o*.5+r,t.data[3]=l,t.data[4]=s,t.data[5]=(-l-s)*o*.5+n,jsfeat.imgproc.warp_affine(e,i,t,128)};return{describe:function(t,r,n,o){var s=32,l=0,u=0,c=0,f=0,h=0,d=0,p=0,m=0,g=(t.data,t.cols,t.rows,i.data),v=528,y=0;o.type&jsfeat.U8_t?o.resize(s,n,1):(o.type=jsfeat.U8_t,o.cols=s,o.rows=n,o.channel=1,o.allocate());var S=o.data,w=0;for(l=0;l<n;++l){for(c=r[l].x,f=r[l].y,h=r[l].angle,a(t,i,h,c,f,32),y=0,u=0;u<s;++u)d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m=d<p|0,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<1,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<2,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<3,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<4,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<5,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<6,d=g[v+32*e[y+1]+e[y]],y+=2,p=g[v+32*e[y+1]+e[y]],y+=2,m|=(d<p)<<7,S[w+u]=m;w+=s}}}}();e.orb=t}(jsfeat),function(e){var t=function(){var e=jsfeat.imgproc.scharr_derivatives;return{track:function(t,i,a,r,n,o,s,l,u,c){"undefined"==typeof s&&(s=30),"undefined"==typeof l&&(l=new Uint8Array(n)),"undefined"==typeof u&&(u=.01),"undefined"==typeof c&&(c=1e-4);var f=.5*(o-1),h=o*o|0,d=h<<1,p=t.data,m=i.data,g=p[0].data,v=m[0].data,y=p[0].cols,S=p[0].rows,w=0,b=0,P=jsfeat.cache.get_buffer(h<<2),_=jsfeat.cache.get_buffer(d<<2),T=jsfeat.cache.get_buffer(S*(y<<1)<<2),I=new jsfeat.matrix_t(y,S,jsfeat.S32C2_t,T.data),C=P.i32,A=_.i32,x=T.i32,E=0,D=0,R=0,M=0,L=0,O=0,k=0,j=0,U=0,F=0,N=0,G=0,B=0,V=0,H=0,W=0,z=0,K=0,q=0,X=0,Y=0,Z=0,J=0,Q=0,$=0,ee=0,te=0,ie=0,ae=0,re=0,ne=0,oe=0,se=0,le=14,ue=14,ce=ue-5,fe=1<<ce-1,he=1<<le,de=1<<ue-1,pe=1/(1<<20),me=0,ge=0,ve=0,ye=0,Se=0,we=0,be=0,Pe=0,_e=0,Te=0,Ie=0,Ce=0,Ae=1.1920929e-7;for(u*=u;X<n;++X)l[X]=1;var xe=t.levels-1|0;for(Q=xe;Q>=0;--Q)for(k=1/(1<<Q),w=y>>Q,b=S>>Q,E=w<<1,g=p[Q].data,v=m[Q].data,ie=w-o|0,ae=b-o|0,e(p[Q],I),$=0;$<n;++$)if(X=$<<1,Y=X+1,j=a[X]*k,U=a[Y]*k,Q==xe?(F=j,N=U):(F=2*r[X],N=2*r[Y]),r[X]=F,r[Y]=N,j-=f,U-=f,W=0|j,z=0|U,Z=W<=te|W>=ie|z<=te|z>=ae,0==Z){for(re=j-W,ne=U-z,me=(1-re)*(1-ne)*he+.5|0,ge=re*(1-ne)*he+.5|0,ve=(1-re)*ne*he+.5|0,ye=he-me-ge-ve,Pe=0,_e=0,Te=0,J=0;J<o;++J)for(D=(J+z)*w+W|0,R=D<<1,M=J*o|0,L=M<<1,Z=0;Z<o;++Z,++D,++M,R+=2)Se=g[D]*me+g[D+1]*ge+g[D+w]*ve+g[D+w+1]*ye,Se=Se+fe>>ce,we=x[R]*me+x[R+2]*ge+x[R+E]*ve+x[R+E+2]*ye,we=we+de>>ue,be=x[R+1]*me+x[R+3]*ge+x[R+E+1]*ve+x[R+E+3]*ye,be=be+de>>ue,C[M]=Se,A[L++]=we,A[L++]=be,Pe+=we*we,_e+=we*be,Te+=be*be;if(Pe*=pe,_e*=pe,Te*=pe,Ie=Pe*Te-_e*_e,Ce=(Te+Pe-Math.sqrt((Pe-Te)*(Pe-Te)+4*_e*_e))/d,Ce<c||Ie<Ae)0==Q&&(l[$]=0);else for(Ie=1/Ie,F-=f,N-=f,G=0,B=0,ee=0;ee<s;++ee){if(K=0|F,q=0|N,Z=K<=te|K>=ie|q<=te|q>=ae,0!=Z){0==Q&&(l[$]=0);break}for(re=F-K,ne=N-q,me=(1-re)*(1-ne)*he+.5|0,ge=re*(1-ne)*he+.5|0,ve=(1-re)*ne*he+.5|0,ye=he-me-ge-ve,oe=0,se=0,J=0;J<o;++J)for(O=(J+q)*w+K|0,M=J*o|0,L=M<<1,Z=0;Z<o;++Z,++O,++M)Se=v[O]*me+v[O+1]*ge+v[O+w]*ve+v[O+w+1]*ye,Se=Se+fe>>ce,Se-=C[M],oe+=Se*A[L++],se+=Se*A[L++];if(oe*=pe,se*=pe,V=(_e*se-Te*oe)*Ie,H=(_e*oe-Pe*se)*Ie,F+=V,N+=H,r[X]=F+f,r[Y]=N+f,V*V+H*H<=u)break;if(ee>0&&Math.abs(V+G)<.01&&Math.abs(H+B)<.01){r[X]-=.5*V,r[Y]-=.5*H;break}G=V,B=H}}else 0==Q&&(l[$]=0);jsfeat.cache.put_buffer(P),jsfeat.cache.put_buffer(_),jsfeat.cache.put_buffer(T)}}}();e.optical_flow_lk=t}(jsfeat),function(e){var t=function(){var e=function(e,t){var i=.25*e.width+.5|0;return t.x<=e.x+i&&t.x>=e.x-i&&t.y<=e.y+i&&t.y>=e.y-i&&t.width<=1.5*e.width+.5|0&&1.5*t.width+.5|0>=e.width};return{edges_density:.07,detect_single_scale:function(e,t,i,a,r,n,o,s){var l,u,c,f,h,d,p,m,g,v,y,S,w,b,P,_,T,I,C,A,x,E,D,R,M,L,O=s.size[0]*o|0,k=s.size[1]*o|0,j=.5*o+1.5|0,U=j,F=r-O|0,N=n-k|0,G=r+1|0,B=1/(O*k),V=!0,H=0,W=O,z=k*G,K=z+O,q=O*k*255*this.edges_density|0,X=[];for(h=0;h<N;h+=U)for(H=h*G,f=0;f<F;f+=j,H+=j)if(p=e[H]-e[H+W]-e[H+z]+e[H+K],a&&(d=a[H]-a[H+W]-a[H+z]+a[H+K],d<q||p<20))f+=j,H+=j;else{for(p*=B,m=(t[H]-t[H+W]-t[H+z]+t[H+K])*B-p*p,g=m>0?Math.sqrt(m):1,v=s.complexClassifiers,b=v.length,V=!0,l=0;l<b;++l){for(y=v[l],T=y.threshold,S=y.simpleClassifiers,P=S.length,I=0,u=0;u<P;++u){if(w=S[u],C=0,x=w.features,_=x.length,1===w.tilted)for(c=0;c<_;++c)A=x[c],E=~~(f+A[0]*o)+~~(h+A[1]*o)*G,M=~~(A[2]*o),L=~~(A[3]*o),D=M*G,R=L*G,C+=(i[E]-i[E+M+D]-i[E-L+R]+i[E+M-L+D+R])*A[4];else for(c=0;c<_;++c)A=x[c],E=~~(f+A[0]*o)+~~(h+A[1]*o)*G,M=~~(A[2]*o),L=~~(A[3]*o),R=L*G,C+=(e[E]-e[E+M]-e[E+R]+e[E+R+M])*A[4];I+=C*B<w.threshold*g?w.left_val:w.right_val}if(I<T){V=!1;break}}V&&(X.push({x:f,y:h,width:O,height:k,neighbor:1,confidence:I}),f+=j,H+=j)}return X},detect_multi_scale:function(e,t,i,a,r,n,o,s,l){"undefined"==typeof s&&(s=1.2),"undefined"==typeof l&&(l=1);for(var u=o.size[0],c=o.size[1],f=[];l*u<r&&l*c<n;)f=f.concat(this.detect_single_scale(e,t,i,a,r,n,l,o)),l*=s;return f},group_rectangles:function(t,i){"undefined"==typeof i&&(i=1);var a,r,n=t.length,o=[];for(a=0;a<n;++a)o[a]={parent:-1,element:t[a],rank:0};for(a=0;a<n;++a)if(o[a].element){for(var s=a;o[s].parent!=-1;)s=o[s].parent;for(r=0;r<n;++r)if(a!=r&&o[r].element&&e(o[a].element,o[r].element)){for(var l=r;o[l].parent!=-1;)l=o[l].parent;if(l!=s){o[s].rank>o[l].rank?o[l].parent=s:(o[s].parent=l,o[s].rank==o[l].rank&&o[l].rank++,s=l);for(var u,c=r;o[c].parent!=-1;)u=c,c=o[c].parent,o[u].parent=s;for(c=a;o[c].parent!=-1;)u=c,c=o[c].parent,o[u].parent=s}}}var f=[],h=0;for(a=0;a<n;a++){r=-1;var d=a;if(o[d].element){for(;o[d].parent!=-1;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~h++),r=~o[d].rank}f[a]=r}var p=[];for(a=0;a<h+1;++a)p[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<n;++a){var m=t[a],g=f[a];0==p[g].neighbors&&(p[g].confidence=m.confidence),++p[g].neighbors,p[g].x+=m.x,p[g].y+=m.y,p[g].width+=m.width,p[g].height+=m.height,p[g].confidence=Math.max(p[g].confidence,m.confidence)}var v=[];for(a=0;a<h;++a)n=p[a].neighbors,n>=i&&v.push({x:(2*p[a].x+n)/(2*n),y:(2*p[a].y+n)/(2*n),width:(2*p[a].width+n)/(2*n),height:(2*p[a].height+n)/(2*n),neighbors:p[a].neighbors,confidence:p[a].confidence});var y=[];for(n=v.length,a=0;a<n;++a){var m=v[a],S=!0;for(r=0;r<n;++r){var w=v[r],b=.25*w.width+.5|0;if(a!=r&&m.x>=w.x-b&&m.y>=w.y-b&&m.x+m.width<=w.x+w.width+b&&m.y+m.height<=w.y+w.height+b&&(w.neighbors>Math.max(3,m.neighbors)||m.neighbors<3)){S=!1;break}}S&&y.push(m)}return y}}}();e.haar=t}(jsfeat),function(e){var t=function(){var e=function(e,t){var i=.25*e.width+.5|0;return t.x<=e.x+i&&t.x>=e.x-i&&t.y<=e.y+i&&t.y>=e.y-i&&t.width<=1.5*e.width+.5|0&&1.5*t.width+.5|0>=e.width},t=new jsfeat.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(e){for(var t=e.stage_classifier.length,i=0;i<t;i++)for(var a=e.stage_classifier[i].feature,r=e.stage_classifier[i].count,n=e.stage_classifier[i]._feature=new Array(r),o=0;o<r;o++)n[o]={size:a[o].size,px:new Array(a[o].size),pz:new Array(a[o].size),nx:new Array(a[o].size),nz:new Array(a[o].size)}},build_pyramid:function(e,i,a,r){"undefined"==typeof r&&(r=4);var n=e.cols,o=e.rows,s=0,l=0,u=0,c=!1,f=e,h=e,d=jsfeat.U8_t|jsfeat.C1_t;this.interval=r,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(n/i,o/a))/Math.log(this.scale)|0;var p=4*(this.scale_to+2*this.next)|0;for(t.levels!=p&&(t.levels=p,t.data=new Array(p),c=!0,t.data[0]=e),s=1;s<=this.interval;++s)l=n/Math.pow(this.scale,s)|0,u=o/Math.pow(this.scale,s)|0,f=t.data[s<<2],(c||l!=f.cols||u!=f.rows)&&(t.data[s<<2]=new jsfeat.matrix_t(l,u,d),f=t.data[s<<2]),jsfeat.imgproc.resample(e,f,l,u);for(s=this.next;s<this.scale_to+2*this.next;++s)h=t.data[(s<<2)-(this.next<<2)],f=t.data[s<<2],l=h.cols>>1,u=h.rows>>1,(c||l!=f.cols||u!=f.rows)&&(t.data[s<<2]=new jsfeat.matrix_t(l,u,d),f=t.data[s<<2]),jsfeat.imgproc.pyrdown(h,f);for(s=2*this.next;s<this.scale_to+2*this.next;++s)h=t.data[(s<<2)-(this.next<<2)],l=h.cols>>1,u=h.rows>>1,f=t.data[(s<<2)+1],(c||l!=f.cols||u!=f.rows)&&(t.data[(s<<2)+1]=new jsfeat.matrix_t(l,u,d),f=t.data[(s<<2)+1]),jsfeat.imgproc.pyrdown(h,f,1,0),f=t.data[(s<<2)+2],(c||l!=f.cols||u!=f.rows)&&(t.data[(s<<2)+2]=new jsfeat.matrix_t(l,u,d),f=t.data[(s<<2)+2]),jsfeat.imgproc.pyrdown(h,f,0,1),f=t.data[(s<<2)+3],(c||l!=f.cols||u!=f.rows)&&(t.data[(s<<2)+3]=new jsfeat.matrix_t(l,u,d),f=t.data[(s<<2)+3]),jsfeat.imgproc.pyrdown(h,f,1,1);return t},detect:function(e,t){var i,a,r,n,o,s=(this.interval,this.scale),l=this.next,u=this.scale_to,c=0,f=0,h=0,d=0,p=0,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=!0,E=!0,D=1,R=1,M=[0,1,0,1],L=[0,0,1,1],O=[],k=e.data,j=1,U=2,F=4,N=[],G=[0,0,0],B=[0,0,0],V=[0,0,0];for(c=0;c<u;c++){for(T=c<<2,I=k[T+(l<<3)].cols-(t.width>>2),C=k[T+(l<<3)].rows-(t.height>>2),B[0]=k[T].cols*j,B[1]=k[T+(l<<2)].cols*j,B[2]=k[T+(l<<3)].cols*j,V[0]=k[T].cols*F-I*F,V[1]=k[T+(l<<2)].cols*U-I*U,V[2]=k[T+(l<<3)].cols*j-I*j,v=t.stage_classifier.length,f=0;f<v;f++)for(r=t.stage_classifier[f].feature,a=t.stage_classifier[f]._feature,y=t.stage_classifier[f].count,h=0;h<y;h++)for(n=a[h],o=r[h],S=0|o.size,g=0;g<S;g++)n.px[g]=o.px[g]*j+o.py[g]*B[o.pz[g]],n.pz[g]=o.pz[g],n.nx[g]=o.nx[g]*j+o.ny[g]*B[o.nz[g]],n.nz[g]=o.nz[g];for(N[0]=k[T].data,N[1]=k[T+(l<<2)].data,g=0;g<4;g++)for(N[2]=k[T+(l<<3)+g].data,G[0]=M[g]*U+L[g]*(k[T].cols*U),G[1]=M[g]*j+L[g]*(k[T+(l<<2)].cols*j),G[2]=0,m=0;m<C;m++){for(p=0;p<I;p++){for(A=0,x=!0,v=t.stage_classifier.length,f=0;f<v;f++){for(A=0,i=t.stage_classifier[f].alpha,a=t.stage_classifier[f]._feature,y=t.stage_classifier[f].count,h=0;h<y;h++)if(n=a[h],b=N[n.pz[0]][G[n.pz[0]]+n.px[0]],P=N[n.nz[0]][G[n.nz[0]]+n.nx[0]],b<=P)A+=i[h<<1];else{for(E=!0,S=n.size,_=1;_<S;_++){if(n.pz[_]>=0&&(w=N[n.pz[_]][G[n.pz[_]]+n.px[_]],w<b)){if(w<=P){E=!1;break}b=w}if(n.nz[_]>=0&&(d=N[n.nz[_]][G[n.nz[_]]+n.nx[_]],d>P)){if(b<=d){E=!1;break}P=d}}A+=E?i[(h<<1)+1]:i[h<<1]}if(A<t.stage_classifier[f].threshold){x=!1;break}}x&&(O.push({x:(4*p+2*M[g])*D,y:(4*m+2*L[g])*R,width:t.width*D,height:t.height*R,neighbor:1,confidence:A}),++p,G[0]+=F,G[1]+=U,G[2]+=j),G[0]+=F,G[1]+=U,G[2]+=j}G[0]+=V[0],G[1]+=V[1],G[2]+=V[2]}D*=s,R*=s}return O},group_rectangles:function(t,i){"undefined"==typeof i&&(i=1);var a,r,n=t.length,o=[];for(a=0;a<n;++a)o[a]={parent:-1,element:t[a],rank:0};for(a=0;a<n;++a)if(o[a].element){for(var s=a;o[s].parent!=-1;)s=o[s].parent;for(r=0;r<n;++r)if(a!=r&&o[r].element&&e(o[a].element,o[r].element)){for(var l=r;o[l].parent!=-1;)l=o[l].parent;if(l!=s){o[s].rank>o[l].rank?o[l].parent=s:(o[s].parent=l,o[s].rank==o[l].rank&&o[l].rank++,s=l);for(var u,c=r;o[c].parent!=-1;)u=c,c=o[c].parent,o[u].parent=s;for(c=a;o[c].parent!=-1;)u=c,c=o[c].parent,o[u].parent=s}}}var f=[],h=0;for(a=0;a<n;a++){r=-1;var d=a;if(o[d].element){for(;o[d].parent!=-1;)d=o[d].parent;o[d].rank>=0&&(o[d].rank=~h++),r=~o[d].rank}f[a]=r}var p=[];for(a=0;a<h+1;++a)p[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<n;++a){var m=t[a],g=f[a];0==p[g].neighbors&&(p[g].confidence=m.confidence),++p[g].neighbors,p[g].x+=m.x,p[g].y+=m.y,p[g].width+=m.width,p[g].height+=m.height,p[g].confidence=Math.max(p[g].confidence,m.confidence)}var v=[];for(a=0;a<h;++a)n=p[a].neighbors,n>=i&&v.push({x:(2*p[a].x+n)/(2*n),y:(2*p[a].y+n)/(2*n),width:(2*p[a].width+n)/(2*n),height:(2*p[a].height+n)/(2*n),neighbors:p[a].neighbors,confidence:p[a].confidence});var y=[];for(n=v.length,a=0;a<n;++a){var m=v[a],S=!0;for(r=0;r<n;++r){var w=v[r],b=.25*w.width+.5|0;if(a!=r&&m.x>=w.x-b&&m.y>=w.y-b&&m.x+m.width<=w.x+w.width+b&&m.y+m.height<=w.y+w.height+b&&(w.neighbors>Math.max(3,m.neighbors)||m.neighbors<3)){S=!1;break}}S&&y.push(m)}return y}}}();e.bbf=t}(jsfeat),function(e){"undefined"==typeof module||"undefined"==typeof module.exports?window.jsfeat=e:module.exports=e}(jsfeat),/*
The MIT License (MIT)

Copyright (c) 2014, 2015 hMatoba(https://github.com/hMatoba)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/
function(){"use strict";function e(e){return JSON.parse(JSON.stringify(e))}function t(e){for(var t=f(e);"\xff\xe0"<=t[1].slice(0,2)&&t[1].slice(0,2)<="\xff\xef";)t=[t[0]].concat(t.slice(2));return t.join("")}function i(e){return l(">"+c("B",e.length),e)}function a(e){return l(">"+c("H",e.length),e)}function r(e){return l(">"+c("L",e.length),e)}function n(e,t,n){var o,s,u,f,h="",d="";if("Byte"==t)o=e.length,o<=4?d=i(e)+c("\0",4-o):(d=l(">L",[n]),h=i(e));else if("Short"==t)o=e.length,o<=2?d=a(e)+c("\0\0",2-o):(d=l(">L",[n]),h=a(e));else if("Long"==t)o=e.length,o<=1?d=r(e):(d=l(">L",[n]),h=r(e));else if("Ascii"==t)s=e+"\0",o=s.length,o>4?(d=l(">L",[n]),h=s):d=s+c("\0",4-o);else if("Rational"==t){if("number"==typeof e[0])o=1,u=e[0],f=e[1],s=l(">L",[u])+l(">L",[f]);else{o=e.length,s="";for(var p=0;p<o;p++)u=e[p][0],f=e[p][1],s+=l(">L",[u])+l(">L",[f])}d=l(">L",[n]),h=s}else if("SRational"==t){if("number"==typeof e[0])o=1,u=e[0],f=e[1],s=l(">l",[u])+l(">l",[f]);else{o=e.length,s="";for(var p=0;p<o;p++)u=e[p][0],f=e[p][1],s+=l(">l",[u])+l(">l",[f])}d=l(">L",[n]),h=s}else"Undefined"==t&&(o=e.length,o>4?(d=l(">L",[n]),h=e):d=e+c("\0",4-o));var m=l(">L",[o]);return[m,d,h]}function o(e,t,i){var a,r=8,o=Object.keys(e).length,s=l(">H",[o]);a=["0th","1st"].indexOf(t)>-1?2+12*o+4:2+12*o;var u,c="",f="";for(var u in e)if("string"==typeof u&&(u=parseInt(u)),!("0th"==t&&[34665,34853].indexOf(u)>-1||"Exif"==t&&40965==u||"1st"==t&&[513,514].indexOf(u)>-1)){var h=e[u],d=l(">H",[u]),p=y[t][u].type,m=l(">H",[v[p]]);"number"==typeof h&&(h=[h]);var g=r+a+i+f.length,S=n(h,p,g),w=S[0],b=S[1],P=S[2];c+=d+m+w+b,f+=P}return[s+c,f]}function s(e){var t,i;if("\xff\xd8"==e.slice(0,2))t=f(e),i=h(t),i?this.tiftag=i.slice(10):this.tiftag=null;else if(["II","MM"].indexOf(e.slice(0,2))>-1)this.tiftag=e;else{if("Exif"!=e.slice(0,4))throw"Given file is neither JPEG nor TIFF.";this.tiftag=e.slice(6)}}function l(e,t){if(!(t instanceof Array))throw"'pack' error. Got invalid type argument.";if(e.length-1!=t.length)throw"'pack' error. "+(e.length-1)+" marks, "+t.length+" elements.";var i;if("<"==e[0])i=!0;else{if(">"!=e[0])throw"";i=!1}for(var a="",r=1,n=null,o=null,s=null;o=e[r];){if("b"==o.toLowerCase()){if(n=t[r-1],"b"==o&&n<0&&(n+=256),n>255||n<0)throw"'pack' error.";s=String.fromCharCode(n)}else if("H"==o){if(n=t[r-1],n>65535||n<0)throw"'pack' error.";s=String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),i&&(s=s.split("").reverse().join(""))}else{if("l"!=o.toLowerCase())throw"'pack' error.";if(n=t[r-1],"l"==o&&n<0&&(n+=4294967296),n>4294967295||n<0)throw"'pack' error.";s=String.fromCharCode(Math.floor(n/16777216))+String.fromCharCode(Math.floor(n%16777216/65536))+String.fromCharCode(Math.floor(n%65536/256))+String.fromCharCode(n%256),i&&(s=s.split("").reverse().join(""))}a+=s,r+=1}return a}function u(e,t){if("string"!=typeof t)throw"'unpack' error. Got invalid type argument.";for(var i=0,a=1;a<e.length;a++)if("b"==e[a].toLowerCase())i+=1;else if("h"==e[a].toLowerCase())i+=2;else{if("l"!=e[a].toLowerCase())throw"'unpack' error. Got invalid mark.";i+=4}if(i!=t.length)throw"'unpack' error. Mismatch between symbol and string length. "+i+":"+t.length;var r;if("<"==e[0])r=!0;else{if(">"!=e[0])throw"'unpack' error.";r=!1}for(var n=[],o=0,s=1,l=null,u=null,c=null,f="";u=e[s];){if("b"==u.toLowerCase())c=1,f=t.slice(o,o+c),l=f.charCodeAt(0),"b"==u&&l>=128&&(l-=256);else if("H"==u)c=2,f=t.slice(o,o+c),r&&(f=f.split("").reverse().join("")),l=256*f.charCodeAt(0)+f.charCodeAt(1);else{if("l"!=u.toLowerCase())throw"'unpack' error. "+u;c=4,f=t.slice(o,o+c),r&&(f=f.split("").reverse().join("")),l=16777216*f.charCodeAt(0)+65536*f.charCodeAt(1)+256*f.charCodeAt(2)+f.charCodeAt(3),"l"==u&&l>=2147483648&&(l-=4294967296)}n.push(l),o+=c,s+=1}return n}function c(e,t){for(var i="",a=0;a<t;a++)i+=e;return i}function f(e){if("\xff\xd8"!=e.slice(0,2))throw"Given data isn't JPEG.";for(var t=2,i=["\xff\xd8"];;){if("\xff\xda"==e.slice(t,t+2)){i.push(e.slice(t));break}var a=u(">H",e.slice(t+2,t+4))[0],r=t+a+2;if(i.push(e.slice(t,r)),t=r,t>=e.length)throw"Wrong JPEG data."}return i}function h(e){for(var t,i=0;i<e.length;i++)if(t=e[i],"\xff\xe1"==t.slice(0,2))return t;return null}function d(e,t){return"\xff\xe0"==e[1].slice(0,2)&&"\xff\xe1"==e[2].slice(0,2)?t?(e[2]=t,e=["\xff\xd8",t].concat(e.slice(2))):e=null==t?e.slice(0,2).concat(e.slice(3)):e.slice(0).concat(e.slice(2)):"\xff\xe0"==e[1].slice(0,2)?t&&(e[1]=t):"\xff\xe1"==e[1].slice(0,2)?t?e[1]=t:null==t&&(e=e.slice(0).concat(e.slice(2))):t&&(e=[e[0],t].concat(e.slice(1))),e.join("")}var p={};if(p.remove=function(e){var t=!1;if("\xff\xd8"==e.slice(0,2));else{if("data:image/jpeg;base64,"!=e.slice(0,23))throw"Given data is not jpeg.";e=g(e.split(",")[1]),t=!0}var i=f(e);if("\xff\xe1"==i[1].slice(0,2))i=[i[0]].concat(i.slice(2));else{if("\xff\xe1"!=i[2].slice(0,2))throw"Exif not found.";i=i.slice(0,2).concat(i.slice(3))}var a=i.join("");return t&&(a="data:image/jpeg;base64,"+m(a)),a},p.insert=function(e,t){var i=!1;if("Exif\0\0"!=e.slice(0,6))throw"Given data is not exif.";if("\xff\xd8"==t.slice(0,2));else{if("data:image/jpeg;base64,"!=t.slice(0,23))throw"Given data is not jpeg.";t=g(t.split(",")[1]),i=!0}var a="\xff\xe1"+l(">H",[e.length+2])+e,r=f(t),n=d(r,a);return i&&(n="data:image/jpeg;base64,"+m(n)),n},p.load=function(e){var t;if("string"!=typeof e)throw"'load' gots invalid type argument.";if("\xff\xd8"==e.slice(0,2))t=e;else if("data:image/jpeg;base64,"==e.slice(0,23))t=g(e.split(",")[1]);else{if("Exif"!=e.slice(0,4))throw"'load' gots invalid file data.";t=e.slice(6)}var i={"0th":{},Exif:{},GPS:{},Interop:{},"1st":{},thumbnail:null},a=new s(t);if(null===a.tiftag)return i;"II"==a.tiftag.slice(0,2)?a.endian_mark="<":a.endian_mark=">";var r=u(a.endian_mark+"L",a.tiftag.slice(4,8))[0];i["0th"]=a.get_ifd(r,"0th");var n=i["0th"].first_ifd_pointer;if(delete i["0th"].first_ifd_pointer,34665 in i["0th"]&&(r=i["0th"][34665],i.Exif=a.get_ifd(r,"Exif")),34853 in i["0th"]&&(r=i["0th"][34853],i.GPS=a.get_ifd(r,"GPS")),40965 in i.Exif&&(r=i.Exif[40965],i.Interop=a.get_ifd(r,"Interop")),"\0\0\0\0"!=n&&(r=u(a.endian_mark+"L",n)[0],i["1st"]=a.get_ifd(r,"1st"),513 in i["1st"]&&514 in i["1st"])){var o=i["1st"][513]+i["1st"][514],l=a.tiftag.slice(i["1st"][513],o);i.thumbnail=l}return i},p.dump=function(i){var a,r,n,s,u,c=8,f=e(i),h="Exif\0\0MM\0*\0\0\0\b",d=!1,p=!1,m=!1,g=!1;a="0th"in f?f["0th"]:{},("Exif"in f&&Object.keys(f.Exif).length||"Interop"in f&&Object.keys(f.Interop).length)&&(a[34665]=1,d=!0,r=f.Exif,"Interop"in f&&Object.keys(f.Interop).length&&(r[40965]=1,m=!0,n=f.Interop)),"GPS"in f&&Object.keys(f.GPS).length&&(a[34853]=1,p=!0,s=f.GPS),"1st"in f&&"thumbnail"in f&&null!=f.thumbnail&&(g=!0,f["1st"][513]=1,f["1st"][514]=1,u=f["1st"]);var y,S,w,b,P,_=o(a,"0th",0),T=_[0].length+12*d+12*p+4+_[1].length,I="",C=0,A="",x=0,E="",D=0,R="";if(d&&(y=o(r,"Exif",T),C=y[0].length+12*m+y[1].length),p&&(S=o(s,"GPS",T+C),A=S.join(""),x=A.length),m){var M=T+C+x;w=o(n,"Interop",M),E=w.join(""),D=E.length}if(g){var M=T+C+x+D;if(b=o(u,"1st",M),P=t(f.thumbnail),P.length>64e3)throw"Given thumbnail is too large. max 64kB"}var L="",O="",k="",j="\0\0\0\0";if(d){var U=c+T,F=l(">L",[U]),N=34665,G=l(">H",[N]),B=l(">H",[v.Long]),V=l(">L",[1]);L=G+B+V+F}if(p){var U=c+T+C,F=l(">L",[U]),N=34853,G=l(">H",[N]),B=l(">H",[v.Long]),V=l(">L",[1]);O=G+B+V+F}if(m){var U=c+T+C+x,F=l(">L",[U]),N=40965,G=l(">H",[N]),B=l(">H",[v.Long]),V=l(">L",[1]);k=G+B+V+F}if(g){var U=c+T+C+x+D;j=l(">L",[U]);var H=U+b[0].length+24+4+b[1].length,W="\x02\x01\0\x04\0\0\0\x01"+l(">L",[H]),z="\x02\x02\0\x04\0\0\0\x01"+l(">L",[P.length]);R=b[0]+W+z+"\0\0\0\0"+b[1]+P}var K=_[0]+L+O+j+_[1];return d&&(I=y[0]+k+y[1]),h+K+I+A+E+R},s.prototype={get_ifd:function(e,t){var i,a={},r=u(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],n=e+2;i=["0th","1st"].indexOf(t)>-1?"Image":t;for(var o=0;o<r;o++){e=n+12*o;var s=u(this.endian_mark+"H",this.tiftag.slice(e,e+2))[0],l=u(this.endian_mark+"H",this.tiftag.slice(e+2,e+4))[0],c=u(this.endian_mark+"L",this.tiftag.slice(e+4,e+8))[0],f=this.tiftag.slice(e+8,e+12),h=[l,c,f];s in y[i]&&(a[s]=this.convert_value(h))}return"0th"==t&&(e=n+12*r,a.first_ifd_pointer=this.tiftag.slice(e,e+4)),a},convert_value:function(e){var t,i=null,a=e[0],r=e[1],n=e[2];if(1==a)r>4?(t=u(this.endian_mark+"L",n)[0],i=u(this.endian_mark+c("B",r),this.tiftag.slice(t,t+r))):i=u(this.endian_mark+c("B",r),n.slice(0,r));else if(2==a)r>4?(t=u(this.endian_mark+"L",n)[0],i=this.tiftag.slice(t,t+r-1)):i=n.slice(0,r-1);else if(3==a)r>2?(t=u(this.endian_mark+"L",n)[0],i=u(this.endian_mark+c("H",r),this.tiftag.slice(t,t+2*r))):i=u(this.endian_mark+c("H",r),n.slice(0,2*r));else if(4==a)r>1?(t=u(this.endian_mark+"L",n)[0],i=u(this.endian_mark+c("L",r),this.tiftag.slice(t,t+4*r))):i=u(this.endian_mark+c("L",r),n);else if(5==a)if(t=u(this.endian_mark+"L",n)[0],r>1){i=[];for(var o=0;o<r;o++)i.push([u(this.endian_mark+"L",this.tiftag.slice(t+8*o,t+4+8*o))[0],u(this.endian_mark+"L",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[u(this.endian_mark+"L",this.tiftag.slice(t,t+4))[0],u(this.endian_mark+"L",this.tiftag.slice(t+4,t+8))[0]];else if(7==a)r>4?(t=u(this.endian_mark+"L",n)[0],i=this.tiftag.slice(t,t+r)):i=n.slice(0,r);else{if(10!=a)throw"Exif might be wrong. Got incorrect value type to decode. type:"+a;if(t=u(this.endian_mark+"L",n)[0],r>1){i=[];for(var o=0;o<r;o++)i.push([u(this.endian_mark+"l",this.tiftag.slice(t+8*o,t+4+8*o))[0],u(this.endian_mark+"l",this.tiftag.slice(t+4+8*o,t+8+8*o))[0]])}else i=[u(this.endian_mark+"l",this.tiftag.slice(t,t+4))[0],u(this.endian_mark+"l",this.tiftag.slice(t+4,t+8))[0]]}return i instanceof Array&&1==i.length?i[0]:i}},"undefined"==typeof m)var m=function(e){for(var t,i,a,r,n,o,s,l="",u=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),a=e.charCodeAt(u++),r=t>>2,n=(3&t)<<4|i>>4,o=(15&i)<<2|a>>6,s=63&a,isNaN(i)?o=s=64:isNaN(a)&&(s=64),l=l+c.charAt(r)+c.charAt(n)+c.charAt(o)+c.charAt(s);return l};if("undefined"==typeof g)var g=function(e){var t,i,a,r,n,o,s,l="",u=0,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)r=c.indexOf(e.charAt(u++)),n=c.indexOf(e.charAt(u++)),o=c.indexOf(e.charAt(u++)),s=c.indexOf(e.charAt(u++)),t=r<<2|n>>4,i=(15&n)<<4|o>>2,a=(3&o)<<6|s,l+=String.fromCharCode(t),64!=o&&(l+=String.fromCharCode(i)),64!=s&&(l+=String.fromCharCode(a));return l};var v={Byte:1,Ascii:2,Short:3,Long:4,Rational:5,Undefined:7,SLong:9,SRational:10},y={Image:{11:{name:"ProcessingSoftware",type:"Ascii"},254:{name:"NewSubfileType",type:"Long"},255:{name:"SubfileType",type:"Short"},256:{name:"ImageWidth",type:"Long"},257:{name:"ImageLength",type:"Long"},258:{name:"BitsPerSample",type:"Short"},259:{name:"Compression",type:"Short"},262:{name:"PhotometricInterpretation",type:"Short"},263:{name:"Threshholding",type:"Short"},264:{name:"CellWidth",type:"Short"},265:{name:"CellLength",type:"Short"},266:{name:"FillOrder",type:"Short"},269:{name:"DocumentName",type:"Ascii"},270:{name:"ImageDescription",type:"Ascii"},271:{name:"Make",type:"Ascii"},272:{name:"Model",type:"Ascii"},273:{name:"StripOffsets",type:"Long"},274:{name:"Orientation",type:"Short"},277:{name:"SamplesPerPixel",type:"Short"},278:{name:"RowsPerStrip",type:"Long"},279:{name:"StripByteCounts",type:"Long"},282:{name:"XResolution",type:"Rational"},283:{name:"YResolution",type:"Rational"},284:{name:"PlanarConfiguration",type:"Short"},290:{name:"GrayResponseUnit",type:"Short"},291:{name:"GrayResponseCurve",type:"Short"},292:{name:"T4Options",type:"Long"},293:{name:"T6Options",type:"Long"},296:{name:"ResolutionUnit",type:"Short"},301:{name:"TransferFunction",type:"Short"},305:{name:"Software",type:"Ascii"},306:{name:"DateTime",type:"Ascii"},315:{name:"Artist",type:"Ascii"},316:{name:"HostComputer",type:"Ascii"},317:{name:"Predictor",type:"Short"},318:{name:"WhitePoint",type:"Rational"},319:{name:"PrimaryChromaticities",type:"Rational"},320:{name:"ColorMap",type:"Short"},321:{name:"HalftoneHints",type:"Short"},322:{name:"TileWidth",type:"Short"},323:{name:"TileLength",type:"Short"},324:{name:"TileOffsets",type:"Short"},325:{name:"TileByteCounts",type:"Short"},330:{name:"SubIFDs",type:"Long"},332:{name:"InkSet",type:"Short"},333:{name:"InkNames",type:"Ascii"},334:{name:"NumberOfInks",type:"Short"},336:{name:"DotRange",type:"Byte"},337:{name:"TargetPrinter",type:"Ascii"},338:{name:"ExtraSamples",type:"Short"},339:{name:"SampleFormat",type:"Short"},340:{name:"SMinSampleValue",type:"Short"},341:{name:"SMaxSampleValue",type:"Short"},342:{name:"TransferRange",type:"Short"},343:{name:"ClipPath",type:"Byte"},344:{name:"XClipPathUnits",type:"Long"},345:{name:"YClipPathUnits",type:"Long"},346:{name:"Indexed",type:"Short"},347:{name:"JPEGTables",type:"Undefined"},351:{name:"OPIProxy",type:"Short"},512:{name:"JPEGProc",type:"Long"},513:{name:"JPEGInterchangeFormat",type:"Long"},514:{name:"JPEGInterchangeFormatLength",type:"Long"},515:{name:"JPEGRestartInterval",type:"Short"},517:{name:"JPEGLosslessPredictors",type:"Short"},518:{name:"JPEGPointTransforms",type:"Short"},519:{name:"JPEGQTables",type:"Long"},520:{name:"JPEGDCTables",type:"Long"},521:{name:"JPEGACTables",type:"Long"},529:{name:"YCbCrCoefficients",type:"Rational"},530:{name:"YCbCrSubSampling",type:"Short"},531:{name:"YCbCrPositioning",type:"Short"},532:{name:"ReferenceBlackWhite",type:"Rational"},700:{name:"XMLPacket",type:"Byte"},18246:{name:"Rating",type:"Short"},18249:{name:"RatingPercent",type:"Short"},32781:{name:"ImageID",type:"Ascii"},33421:{name:"CFARepeatPatternDim",type:"Short"},33422:{name:"CFAPattern",type:"Byte"},33423:{name:"BatteryLevel",type:"Rational"},33432:{name:"Copyright",type:"Ascii"},33434:{name:"ExposureTime",type:"Rational"},34377:{name:"ImageResources",type:"Byte"},34665:{name:"ExifTag",type:"Long"},34675:{name:"InterColorProfile",type:"Undefined"},34853:{name:"GPSTag",type:"Long"},34857:{name:"Interlace",type:"Short"},34858:{name:"TimeZoneOffset",type:"Long"},34859:{name:"SelfTimerMode",type:"Short"},37387:{name:"FlashEnergy",type:"Rational"},37388:{name:"SpatialFrequencyResponse",type:"Undefined"},37389:{name:"Noise",type:"Undefined"},37390:{name:"FocalPlaneXResolution",type:"Rational"},37391:{name:"FocalPlaneYResolution",type:"Rational"},37392:{name:"FocalPlaneResolutionUnit",type:"Short"},37393:{name:"ImageNumber",type:"Long"},37394:{name:"SecurityClassification",type:"Ascii"},37395:{name:"ImageHistory",type:"Ascii"},37397:{name:"ExposureIndex",type:"Rational"},37398:{name:"TIFFEPStandardID",type:"Byte"},37399:{name:"SensingMethod",type:"Short"},40091:{name:"XPTitle",type:"Byte"},40092:{name:"XPComment",type:"Byte"},40093:{name:"XPAuthor",type:"Byte"},40094:{name:"XPKeywords",type:"Byte"},40095:{name:"XPSubject",type:"Byte"},50341:{name:"PrintImageMatching",type:"Undefined"},50706:{name:"DNGVersion",type:"Byte"},50707:{name:"DNGBackwardVersion",type:"Byte"},50708:{name:"UniqueCameraModel",type:"Ascii"},50709:{name:"LocalizedCameraModel",type:"Byte"},50710:{name:"CFAPlaneColor",type:"Byte"},50711:{name:"CFALayout",type:"Short"},50712:{name:"LinearizationTable",type:"Short"},50713:{name:"BlackLevelRepeatDim",type:"Short"},50714:{name:"BlackLevel",type:"Rational"},50715:{name:"BlackLevelDeltaH",type:"SRational"},50716:{name:"BlackLevelDeltaV",type:"SRational"},50717:{name:"WhiteLevel",type:"Short"},50718:{name:"DefaultScale",type:"Rational"},50719:{name:"DefaultCropOrigin",type:"Short"},50720:{name:"DefaultCropSize",type:"Short"},50721:{name:"ColorMatrix1",type:"SRational"},50722:{name:"ColorMatrix2",type:"SRational"},50723:{name:"CameraCalibration1",type:"SRational"},50724:{name:"CameraCalibration2",type:"SRational"},50725:{name:"ReductionMatrix1",type:"SRational"},50726:{name:"ReductionMatrix2",type:"SRational"},50727:{name:"AnalogBalance",type:"Rational"},50728:{name:"AsShotNeutral",type:"Short"},50729:{name:"AsShotWhiteXY",type:"Rational"},50730:{name:"BaselineExposure",type:"SRational"},50731:{name:"BaselineNoise",type:"Rational"},50732:{name:"BaselineSharpness",type:"Rational"},50733:{name:"BayerGreenSplit",type:"Long"},50734:{name:"LinearResponseLimit",type:"Rational"},50735:{name:"CameraSerialNumber",type:"Ascii"},50736:{name:"LensInfo",type:"Rational"},50737:{name:"ChromaBlurRadius",type:"Rational"},50738:{name:"AntiAliasStrength",type:"Rational"},50739:{name:"ShadowScale",type:"SRational"},50740:{name:"DNGPrivateData",type:"Byte"},50741:{name:"MakerNoteSafety",type:"Short"},50778:{name:"CalibrationIlluminant1",type:"Short"},50779:{name:"CalibrationIlluminant2",type:"Short"},50780:{name:"BestQualityScale",type:"Rational"},50781:{name:"RawDataUniqueID",type:"Byte"},50827:{name:"OriginalRawFileName",type:"Byte"},50828:{name:"OriginalRawFileData",type:"Undefined"},50829:{name:"ActiveArea",type:"Short"},50830:{name:"MaskedAreas",type:"Short"},50831:{name:"AsShotICCProfile",type:"Undefined"},50832:{name:"AsShotPreProfileMatrix",type:"SRational"},50833:{name:"CurrentICCProfile",type:"Undefined"},50834:{name:"CurrentPreProfileMatrix",type:"SRational"},50879:{name:"ColorimetricReference",type:"Short"},50931:{name:"CameraCalibrationSignature",type:"Byte"},50932:{name:"ProfileCalibrationSignature",type:"Byte"},50934:{name:"AsShotProfileName",type:"Byte"},50935:{name:"NoiseReductionApplied",type:"Rational"},50936:{name:"ProfileName",type:"Byte"},50937:{name:"ProfileHueSatMapDims",type:"Long"},50938:{name:"ProfileHueSatMapData1",type:"Float"},50939:{name:"ProfileHueSatMapData2",type:"Float"},50940:{name:"ProfileToneCurve",type:"Float"},50941:{name:"ProfileEmbedPolicy",type:"Long"},50942:{name:"ProfileCopyright",type:"Byte"},50964:{name:"ForwardMatrix1",type:"SRational"},50965:{name:"ForwardMatrix2",type:"SRational"},50966:{name:"PreviewApplicationName",type:"Byte"},50967:{name:"PreviewApplicationVersion",type:"Byte"},50968:{name:"PreviewSettingsName",type:"Byte"},50969:{name:"PreviewSettingsDigest",type:"Byte"},50970:{name:"PreviewColorSpace",type:"Long"},50971:{name:"PreviewDateTime",type:"Ascii"},50972:{name:"RawImageDigest",type:"Undefined"},50973:{name:"OriginalRawFileDigest",type:"Undefined"},50974:{name:"SubTileBlockSize",type:"Long"},50975:{name:"RowInterleaveFactor",type:"Long"},50981:{name:"ProfileLookTableDims",type:"Long"},50982:{name:"ProfileLookTableData",type:"Float"},51008:{name:"OpcodeList1",type:"Undefined"},51009:{name:"OpcodeList2",type:"Undefined"},51022:{name:"OpcodeList3",type:"Undefined"}},Exif:{33434:{name:"ExposureTime",type:"Rational"},33437:{name:"FNumber",type:"Rational"},34850:{name:"ExposureProgram",type:"Short"},34852:{name:"SpectralSensitivity",type:"Ascii"},34855:{name:"ISOSpeedRatings",type:"Short"},34856:{name:"OECF",type:"Undefined"},34864:{name:"SensitivityType",type:"Short"},34865:{name:"StandardOutputSensitivity",type:"Long"},34866:{name:"RecommendedExposureIndex",type:"Long"},34867:{name:"ISOSpeed",type:"Long"},34868:{name:"ISOSpeedLatitudeyyy",type:"Long"},34869:{name:"ISOSpeedLatitudezzz",type:"Long"},36864:{name:"ExifVersion",type:"Undefined"},36867:{name:"DateTimeOriginal",type:"Ascii"},36868:{name:"DateTimeDigitized",type:"Ascii"},37121:{name:"ComponentsConfiguration",type:"Undefined"},37122:{name:"CompressedBitsPerPixel",type:"Rational"},37377:{name:"ShutterSpeedValue",type:"SRational"},37378:{name:"ApertureValue",type:"Rational"},37379:{name:"BrightnessValue",type:"SRational"},37380:{name:"ExposureBiasValue",type:"SRational"},37381:{name:"MaxApertureValue",type:"Rational"},37382:{name:"SubjectDistance",type:"Rational"},37383:{name:"MeteringMode",type:"Short"},37384:{name:"LightSource",type:"Short"},37385:{name:"Flash",type:"Short"},37386:{name:"FocalLength",type:"Rational"},37396:{name:"SubjectArea",type:"Short"},37500:{name:"MakerNote",type:"Undefined"},37510:{name:"UserComment",type:"Ascii"},37520:{name:"SubSecTime",type:"Ascii"},37521:{name:"SubSecTimeOriginal",type:"Ascii"},37522:{name:"SubSecTimeDigitized",type:"Ascii"},40960:{name:"FlashpixVersion",type:"Undefined"},40961:{name:"ColorSpace",type:"Short"},40962:{name:"PixelXDimension",type:"Long"},40963:{name:"PixelYDimension",type:"Long"},40964:{name:"RelatedSoundFile",type:"Ascii"},40965:{name:"InteroperabilityTag",type:"Long"},41483:{name:"FlashEnergy",type:"Rational"},41484:{name:"SpatialFrequencyResponse",type:"Undefined"},41486:{name:"FocalPlaneXResolution",type:"Rational"},41487:{name:"FocalPlaneYResolution",type:"Rational"},41488:{name:"FocalPlaneResolutionUnit",type:"Short"},41492:{name:"SubjectLocation",type:"Short"},41493:{name:"ExposureIndex",type:"Rational"},41495:{name:"SensingMethod",type:"Short"},41728:{name:"FileSource",type:"Undefined"},41729:{name:"SceneType",type:"Undefined"},41730:{name:"CFAPattern",type:"Undefined"},41985:{name:"CustomRendered",type:"Short"},41986:{name:"ExposureMode",type:"Short"},41987:{name:"WhiteBalance",type:"Short"},41988:{name:"DigitalZoomRatio",type:"Rational"},41989:{name:"FocalLengthIn35mmFilm",type:"Short"},41990:{name:"SceneCaptureType",type:"Short"},41991:{name:"GainControl",type:"Short"},41992:{name:"Contrast",type:"Short"},41993:{name:"Saturation",type:"Short"},41994:{name:"Sharpness",type:"Short"},41995:{name:"DeviceSettingDescription",type:"Undefined"},41996:{name:"SubjectDistanceRange",type:"Short"},42016:{name:"ImageUniqueID",type:"Ascii"},42032:{name:"CameraOwnerName",type:"Ascii"},42033:{name:"BodySerialNumber",type:"Ascii"},42034:{name:"LensSpecification",type:"Rational"},42035:{name:"LensMake",type:"Ascii"},42036:{name:"LensModel",type:"Ascii"},42037:{name:"LensSerialNumber",type:"Ascii"},42240:{name:"Gamma",type:"Rational"}},GPS:{0:{name:"GPSVersionID",type:"Byte"},1:{name:"GPSLatitudeRef",type:"Ascii"},2:{name:"GPSLatitude",type:"Rational"},3:{name:"GPSLongitudeRef",type:"Ascii"},4:{name:"GPSLongitude",type:"Rational"},5:{name:"GPSAltitudeRef",type:"Byte"},6:{name:"GPSAltitude",type:"Rational"},7:{name:"GPSTimeStamp",type:"Rational"},8:{name:"GPSSatellites",type:"Ascii"},9:{name:"GPSStatus",type:"Ascii"},10:{name:"GPSMeasureMode",type:"Ascii"},11:{name:"GPSDOP",type:"Rational"},12:{name:"GPSSpeedRef",type:"Ascii"},13:{name:"GPSSpeed",type:"Rational"},14:{name:"GPSTrackRef",type:"Ascii"},15:{name:"GPSTrack",type:"Rational"},16:{name:"GPSImgDirectionRef",type:"Ascii"},17:{name:"GPSImgDirection",type:"Rational"},18:{name:"GPSMapDatum",type:"Ascii"},19:{name:"GPSDestLatitudeRef",type:"Ascii"},20:{name:"GPSDestLatitude",type:"Rational"},21:{name:"GPSDestLongitudeRef",type:"Ascii"},22:{name:"GPSDestLongitude",type:"Rational"},23:{name:"GPSDestBearingRef",type:"Ascii"},24:{name:"GPSDestBearing",type:"Rational"},25:{name:"GPSDestDistanceRef",type:"Ascii"},26:{name:"GPSDestDistance",type:"Rational"},27:{name:"GPSProcessingMethod",type:"Undefined"},28:{name:"GPSAreaInformation",type:"Undefined"},29:{name:"GPSDateStamp",type:"Ascii"},30:{name:"GPSDifferential",type:"Short"},31:{name:"GPSHPositioningError",type:"Rational"}},Interop:{1:{name:"InteroperabilityIndex",type:"Ascii"}}};y["0th"]=y.Image,y["1st"]=y.Image,p.TAGS=y,p.ImageIFD={ProcessingSoftware:11,NewSubfileType:254,SubfileType:255,ImageWidth:256,ImageLength:257,BitsPerSample:258,Compression:259,PhotometricInterpretation:262,Threshholding:263,CellWidth:264,CellLength:265,FillOrder:266,DocumentName:269,ImageDescription:270,Make:271,Model:272,StripOffsets:273,Orientation:274,SamplesPerPixel:277,RowsPerStrip:278,StripByteCounts:279,XResolution:282,YResolution:283,PlanarConfiguration:284,GrayResponseUnit:290,GrayResponseCurve:291,T4Options:292,T6Options:293,ResolutionUnit:296,TransferFunction:301,Software:305,DateTime:306,Artist:315,HostComputer:316,Predictor:317,WhitePoint:318,PrimaryChromaticities:319,ColorMap:320,HalftoneHints:321,TileWidth:322,TileLength:323,TileOffsets:324,TileByteCounts:325,SubIFDs:330,InkSet:332,InkNames:333,NumberOfInks:334,DotRange:336,TargetPrinter:337,ExtraSamples:338,SampleFormat:339,SMinSampleValue:340,SMaxSampleValue:341,TransferRange:342,ClipPath:343,XClipPathUnits:344,YClipPathUnits:345,Indexed:346,JPEGTables:347,OPIProxy:351,JPEGProc:512,JPEGInterchangeFormat:513,JPEGInterchangeFormatLength:514,JPEGRestartInterval:515,JPEGLosslessPredictors:517,JPEGPointTransforms:518,JPEGQTables:519,JPEGDCTables:520,JPEGACTables:521,YCbCrCoefficients:529,YCbCrSubSampling:530,YCbCrPositioning:531,ReferenceBlackWhite:532,XMLPacket:700,Rating:18246,RatingPercent:18249,ImageID:32781,CFARepeatPatternDim:33421,CFAPattern:33422,BatteryLevel:33423,Copyright:33432,ExposureTime:33434,ImageResources:34377,ExifTag:34665,InterColorProfile:34675,GPSTag:34853,Interlace:34857,TimeZoneOffset:34858,SelfTimerMode:34859,FlashEnergy:37387,SpatialFrequencyResponse:37388,Noise:37389,FocalPlaneXResolution:37390,FocalPlaneYResolution:37391,FocalPlaneResolutionUnit:37392,ImageNumber:37393,SecurityClassification:37394,ImageHistory:37395,ExposureIndex:37397,TIFFEPStandardID:37398,SensingMethod:37399,XPTitle:40091,XPComment:40092,XPAuthor:40093,XPKeywords:40094,XPSubject:40095,PrintImageMatching:50341,DNGVersion:50706,DNGBackwardVersion:50707,UniqueCameraModel:50708,LocalizedCameraModel:50709,CFAPlaneColor:50710,CFALayout:50711,LinearizationTable:50712,BlackLevelRepeatDim:50713,BlackLevel:50714,BlackLevelDeltaH:50715,BlackLevelDeltaV:50716,WhiteLevel:50717,DefaultScale:50718,DefaultCropOrigin:50719,DefaultCropSize:50720,ColorMatrix1:50721,ColorMatrix2:50722,CameraCalibration1:50723,CameraCalibration2:50724,ReductionMatrix1:50725,ReductionMatrix2:50726,AnalogBalance:50727,AsShotNeutral:50728,AsShotWhiteXY:50729,BaselineExposure:50730,BaselineNoise:50731,BaselineSharpness:50732,BayerGreenSplit:50733,LinearResponseLimit:50734,CameraSerialNumber:50735,LensInfo:50736,ChromaBlurRadius:50737,AntiAliasStrength:50738,ShadowScale:50739,DNGPrivateData:50740,MakerNoteSafety:50741,CalibrationIlluminant1:50778,CalibrationIlluminant2:50779,BestQualityScale:50780,RawDataUniqueID:50781,OriginalRawFileName:50827,OriginalRawFileData:50828,ActiveArea:50829,MaskedAreas:50830,AsShotICCProfile:50831,AsShotPreProfileMatrix:50832,CurrentICCProfile:50833,CurrentPreProfileMatrix:50834,ColorimetricReference:50879,CameraCalibrationSignature:50931,ProfileCalibrationSignature:50932,AsShotProfileName:50934,NoiseReductionApplied:50935,ProfileName:50936,ProfileHueSatMapDims:50937,ProfileHueSatMapData1:50938,ProfileHueSatMapData2:50939,ProfileToneCurve:50940,ProfileEmbedPolicy:50941,ProfileCopyright:50942,ForwardMatrix1:50964,ForwardMatrix2:50965,PreviewApplicationName:50966,PreviewApplicationVersion:50967,PreviewSettingsName:50968,PreviewSettingsDigest:50969,PreviewColorSpace:50970,PreviewDateTime:50971,RawImageDigest:50972,OriginalRawFileDigest:50973,SubTileBlockSize:50974,RowInterleaveFactor:50975,ProfileLookTableDims:50981,ProfileLookTableData:50982,OpcodeList1:51008,OpcodeList2:51009,OpcodeList3:51022,NoiseProfile:51041},p.ExifIFD={ExposureTime:33434,FNumber:33437,ExposureProgram:34850,SpectralSensitivity:34852,ISOSpeedRatings:34855,OECF:34856,SensitivityType:34864,StandardOutputSensitivity:34865,RecommendedExposureIndex:34866,ISOSpeed:34867,ISOSpeedLatitudeyyy:34868,ISOSpeedLatitudezzz:34869,ExifVersion:36864,DateTimeOriginal:36867,DateTimeDigitized:36868,ComponentsConfiguration:37121,CompressedBitsPerPixel:37122,ShutterSpeedValue:37377,ApertureValue:37378,BrightnessValue:37379,ExposureBiasValue:37380,MaxApertureValue:37381,SubjectDistance:37382,MeteringMode:37383,LightSource:37384,Flash:37385,FocalLength:37386,SubjectArea:37396,MakerNote:37500,UserComment:37510,SubSecTime:37520,SubSecTimeOriginal:37521,SubSecTimeDigitized:37522,FlashpixVersion:40960,ColorSpace:40961,PixelXDimension:40962,PixelYDimension:40963,RelatedSoundFile:40964,InteroperabilityTag:40965,FlashEnergy:41483,SpatialFrequencyResponse:41484,FocalPlaneXResolution:41486,FocalPlaneYResolution:41487,FocalPlaneResolutionUnit:41488,SubjectLocation:41492,ExposureIndex:41493,SensingMethod:41495,FileSource:41728,SceneType:41729,CFAPattern:41730,CustomRendered:41985,ExposureMode:41986,WhiteBalance:41987,DigitalZoomRatio:41988,FocalLengthIn35mmFilm:41989,SceneCaptureType:41990,GainControl:41991,Contrast:41992,Saturation:41993,Sharpness:41994,DeviceSettingDescription:41995,SubjectDistanceRange:41996,ImageUniqueID:42016,CameraOwnerName:42032,BodySerialNumber:42033,LensSpecification:42034,LensMake:42035,LensModel:42036,LensSerialNumber:42037,Gamma:42240},p.GPSIFD={GPSVersionID:0,GPSLatitudeRef:1,GPSLatitude:2,GPSLongitudeRef:3,GPSLongitude:4,GPSAltitudeRef:5,GPSAltitude:6,GPSTimeStamp:7,GPSSatellites:8,GPSStatus:9,GPSMeasureMode:10,GPSDOP:11,GPSSpeedRef:12,GPSSpeed:13,GPSTrackRef:14,GPSTrack:15,GPSImgDirectionRef:16,GPSImgDirection:17,GPSMapDatum:18,GPSDestLatitudeRef:19,GPSDestLatitude:20,GPSDestLongitudeRef:21,GPSDestLongitude:22,GPSDestBearingRef:23,GPSDestBearing:24,GPSDestDistanceRef:25,GPSDestDistance:26,GPSProcessingMethod:27,GPSAreaInformation:28,GPSDateStamp:29,GPSDifferential:30,GPSHPositioningError:31},p.InteropIFD={InteroperabilityIndex:1},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports.piexif=p):window.piexif=p}();var KfxWebSDK=KfxWebSDK||{version:"3.3.0.0.0.512",/**
     * @memberof KfxWebSDK
     * @readonly
     * @property {Number} MOBILE_ID Type of USA driver license
     * @property {Number} CHECK_DEPOSIT Type of deposit checks
     * @property {Number} BILL_PAY Type of pay bills
     * @property {Number} PASSPORT Type of international passports
     */
document:{MOBILE_ID:0,CHECK_DEPOSIT:1,BILL_PAY:2,PASSPORT:3},ERROR_CODE_STATE:0,ERROR_CODE_VALIDATION:1,ERROR_CODE_RUNTIME:2,ERROR_CODE_MEDIA:3,ERROR_CODE_CAPTURE:4,ERROR_CODE_PROCESS:5};!function(){var e=e||{};!function(){for(var t,i="KfxWebSDK.js",a="KfxWebSDKInternal.js",r=document.getElementsByTagName("script"),n=0;n<r.length;n++){if(t=r[n].src,t.indexOf(a)>-1){e.rootPath=t.replace(a,"")+"../";break}if(t.indexOf(i)>-1){e.rootPath=t.replace(i,"");break}}}(),e.Color=function(){"use strict";function e(e){return null!==e.match(n)}function t(e){return null!==e.match(o)}function i(e){return null!==e.match(s)}function a(e){return l.indexOf(e)>=0}function r(r){return e(r)||t(r)||i(r)||a(r)}var n=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,o=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,s=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"];return{isColor:r,isHexColor:e,isRgbaColor:t,isHslaColor:i,isCss3Color:a}}(),function(){"use strict";function t(e,t){this.code=e,this.name="InternalError",this.message=t||"",this.stack=(new Error).stack}function i(e){t.call(this,KfxWebSDK.ERROR_CODE_VALIDATION,e),this.name="ValidationError"}function a(e){t.call(this,KfxWebSDK.ERROR_CODE_STATE,e),this.name="StateError"}function r(e){t.call(this,KfxWebSDK.ERROR_CODE_MEDIA,e),this.name="UserMediaError"}function n(e){t.call(this,KfxWebSDK.ERROR_CODE_CAPTURE,e),this.name="CaptureError"}function o(e){t.call(this,KfxWebSDK.ERROR_CODE_PROCESS,e),this.name="ProcessError"}function s(e,i){var a={message:i.message,code:i instanceof t?i.code:KfxWebSDK.ERROR_CODE_RUNTIME,toString:function(){return i.message}};a.code===KfxWebSDK.ERROR_CODE_RUNTIME&&(a.stack=i.stack),e(a)}t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,i.prototype=Object.create(t.prototype),i.prototype.constructor=i,a.prototype=Object.create(t.prototype),a.prototype.constructor=a,r.prototype=Object.create(t.prototype),r.prototype.constructor=r,n.prototype=Object.create(t.prototype),n.prototype.constructor=n,o.prototype=Object.create(t.prototype),o.prototype.constructor=o,e.InternalError=t,e.ValidationError=i,e.StateError=a,e.UserMediaError=r,e.CaptureError=n,e.ProcessError=o,e.report=s}(),e.EXIF=function(){"use strict";function e(e,t,i,a,r){switch(r){case 5:case 6:case 7:case 8:e.width=a,e.height=i;break;default:e.width=i,e.height=a}switch(r){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,a),t.rotate(Math.PI);break;case 4:t.translate(0,a),t.scale(1,-1);break;case 5:t.rotate(.5*Math.PI),t.scale(1,-1);break;case 6:t.rotate(.5*Math.PI),t.translate(0,-a);break;case 7:t.rotate(.5*Math.PI),t.translate(i,-a),t.scale(-1,1);break;case 8:t.rotate(-.5*Math.PI),t.translate(-i,0)}}return{transformCoordinate:e}}(),function(){"use strict";e.Math={},e.Math.isNaN=function(e){return void 0===Number.isNaN?isNaN(e):Number.isNaN(e)},e.Math.isFinite=function(e){return void 0===Number.isNaN?isFinite(e):Number.isFinite(e)},e.Math.getXY=function(e,t){var i=Math.floor(e/t);return[e-i*t,i]},e.Math.getIx=function(e,t,i){return t*i+e},e.Math.getLongToShortAspectRatio=function(e){return 0===e?0:e>=1?e:1/e}}(),e.Type=function(){"use strict";function t(e){return"string"==typeof e}function i(e){return t(e)&&e.length>0}function a(e){return"boolean"==typeof e}function r(e){return"number"==typeof e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function o(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){return"function"==typeof e}function l(e){for(var t in c)if(c.hasOwnProperty(t)&&c[t](e))return t}function u(t,i){return e.Utils.isSet(t)&&t.toString().indexOf(i)>=0}var c={string:t,number:r,array:n,object:o,"boolean":a,"function":s};return{getType:l,checkInstance:u,isString:t,isNotEmptyString:i,isNumber:r,isArray:n,isObject:o,isBoolean:a,isFunction:s}}(),e.Utils=function(){"use strict";function t(t,a){if("[object Object]"!==Object.prototype.toString.call(t))throw new e.ValidationError("Options argument is not an key - value object instance");for(var r in t){var n=a[r];if(t.hasOwnProperty(r)&&void 0!==n&&void 0!==n.type){var o=t[r],s=typeof o;if(g(o)||void 0===n["default"]||null===n["default"]||(t[r]=n["default"]),!g(o))throw new e.ValidationError("Option "+r+" is not set");var l=n.type;if("string"==typeof l&&l!==s)throw new e.ValidationError("Option "+r+" is not a "+l+" type");if("object"==typeof l&&l.indexOf(s)<0)throw new e.ValidationError("Option "+r+" is not one of the following types "+l);if("object"===s&&n.color===!0){var u=o.toString();if(u.indexOf("CanvasPattern")<0&&u.indexOf("CanvasGradient")<0)throw new e.ValidationError("Option "+r+" value "+o+" is not a gradient or pattern object")}if("string"===s&&n.color===!0&&!e.Color.isColor(o))throw new e.ValidationError("Option "+r+" value "+o+" is not a valid color representation");if(("string"===s||"number"===s)&&Array.isArray(n.options)&&n.options.indexOf(o)<0)throw new e.ValidationError("Option "+r+" value "+o+" is not one of the following: "+n.options);if("string"===s&&"[object Object]"===Object.prototype.toString.call(n.html)){var c=document.getElementById(o);if(!c)throw new e.ValidationError("Option "+r+" value "+o+" no html element with such id found");if("string"==typeof n.html.tag&&c.tagName.toLowerCase()!==n.html.tag)throw new e.ValidationError("Option "+r+" value "+o+" is not a "+n.html.tag+" element");if(n.html.hasChild===!1&&c.childElementCount>0)throw new e.ValidationError("Option "+r+" value "+o+" html element with this id is not empty, it has "+c.childElementCount+" child elements")}if("number"===s){if(e.Math.isNaN(o))throw new e.ValidationError("Option "+r+" value "+o+" is not a number");if(!e.Math.isFinite(o))throw new e.ValidationError("Option "+r+" value "+o+" is a non-finite number");var f=void 0===n.min?void 0:n.min.value,h=void 0===n.max?void 0:n.max.value,d=void 0===n.min?void 0:n.min.include,p=void 0===n.max?void 0:n.max.include;i(r,o,f,d,h,p)}}}for(var r in a){var n=a[r],o=t[r];if(a.hasOwnProperty(r))if(g(o)||void 0===n["default"]||null===n["default"]){if(!g(o)&&n.mandatory===!0)throw new e.ValidationError("Mandatory option "+r+" is not set")}else t[r]=n["default"]}}function i(t,i,a,r,n,o){if(void 0!==a||void 0!==n){var s="Option "+t+" value "+i+" must be";if(void 0!==a&&void 0!==n?s+=" in the range "+a+(r?" <= ":" < ")+"value"+(o?" <= ":" < ")+n:void 0!==a&&void 0===n?s+=(r?" >= ":" > ")+a:void 0===a&&void 0!==n&&(s+=(o?" <= ":" < ")+n),void 0!==a)if(r){if(i<a)throw new e.ValidationError(s)}else if(i<=a)throw new e.ValidationError(s);if(void 0!==n)if(o){if(i>n)throw new e.ValidationError(s)}else if(i>=n)throw new e.ValidationError(s)}}function a(e){var t={};for(var i in e)e.hasOwnProperty(i)&&("object"==typeof e[i]?t[i]=a(e[i]):t[i]=e[i]);return t}function r(e,t,i){if(void 0!==t)for(var a in e)if(e.hasOwnProperty(a))if("object"!=typeof e[a]){if(void 0===t[a]?e[a]=void 0===e[a]?i[a]:e[a]:e[a]=t[a],void 0===e[a])throw new Error("Parameter "+a+" is not defined")}else r(e[a],t[a],i[a])}function n(e,t){for(var i in e)if(e.hasOwnProperty(i)&&(e[i]=t[i],void 0===e[i]))throw new Error("Parameter "+i+" is not defined")}function o(e,t){if(void 0===e||0===Object.keys(e).length)throw new Error("Callbacks are not defined");if(void 0===t){for(var i in e)if(e.hasOwnProperty(i)&&"function"!=typeof e[i])throw new Error("Callback "+i+" is not defined")}else for(var a=0;a<t.length;a++)if("function"!=typeof e[t[a]])throw new Error("Callback "+t[a]+" is not defined")}function s(t,i){return e.Type.isNotEmptyString(i)&&Object.prototype.toString.call(t).indexOf(i)>=0}function l(t,i,a){if(void 0===i||null===i)throw new e.ValidationError("Argument "+t+" is undefined or null");if(!s(i,a))throw new e.ValidationError("Argument "+t+" is not a "+a+" instance")}function u(t,i){if(l(t,i,"ImageData"),i.width<=0||i.height<=0)throw new e.ValidationError("Argument "+t+" is image data with invalid dimensions, width and height must be > 0")}function c(t,i){if(l(t,i,"HTMLImageElement"),i.width<=0||i.height<=0)throw new e.ValidationError("Argument "+t+" is html image element with invalid dimensions, width and height must be > 0")}function f(e){return null!==e&&"undefined"!=typeof e&&0!=e.length}function h(e,t){d(e,"kfx-hidden",!t)}function d(e,t,i){if("undefined"==typeof i)return void e.classList.toggle(t);var a=i?"add":"remove";e.classList[a](t)}function p(e,t){var i=document.createElement(e);return i.className=t,i}function m(e){for(var t=0;t<e.length;++t){var i=e[t];i()}}function g(e){return void 0!==e&&null!==e}function v(t){return e.rootPath+"Images/"+t}function y(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}function S(){var e=null;e=new Date;var t=e.getUTCFullYear(),i=e.getUTCMonth()+1;1==i.length&&(i="0"+i);var a=e.getUTCDate();return 1==a.length&&(a="0"+a),t+"-"+i+"-"+a+" "+e.getUTCHours()+":"+e.getUTCMinutes()+":"+e.getUTCSeconds()+"."+e.getUTCMilliseconds()}function w(){var e=new Date,t=e.toTimeString();return t=t.substring(t.lastIndexOf("(")+1,t.lastIndexOf(")"))}function b(){var e=navigator.appVersion,t=e.substring(e.indexOf("(")+1,e.indexOf(")"));return t}function P(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function _(e){try{JSON.parse(e)}catch(t){return!1}return!0}function T(){var e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return e}return{toggleElement:h,toggleClass:d,createElement:p,getOptions:a,setOptions:r,resetOptions:n,isSet:g,isClassInstance:s,verifyArgument:l,verifyCallbacks:o,verifyImageData:u,verifyHtmlImageElement:c,validateOptions:t,verifyString:f,notifyListeners:m,getImageUrl:v,removeAllChildren:y,getDeviceModel:b,getCurrentDateTime:S,getTimeZone:w,guid:P,isJSONValid:_,isIOSDevice:T}}(),e.ImageUtils=function(){"use strict";function e(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,i}function t(t,i){var a=e(t,i);return a.getContext("2d").getImageData(0,0,t,i)}function i(t){var i=e(t.width,t.height);return i.getContext("2d").putImageData(t,0,0),i}function a(t,i,a){var r=Math.sqrt(t*i/a),n=1/r,o=Math.floor(t/r),s=Math.floor(i/r),l=e(o,s),u=l.getContext("2d");return u.scale(n,n),{scaleFactor:r,context:u,width:o,height:s}}function r(e,t){var r=e.width,n=e.height,o={},s=a(r,n,t);o.scaleFactor=s.scaleFactor;var l=s.context,u=i(e);return l.drawImage(u,0,0,r,n),o.imageData=l.getImageData(0,0,s.width,s.height),o}function n(e){var t=e.mean;return o(e,Math.max(0,Math.floor(.15*t)),Math.min(255,Math.floor(.87*t)))}function o(e,t,i){jsfeat.imgproc.canny(e,e,t,i);for(var a=e.cols*e.rows,r=new Array(a),n=0;n<a;n++)r[n]=e.data[n];return r}function s(e,t){var i=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),a=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),r=new jsfeat.matrix_t(e.width,e.height,jsfeat.U8C1_t),n=e.data,o=n.length,s=e.width,l=e.height;i.resize(s,l,1),a.resize(s,l,1),r.resize(s,l,1);for(var u=i.data,c=a.data,f=r.data,h=[],d=0,p=0,m=0,g=s*l,v=0,y=0;v<o;v+=4,y++)u[y]=n[v],d+=u[y],c[y]=n[v+1],p+=c[y],f[y]=n[v+2],m+=f[y],h[y]=0;return jsfeat.imgproc.gaussian_blur(i,i,t),jsfeat.imgproc.gaussian_blur(a,a,t),jsfeat.imgproc.gaussian_blur(r,r,t),i.mean=Math.round(d/g),a.mean=Math.round(p/g),r.mean=Math.round(m/g),[i,a,r,h]}function l(e,t,i){for(var a=Number.MAX_VALUE,r=-a,n=Number.MAX_VALUE,o=-n,s=0;s<i;s++)for(var l=0;l<t;l++)e[s*t+l]>0&&(a=Math.min(a,l),r=Math.max(r,l),n=Math.min(n,s),o=Math.max(o,s));return[[a,n],[r,o]]}function u(e,t,i,a){var r=void 0===a?0:a,n=Math.ceil(Math.max(0,i[0][0]-r)),o=Math.ceil(Math.max(0,i[0][1]-r)),s=Math.floor(Math.min(e,i[1][0]+r)),l=Math.floor(Math.min(t,i[1][1]+r));return[n,o,s-n,l-o]}function c(e,t,i){if(e*t<i)throw new Error("Image size "+e+" * "+t+" is less than required "+i)}return{adaptiveCanny:n,getRgbWithBlur:s,getScalingData:a,scaleToPixelSize:r,createEmptyCanvas:e,convertImageDataToCanvas:i,createEmptyImageData:t,getROICropData:u,getBound:l,checkMinSize:c}}(),function(){"use strict";e.LineUtils={},e.LineUtils.getDivineAngle=function(t,i,a){var r=e.LineUtils.getLinesAngle(i,t),n=e.LineUtils.getLinesAngle(a,t);return Math.min(Math.abs(r-n),Math.abs(180-r-n))},e.LineUtils.getParallelLineByPoint=function(t,i){return i.checkPoint(t)?i:new e.LinePolar(t[0]*i.cos+t[1]*i.sin,i.angle)},e.LineUtils.getPointsOnLineByLengthFromAnotherPoint=function(e,t,i){var a=t[0],r=t[1];if(e.isHorizontal)return[[a-i,r],[a+i,r]];if(e.isVertical)return[[a,r-i],[a,r+i]];var n=e.k,o=e.b,s=o-r,l=n*n+1,u=2*(s*n-a),c=s*s+a*a-i*i,f=Math.sqrt(u*u-4*l*c),h=(-u+f)/(2*l),d=n*h+o,p=(-u-f)/(2*l),m=n*p+o;return[[h,d],[p,m]]},e.LineUtils.getLinesDistance=function(e,t){var i;return i=e.north&&t.south||t.north&&e.south?Math.abs(t.rho)+Math.abs(e.rho):Math.abs(Math.abs(t.rho)-Math.abs(e.rho))},e.LineUtils.getLinePolarByPoints=function(t,i){if(i[0]===t[0])return new e.LinePolar(t[0],0);if(i[1]===t[1])return new e.LinePolar(t[1],Math.PI/2);var a=(i[1]-t[1])/(i[0]-t[0]),r=Math.atan(a)+Math.PI/2,n=i[1]-a*i[0],o=n*Math.sin(r);return new e.LinePolar(o,r)},e.LineUtils.getLinesAngle=function(e,t){var i=Math.abs(e.t-t.t);return Math.min(i,180-i)},e.LineUtils.getLinesByAngle=function(e,t,i){for(var a,r=[],n=0;n<e.length;n++)a=Math.abs(e[n].t-t),Math.min(a,180-a)<=i&&r.push(e[n]);return r}}(),function(){"use strict";e.PointUtils={};var t=function(e,t){var i=e[0]-t[0],a=e[1]-t[1];return i*i+a*a},i=function(e,i){return Math.sqrt(t(e,i))};e.PointUtils.getDistance=i,e.PointUtils.getSquareDistance=t,e.PointUtils.getBound=function(e){for(var t,i,a,r=Number.MAX_VALUE,n=-r,o=Number.MAX_VALUE,s=-o,l=0;l<e.length;l++)t=e[l],i=t[0],a=t[1],r=Math.min(r,i),n=Math.max(n,i),o=Math.min(o,a),s=Math.max(s,a);return[[r,o],[n,s]]},e.PointUtils.roundToPoint=function(e,i){for(var a,r,n=Math.floor(e[0]),o=Math.ceil(e[0]),s=Math.floor(e[1]),l=Math.ceil(e[1]),u=[[n,s],[n,l],[o,s],[o,l]],c=0,f=Number.MAX_VALUE;c<u.length;c++)r=t(u[c],i),f>r&&(a=u[c],f=r);return a},e.PointUtils.getOutOfSpaceLength=function(e,t,i){var a=e[0],r=e[1];return Math.max(a<0?-a:a>t?a-t:0,r<0?-r:r>i?r-i:0)},e.PointUtils.scale=function(e,t){return void 0===t&&(t=1),[t*e[0],t*e[1]]},e.PointUtils.scaleAll=function(t,i){for(var a=[],r=e.PointUtils.scale,n=0;n<t.length;n++)a.push(r(t[n],i));return a},e.PointUtils.equals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.PointUtils.approximatePointToLineDistance=function(e,t,i){return(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0])},e.PointUtils.subtract=function(e,t){var a=i(e,t);return[(e[0]-t[0])/a,(e[1]-t[1])/a]},e.PointUtils.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]}}(),function(){"use strict";function t(){this.shutterSound=document.createElement("audio"),this.shutterSound.src=e.rootPath+"Resources/shutter.mp3";var t=this,i=function(){t.shutterSound.load(),window.removeEventListener("keydown",i),window.removeEventListener("mousedown",i),window.removeEventListener("touchstart",i)};window.addEventListener("keydown",i),window.addEventListener("mousedown",i),window.addEventListener("touchstart",i)}t.prototype.playShutterSound=function(){this.shutterSound.load(),this.shutterSound.play()},t.prototype.pauseShutterSound=function(){this.shutterSound.pause()},e.AutoLoadAudio=t}(),e.Resources=function(){"use strict";function t(e,t){o?n.enumerateDevices().then(i.bind(arguments))["catch"](t):r?MediaStreamTrack.getSources(a.bind(arguments)):t()}function i(e){for(var t,i,a,r=0,n=0,o=0;o<e.length;o++)if(a=e[o],"videoinput"===a.kind){if(r++,t=a.deviceId,void 0===a.label||0===a.label.length){n++;continue}a.label.indexOf("back")>=0&&(i=a.deviceId)}var s=void 0===i?t:i;this[0](s,r>0&&r===n)}function a(e){for(var t,i,a,r=0;r<e.length;r++)a=e[r],"video"===a.kind&&(t=a.id,"environment"===a.facing&&(i=a.id));var n=void 0===i?t:i;this[0](n,!1)}var r,n=navigator.mediaDevices,o=void 0!==n&&e.Type.isFunction(n.enumerateDevices);try{r=e.Type.isFunction(MediaStreamTrack.getSources)}catch(s){r=!1}return{load:t}}(),function(){"use strict";function t(e){this.stream=e,this.firefoxStreamTimeout=null}function i(e,t){var i=this,a=i.stream.currentTime;i.firefoxStreamTimeout=setTimeout(function(){(a===i.stream.currentTime?t:e)(),i.firefoxStreamTimeout=null},100)}var a="Camera has been disabled because of security policies";t.prototype.configure=function(e,t,r){try{e.src=compatibility.URL.createObjectURL(this.stream)}catch(n){e.srcObject=this.stream}var o=this,s=o.stream;e.onloadedmetadata=function(){if(s.active===!1)return void r(a);if(void 0===s.active&&void 0!==s.currentTime){var n=function(){t(e.videoWidth,e.videoHeight)},l=function(){r(a)};return void i(n,l).call(o)}t()}},t.prototype.destroy=function(){if(this.stream)for(var e=this.stream.getVideoTracks(),t=0;t<e.length;t++)e[t].stop();this.firefoxStreamTimeout&&clearTimeout(this.firefoxStreamTimeout),this.stream=null,this.firefoxStreamTimeout=null},e.Stream=t}(),function(){function t(e){this.video=e,this.stream=null}function i(t,s){if(n>=r.length)return void s(u);var l=r[n],c={video:{mandatory:{minWidth:l.width,minHeight:l.height}},audio:!1};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?c={video:{width:{min:l.width,ideal:l.width},height:{min:l.height,ideal:l.height},facingMode:{exact:"environment"}},audio:!1}:void 0===a||o?(a&&(c.video.optional=[{sourceId:a}]),c.video.facingMode={exact:"environment"}):c.video.optional=[{sourceId:a}];var f=this,h=function(i){f.stream=new e.Stream(i),f.stream.configure(f.video,t,s)},d=function(){n++,i.call(f,t,s)};try{compatibility.getUserMedia(c,h,d)}catch(p){d()}}var a,r=[{width:1920,height:1080}],n=0,o=!1,s=!1,l=!1,u="Camera can not be configured for FHD resolution";t.prototype.configure=function(t,r){if(s)return void r(u);var n=this;l?i.call(n,t,r):e.Resources.load(function(e,s){a=e,o=s,l=!0,i.call(n,t,r)},function(){s=!0,l=!0})},t.prototype.destroy=function(){null!==this.stream&&this.stream.destroy(),this.stream=null,this.video.pause(),this.video.src="",this.video=null},e.UserMediaManager=t}(),function(){"use strict";function t(e){removeEventListener("deviceorientation",t,!1),a=e&&null!==e.alpha}function i(){function e(e){if(e=Math.abs(e),e>90&&(e=180-e),e<0||e>90)throw new Error("LevelSensor: wrong angle calculations");return e}function t(t){for(var i=e(t.beta),a=e(t.gamma),r=Math.max(i,a),n=0;n<s.length;++n){var o=s[n];o({angle:r,beta:t.beta,gamma:t.gamma})}}function i(){addEventListener("deviceorientation",t,!1)}function r(){removeEventListener("deviceorientation",t,!1)}function n(e){s.indexOf(e)===-1&&(s.push(e),a?1===s.length&&i():e(null))}function o(e){var t=s.indexOf(e);t!==-1&&(s.splice(t,1),0===s.length&&r())}var s=[];this.addListener=n,this.removeListener=o}var a=null;addEventListener("deviceorientation",t,!1),e.LevelSensor=i}(),e.AppStats=function(){"use strict";function o(){this.SessionKey=null,this.EnvironmentID="",this.DismissalTime="",this.InstanceID="",this.InstanceType=null,this.CreationTime=null}function s(){function e(){this.Environments=[],this.SessionEvents=[],this.Images=[],this.Instances=[],this.CaptureEvents=[],this.FieldChangeEvents=[],this.ImageProcessorEvents=[]}this.AppStatisticsVersion="",this.AppStatisticsTables=new e}function l(){this.Type="",this.SessionKey="test",this.EnvironmentID="",this.DocumentID=null,this.Category="",this.Response="",this.EventTime="",this.ID=""}function u(){this.OSVersion="",this.Carrier="",this.Model="",this.SDKVersion="",this.OSName="HTML5",this.TimeZone="",this.Memory="",this.Language="",this.Manufacturer="",this.ID="",this.DeviceID=""}function S(e){if(h&&h.length>0)for(var t=0;t<h.length;t++)e.AppStatisticsTables.Environments.push(h[t])}function b(e){if(d&&d.length>0)for(var t=0;t<d.length;t++)e.AppStatisticsTables.SessionEvents.push(d[t])}function _(e){if(v&&v.length>0)for(var t=0;t<v.length;t++)e.AppStatisticsTables.Images.push(v[t])}function T(e){if(p&&p.length>0)for(var t=0;t<p.length;t++)e.AppStatisticsTables.Instances.push(p[t])}function C(e){if(g&&g.length>0)for(var t=0;t<g.length;t++)e.AppStatisticsTables.CaptureEvents.push(g[t])}function A(e){if(m&&m.length>0)for(var t=0;t<m.length;t++)e.AppStatisticsTables.FieldChangeEvents.push(m[t])}function x(e){if(y&&y.length>0)for(var t=0;t<y.length;t++)e.AppStatisticsTables.ImageProcessorEvents.push(y[t])}var E=null,D=function(e,t){h&&h.length>0&&(h=[]),h.push(L()),I=P.APP_STATS_INITIALIZED,"function"==typeof e&&e(I)},R=function(r,n,o){var s=new l;s.Type=r,s.SessionKey=t,s.EnvironmentID=a,o?s.DocumentID=o:s.DocumentID="",s.Category=i,s.Response=n,s.EventTime=e.Utils.getCurrentDateTime(),s.ID=e.Utils.guid(),"BeginSession"===r&&(c=s.ID),d.push(s)},M=function(e,t){var i=new s;i.AppStatisticsVersion=KfxWebSDK.version,S(i),b(i),_(i),T(i),C(i),A(i),x(i),"function"==typeof e&&(I=P.APP_STATS_INITIALIZED,e(i),k())},L=function(){return E=new u,E.OSVersion="",E.Carrier="",E.Model=e.Utils.getDeviceModel(),E.SDKVersion=KfxWebSDK.version,E.OSName="HTML5",E.TimeZone=e.Utils.getTimeZone(),E.Memory="",E.Language=navigator.language,E.Manufacturer="",E.ID=e.Utils.guid(),E.DeviceID="",a=E.ID,E},O=function(i){if(f){var s=new o;t?s.SessionKey=t:s.SessionKey="",s.EnvironmentID=a,s.DismissalTime="",s.InstanceID=e.Utils.guid(),i&&(s.InstanceType=i,i===w.CAPTURE?r=s.InstanceID:i===w.PROCESS&&(n=s.InstanceID)),s.CreationTime=e.Utils.getCurrentDateTime(),p.push(s)}},k=function(){d&&d.length>0&&(d=[]),p&&p.length>0&&(p=[]),h&&h.length>0&&(h=[]),c="",e.CaptureEventAppStats.cleanUpData(),e.LogisticsEventAppStats.cleanUpData(),e.ProcessEventAppStats.cleanUpData()};return{initAppStats:D,logSessionEvent:R,exportAppStats:M,prepareEnvironment:L,prepareInstance:O,cleanUpData:k}}();var t,i,a,r,n,o,s,l,u,c,f=!1,h=[],d=[],p=[],m=[],g=[],v=[],y=[],S={BITONAL:"Process Bitonal",AUTOCROP:"Process AutoCrop",SETDPI:"Process SetDPI",SCALE:"Process Scale"},w={CAPTURE:"Image Capture",PROCESS:"Image Processor"},b={ADVANCE_CAPTURE:"Web Capture",CAPTURE_FALLBACK:"CaptureFallback",FORCE_TAKE_PICTURE:"Force Take Picture"};e.CaptureEventAppStats=function(){"use strict";function i(){this.EventType=null,this.SessionKey=null,this.ImageID=null,this.Value="",this.EventTime="",this.InstanceID="",this.ID=""}function n(){this.SessionKey="",this.EnvironmentID="",this.StoragePath="",this.DocumentID=null,this.FileSize="",this.Source=null,this.ID="",this.CreationTime=null}function o(){v&&v.length>0&&(v=[]),g&&g.length>0&&(g=[])}var s=function(a,n,o){if(f){var s=new i;a&&(s.EventType=a),t?s.SessionKey=t:s.SessionKey="",n?s.ImageID=n:s.ImageID="",o?s.Value=o:s.Value="",s.EventTime=e.Utils.getCurrentDateTime(),s.InstanceID=r,s.ID=e.Utils.guid(),g&&g.push(s)}},l=function(i,r,o,s){if(f){var l=new n;t?l.SessionKey=t:l.SessionKey="",a?l.EnvironmentID=a:l.EnvironmentID="",o?l.StoragePath=o:l.StoragePath="",l.DocumentID="",s?l.FileSize=s:l.FileSize="",r?l.Source=r:l.Source="",i?l.ID=i:l.ID="",l.CreationTime=e.Utils.getCurrentDateTime(),v&&v.push(l)}},u=function(t,i,a){f&&(t===e.Hints.FILL_AREA?s("FILL_AREA",i,1):t===e.Hints.ZOOM_IN?s("ZOOM_IN",i,1):t===e.Hints.ZOOM_OUT?s("ZOOM_OUT",i,1):t===e.Hints.CENTER?s("CENTER",i,1):t===e.Hints.ROTATE?s("ROTATE",i,1):t===e.Hints.HOLD_LEVEL?s("HOLD_LEVEL",i,1):t===e.Hints.HOLD_STEADY?s("HOLD_STEADY",i,1):t===e.Hints.CAPTURE_OK&&s("CAPTURE_OK",i,1))};return{logCaptureGuidanceEvents:u,logAppStats:s,logImageObject:l,cleanUpData:o}}(),e.LogisticsEventAppStats=function(){"use strict";function t(){this.IsValid="",this.ErrorDescription="",this.FormattingFailed=null,this.SessionEventID="",this.DocumentID="",this.FieldName="",this.EventTime="",this.ID="",this.OriginalValue="",this.Confidence=null,this.ChangedValue=""}function i(){m&&m.length>0&&(m=[])}var a=function(i){if(f&&(e.Utils.validateOptions(i,{IsValid:{type:"number",mandatory:!0,min:{value:0,include:!0},max:{value:1,include:!0}},ErrorDescription:{type:"string",mandatory:!1},DocumentID:{type:"string",mandatory:!0},FieldName:{type:"string",mandatory:!0},OriginalValue:{type:"string",mandatory:!0},Confidence:{type:"number",mandatory:!0,min:{value:0,include:!0},max:{value:100,include:!0}},ChangedValue:{type:"string",mandatory:!0}}),i)){var a=new t;a.IsValid=i.IsValid,i.ErrorDescription?a.ErrorDescription=i.ErrorDescription:a.ErrorDescription="",a.FormattingFailed="",c?a.SessionEventID=c:a.SessionEventID="",i.DocumentID?a.DocumentID=i.DocumentID:a.DocumentID="",i.FieldName?a.FieldName=i.FieldName:a.FieldName="",a.EventTime=e.Utils.getCurrentDateTime(),a.ID=e.Utils.guid(),i.OriginalValue?a.OriginalValue=i.OriginalValue:a.OriginalValue="",a.Confidence=i.Confidence,i.ChangedValue?a.ChangedValue=i.ChangedValue:a.ChangedValue="",m&&m.push(a)}};return{logAppStats:a,cleanUpData:i}}(),e.ProcessEventAppStats=function(){"use strict";function i(){this.StartTime=null,this.ProcessingProfile="",this.SessionKey=null,this.StopTime=null,this.ResultCode="",this.ProcessedImageID="",this.InstanceID="",this.ID="",this.SourceImageID=""}function a(){y&&y.length>0&&(y=[])}var r=function(t){f&&(e.AppStats.prepareInstance(w.PROCESS),t===S.BITONAL?o=e.Utils.getCurrentDateTime():t===S.AUTOCROP?s=e.Utils.getCurrentDateTime():t===S.SETDPI?l=e.Utils.getCurrentDateTime():t===S.SCALE&&(u=e.Utils.getCurrentDateTime()))},c=function(a){if(f&&(e.CaptureEventAppStats.logImageObject("","Image",""),a)){var r=new i;a.ProcessingProfile===S.BITONAL?r.StartTime=o:a.ProcessingProfile===S.AUTOCROP?r.StartTime=s:a.ProcessingProfile===S.SETDPI?r.StartTime=l:a.ProcessingProfile===S.SCALE&&(r.StartTime=u),a.ProcessingProfile?r.ProcessingProfile=a.ProcessingProfile:r.ProcessingProfile="",t?r.SessionKey=t:r.SessionKey="",r.StopTime=e.Utils.getCurrentDateTime(),a.ResultCode?r.ResultCode=a.ResultCode:r.ResultCode="",a.ProcessedImageID?r.ProcessedImageID=a.ProcessedImageID:r.ProcessedImageID="",r.InstanceID=n,a.SourceImageID?r.SourceImageID=a.SourceImageID:r.SourceImageID="",r.ID=e.Utils.guid(),y&&y.push(r)}};return{ImageProcessorEventJSON:i,logProcessStartTime:r,logAppStats:c,cleanUpData:a}}(),function(){function t(){this.state=n}var i="STATE_CREATED",a="STATE_STARTED",r="STATE_STOPPED",n="STATE_DESTROYED",o={create:[n],setOptions:[i,r],forceTakePicture:[a],choosePictureAsBase64:[i,r],takePicture:[i,r],stopCapture:[a],destroy:[i,r]};t.prototype.setCreatedState=function(){this.state=i},t.prototype.setStartedState=function(){this.state=a},t.prototype.setStoppedState=function(){this.state=r},t.prototype.setDestroyedState=function(){this.state=n},t.prototype.checkAction=function(t){if(o[t].indexOf(this.state)<0)throw new e.StateError("Call "+t+" is not allowed in state "+this.state)},e.StateManager=t}(),function(){"use strict";function t(e){this._image=e}function i(){}function a(){this._alphaExtractor=new i}function r(e){this._image=e,this._alphaExtractor=new i,this._sizeCalculator=new n(e)}function n(e){this._image=e,this._alphaExtractor=new i,this._width=null,this._height=null}function o(e){this._blob=e,this._subsamplingDetector=new a}var s=window.URL||window.webkitURL;t.prototype.draw=function(e){e.drawImage(this._image,0,0)},t.prototype.naturalWidth=function(){return this._image.naturalWidth},t.prototype.naturalHeight=function(){return this._image.naturalHeight},i.prototype.extract=function(e,t,i,a,r){var n=document.createElement("canvas");n.width=a,n.height=r;var o=n.getContext("2d");o.drawImage(e,-t,-i);for(var s=o.getImageData(0,0,n.width,n.height),l=s.data,u=new Uint8ClampedArray(a*r),c=3,f=0;c<l.length;c+=4,f+=1)u[f]=l[c];return u},a.prototype.isSubsampled=function(e,t){if(!this._isIos())return!1;if("image/jpeg"!==t)return!1;var i=this._alphaExtractor,a=e.naturalWidth,r=e.naturalHeight;if(a*r<=1048576)return!1;var n=i.extract(e,a-1,r-1,1,1);return 0===n[0]},a.prototype._isIos=function(){return window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)},r.prototype.hasData=function(){var e=this._alphaExtractor.extract(this._image,0,0,1,1);return e[0]>0},r.prototype.width=function(){return this._sizeCalculator.width()},r.prototype.height=function(){return this._sizeCalculator.height()},r.prototype.scale=function(){var e=this.width()/this._image.naturalWidth,t=this.height()/this._image.naturalHeight;return Math.min(e,t)},r.prototype.naturalWidth=function(){return this._image.naturalWidth*this.scale()},r.prototype.naturalHeight=function(){return this._image.naturalHeight*this.scale()},r.prototype.draw=function(e){e.drawImage(this._image,0,0,this.width(),this.height(),0,0,this.naturalWidth(),this.naturalHeight())},n.prototype.width=function(){if(null===this._width){var e=this._alpha(0,0,this._image.width,1);this._width=this._size(e)}return this._width},n.prototype.height=function(){if(null===this._height){var e=this._alpha(0,0,1,this._image.height);this._height=this._size(e)}return this._height},n.prototype._size=function(e){for(var t=e.length-1;t>=0;t-=1)if(0!==e[t])return t+1;return 0},n.prototype._alpha=function(e,t,i,a){return this._alphaExtractor.extract(this._image,e,t,i,a)},o.prototype._urlUsingFileReader=function(e,t){var i=new FileReader;i.onload=function(t){e(t.target.result)},i.onerror=function(e){t(e.target.error)},i.readAsDataURL(this._blob)},o.prototype._url=function(e,t){return s?e(s.createObjectURL(this._blob)):this._urlUsingFileReader(e,t)},o.prototype._revokeUrl=function(e){s&&s.revokeObjectURL(e)},o.prototype._exifData=function(e,t){var i=this._blob;EXIF.getData(i,function(){var t=i.exifdata;e(t)})},o.prototype._image=function(e,t){function i(i){var r=new Image;r.onload=function(){a._revokeUrl(i),e(r)},r.enerror=function(){var e=new Error("Unable to load image");t(e)},r.src=i}var a=this;this._url(i,t)},o.prototype.imageData=function(i,a){function n(a,n){var l=s.isSubsampled(a,o.type);a=l?new r(a):new t(a);var u=document.createElement("canvas"),c=u.getContext("2d");e.EXIF.transformCoordinate(u,c,a.naturalWidth(),a.naturalHeight(),n),a.draw(c);var f=c.getImageData(0,0,u.width,u.height);return i(f)}var o=this._blob,s=this._subsamplingDetector,l=this;l._exifData(function(e){var t=e.Orientation;l._image(function(e){n(e,t)},a)},a)},e.BlobConverter=o}(),e.CaptureFallback=function(){"use strict";function t(t,i,a){(l||"STATE_STOPPED"===u.state)&&r(),u.checkAction("create"),o=document.createElement("input"),o.setAttribute("accept","image/*"),"camera"===t.preference&&o.setAttribute("capture",t.preference),
o.setAttribute("type","file"),s=new e.FileInputCapture(o),u.setCreatedState(),i()}function i(e,t){function i(){n(),e.apply(this,arguments)}function a(){n(),t.apply(this,arguments)}l&&n(),u.checkAction("takePicture"),l=!0,s.start(i,a),u.setStartedState(),o.click()}function a(e,t){l&&n(),u.checkAction("choosePictureAsBase64"),s.setBase64Format(),i(e,t)}function r(){l&&n(),u.checkAction("destroy"),null!==s&&(s=null),o=null,u.setDestroyedState()}function n(){u.checkAction("stopCapture"),s.stop(),l=!1,u.setStoppedState()}var o=null,s=null,l=!1,u=new e.StateManager;return{configure:t,choosePicture:i,choosePictureAsBase64:a,destroy:r}}(),function(){"use strict";function t(){var t=e.Utils.createElement("div","kfx-layout kfx-capture"),r=new i;t.appendChild(r.element);var n=new a;t.appendChild(n.element),this.element=t,this.videoView=r,this.canvas=r.canvas,this.video=r.video,this.toolbarView=n}function i(){var e=document.createElement("div");e.className="kfx-content";var t=document.createElement("canvas");e.appendChild(t);var i=document.createElement("video");e.appendChild(i),this.element=e,this.canvas=t,this.video=i}function a(){function t(e){var t=i("button","kfx-button "+e),a=i("div","kfx-icon");return t.appendChild(a),t}var i=e.Utils.createElement,a=i("div","kfx-toolbar kfx-invisible"),r=t("kfx-force-capture");a.appendChild(r);var n=t("kfx-gallery");a.appendChild(n);var o=i("input","kfx-hidden");o.type="file",o.accept="image/*",n.addEventListener("click",function(){var e=new MouseEvent("click",{});o.dispatchEvent(e)}),a.appendChild(o),this.element=a,this.forceCaptureButton=r,this.forceCaptureTimeoutId=null,this.galleryButton=n,this.galleryInput=o}t.prototype.resize=function(){this.videoView.resize()},t.prototype.stop=function(e){this.stopToolbar()},t.prototype.startToolbar=function(e){this.toolbarView.start(e)},t.prototype.stopToolbar=function(e){this.toolbarView.stop()},t.prototype.enableToolbar=function(){this.toolbarView.enable()},t.prototype.disableToolbar=function(){this.toolbarView.disable()},i.prototype.resize=function(){var e=this.element.clientWidth,t=this.element.clientHeight;if(0!==e&&0!==t){var i=this.video.videoWidth,a=this.video.videoHeight;if(0===i||0===a)return this.canvas.width=e,this.canvas.height=t,this.video.width=e,void(this.video.height=t);var r=e/i,n=t/a,o=Math.min(r,n),s=i*o|0,l=a*o|0;this.canvas.width===s&&this.canvas.height===l||(this.canvas.width=s,this.canvas.height=l,this.video.width=s,this.video.height=l)}},a.prototype.start=function(t){this.setUpForceCapture(t.forceCapture),e.Utils.toggleElement(this.galleryButton,t.gallery),this.enable()},a.prototype.stop=function(e){this.disable(),clearTimeout(this.forceCaptureTimeoutId),this.forceCaptureTimeoutId=null},a.prototype.enable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!1)},a.prototype.disable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!0)},a.prototype.setUpForceCapture=function(e){var t=this.enableForceCaptureButton.bind(this),i="number"==typeof e&&e,a=e===!0||0===i;t(a),i&&(this.forceCaptureTimeoutId=setTimeout(t,1e3*i))},a.prototype.enableForceCaptureButton=function(t){t="undefined"==typeof t||t,e.Utils.toggleElement(this.forceCaptureButton,t)},e.CaptureView=t}(),function(){"use strict";function t(e){function t(e){(!e||e.angle>i)&&(s=!1,r())}function a(){s=!0,o.addListener(t)}function r(){s=!1,o.removeListener(t)}function n(){return s}var o=e,s=!1;this.start=a,this.stop=r,this.isNeeded=n}var i=45;e.ContinuousCaptureReset=t}(),function(){"use strict";function t(t){function i(){c||(c=!0,e.Utils.notifyListeners(l))}function a(){c&&(c=!1,e.Utils.notifyListeners(u))}function r(e){l.push(e)}function n(e){u.push(e)}function o(){t.addEventListener("click",i),t.addEventListener("change",a),document.body.addEventListener("focus",a,!0),c=!1}function s(){t.removeEventListener("click",i),t.removeEventListener("change",a),document.body.removeEventListener("focus",a,!0)}var l=[],u=[],c=!1;this.onOpen=r,this.onClose=n,this.start=o,this.stop=s}function i(i){function a(e){var t=e.target,i=t.files;i.length&&(r(i[0]),t.value="")}function r(t){if(0===t.size)return void alert("Image chosen is not valid");if(d){var i=new FileReader;i.onload=function(e){var t=e.target.result,i=t.replace(/^data:image\/(jpeg|png|jpg);base64,/,"");return c(i)},i.readAsDataURL(t)}else new e.BlobConverter(t).imageData(function(t){t.id=e.Utils.guid(),e.CaptureEventAppStats.logImageObject(t.id,"Image","",t.data.length),e.CaptureEventAppStats.logAppStats("Image Captured",t.id,1),c(t)},f)}function n(e,t){c=e,f=t,i.addEventListener("change",a),h.start()}function o(){c=null,f=null,i.removeEventListener("change",a),h.stop()}function s(e){h.onOpen(e)}function l(e){h.onClose(e)}function u(){d=!0}var c=null,f=null,h=new t(i),d=!1;if("input"!==i.tagName.toLowerCase())throw new Error("Wrong element. Expected input, got "+i.tagName);this.start=n,this.stop=o,this.setBase64Format=u,this.onDialogOpen=s,this.onDialogClose=l}e.FileInputCapture=i}(),function(){"use strict";function t(){}t.prototype.start=function(){},t.prototype.stop=function(){},t.prototype.isNeeded=function(){return!1},e.NoOpContinuousCaptureReset=t}(),e.WebCapture=function(){"use strict";function t(){H.resize();var t=H.canvas.width,i=H.canvas.height;x===t&&E===i||(x=t,E=i,C=new e.Frame(x,E,N),U=new e.EdgeDetector(C),j.configure(C,U.dsFactor,N,function(){}))}function i(t){A=void 0,C=new e.Frame(x,E,N),U=new e.EdgeDetector(C);var i=function(){if(t){var i=function(){I=void 0,D()},a=function(t){e.report(R,new e.UserMediaError(t))};Q=new e.UserMediaManager(P),Q.configure(i,a)}};j.configure(C,U.dsFactor,N,i)}function a(){if(I=compatibility.requestAnimationFrame(a),P.readyState===P.HAVE_ENOUGH_DATA&&void 0===k){if(t(),T.drawImage(P,0,0,x,E),J)return r(),void o("Capture is Paused. Tap to Continue");if(L||!O){if(Z.isNeeded())return void r();if(z)return r(),void s();try{var i=U.findEdgesRectangle(_);if(N.showEdges){T.beginPath(),T.strokeStyle=N.edgesColor,T.lineWidth=N.edgesWidth,T.moveTo(i[0][0],i[0][1]);for(var l=1;l<i.length;l++)T.lineTo(i[l][0],i[l][1]);T.closePath(),T.stroke()}e.Guidance.processRectangle(i)}catch(u){e.Guidance.processGuidance(e.Hints.FILL_AREA)}n()}}}function r(){C.draw(T,A)}function n(){r(),j.draw(T,A)}function o(e){var t=getComputedStyle(V),i=[t.getPropertyValue("font-size"),t.getPropertyValue("font-family")].join(" ");try{T.save(),T.font=i,T.fillStyle="white";var a=T.measureText(e),r=x-a.width>>1,n=E>>1;T.fillText(e,r,n)}finally{T.restore()}}function s(){if(z.isExpired())return void(z=null);z.setSize(C.width,C.height);try{T.save(),T.translate(C.mx,C.my),z.draw(T)}finally{T.restore()}}function l(){J=!0,P.pause(),H.disableToolbar()}function u(){J=!1,P.play(),H.enableToolbar()}function c(t,i){try{re(t,i)}catch(a){e.report(i,a)}}function f(e,t){if(null===X)t(e);else{var i=function(){t(e)},a=function(){O=!1,Z.stop()};X.review(e,i,a)}}function h(t){e.Utils.validateOptions(t,B),void 0!==t.lookAndFeel&&e.Utils.validateOptions(t.lookAndFeel,B)}function d(){return e.Utils.getOptions(N)}function p(){return e.Utils.getOptions(G)}function m(t,a){h(t),e.Utils.setOptions(N,t,G),i(a)}function g(e){m(e,!1)}function v(){e.Utils.resetOptions(N,G)}function y(){return J?void u():void(z&&z.isShown()&&(z=null,S()))}function S(){H.startToolbar(N.lookAndFeel)}function w(){return q.checkAction("setOptions")}var P,_,T,I,C,A,x,E,D,R,M,L,O,k,j,U,F=e.Utils.getImageUrl,N={frameAspectRatio:.629,framePadding:5,frameCornerHeight:10,frameCornerWidth:60,frameCornerColor:"#00FF00",outOfFrameTransparency:.5,showEdges:!1,edgesColor:"#FFFF00",edgesWidth:4,guidanceSize:150,useTargetFrameCrop:!1,lookAndFeel:{documentSample:F("document_sample.png"),forceCapture:10,gallery:!0}},G={frameAspectRatio:.629,framePadding:5,frameCornerHeight:10,frameCornerWidth:60,frameCornerColor:"#00FF00",outOfFrameTransparency:.5,showEdges:!1,edgesColor:"#FFFF00",edgesWidth:4,guidanceSize:150,useTargetFrameCrop:!1,lookAndFeel:{documentSample:F("document_sample.png"),forceCapture:10,gallery:!0}},B={frameAspectRatio:{type:"number",min:{value:0,include:!0}},framePadding:{type:"number",min:{value:0,include:!0},max:{value:49,include:!0}},frameCornerHeight:{type:"number",min:{value:0,include:!1}},frameCornerWidth:{type:"number",min:{value:0,include:!1}},frameCornerColor:{type:["string","object"],color:!0},outOfFrameTransparency:{type:"number",min:{value:0,include:!0},max:{value:1,include:!0}},showEdges:{type:"boolean"},edgesColor:{type:["string","object"],color:!0},edgesWidth:{type:"number",min:{value:0,include:!1}},guidanceSize:{type:"number",min:{value:100,include:!0}},useTargetFrameCrop:{type:"boolean"},documentSample:{type:["boolean","string"]},forceCapture:{type:["boolean","number"],min:{value:0,include:!0}},gallery:{type:"boolean"}},V=null,H=null,W=null,z=null,K=new e.AutoLoadAudio,q=new e.StateManager,X=null,Y=new e.LevelSensor,Z=null,J=!1,Q=null,$=function(t,i,a){q.checkAction("create"),V=document.getElementById(t.containerId),H=new e.CaptureView,V.appendChild(H.element),H.resize(),P=H.video,x=P.width,E=P.height,_=H.canvas,T=_.getContext("2d"),T.fillStyle="rgb(0,255,0)",T.strokeStyle="rgb(0,255,0)",D=function(){q.setCreatedState(),i()},R=function(e){ae(),a(e)},_.addEventListener("click",y),_.addEventListener("touchend",y),W=new e.FileInputCapture(H.toolbarView.galleryInput),W.onDialogOpen(l),j=e.Guidance,X=t.preview===!0?new KfxWebSDK.ReviewControl(t.containerId):null,m(t,!0)},ee=function(t,i,r){q.checkAction("takePicture"),L=r,O=!1,J=!1,W.start(t,i),A=void 0;var n=N.lookAndFeel;if(n.documentSample){var o=n.documentSample;o===!0&&(o=G.lookAndFeel.documentSample);var s=getComputedStyle(V),l=[s.getPropertyValue("font-size"),s.getPropertyValue("font-family")].join(" ");z=new e.DocumentSample(o,l,N.frameCornerHeight,6e3),z.setExpireHandler(S)}else z=null,S();Z=L?new e.ContinuousCaptureReset(Y):new e.NoOpContinuousCaptureReset,M=function(){e.CaptureEventAppStats.logAppStats(b.FORCE_TAKE_PICTURE,"",1),c(t,i)},H.toolbarView.forceCaptureButton.addEventListener("click",M),j.start(function(a){A=a,A===e.Hints.CAPTURE_OK&&(c(t,i),O=!0)}),void 0===I&&(P.play(),I=compatibility.requestAnimationFrame(a)),q.setStartedState()},te=function(e,t){q.checkAction("stopCapture"),null!==X&&X.isActive&&X.toolbarView.retakeButton.click(),H.stop(),W.stop(),z=null,A=void 0,Z.stop(),Z=null,void 0!==k&&clearTimeout(k),H.toolbarView.forceCaptureButton.removeEventListener("click",M),M=void 0,j.stop(),compatibility.cancelAnimationFrame(I),P.pause(),I=void 0,q.setStoppedState(),e()},ie=function(e){e!==!0&&q.checkAction("destroy"),ae(),q.setDestroyedState()},ae=function(){W=null,H=null,z=null,X=null,e.Utils.removeAllChildren(V),V=null,_.removeEventListener("click",y),_.removeEventListener("touchend",y),Q.destroy(),Q=null},re=function(t,i){function a(){var e=P.videoWidth,t=P.videoHeight,i=document.createElement("canvas");i.width=e,i.height=t;var a=i.getContext("2d");a.drawImage(P,0,0);var r=N.useTargetFrameCrop?C.getTargetFrameCropData(e,t):[0,0,e,t];return a.getImageData.apply(a,r)}if(q.checkAction("forceTakePicture"),J)throw new e.CaptureError("Capture is paused");if(P.readyState!==P.HAVE_ENOUGH_DATA)throw new e.CaptureError("Video is not ready, state = "+P.readyState);if(null!==X&&X.isActive)throw new e.StateError("Call forceTakePicture is not allowed during REVIEW");K.playShutterSound(),T.drawImage(P,0,0,x,E);var r=a();k=setTimeout(function(){A=void 0,k=void 0,K.pauseShutterSound(),j.clearGuidance(),r.id=e.Utils.guid(),e.CaptureEventAppStats.logImageObject(r.id,"Image","",r.data.length),e.CaptureEventAppStats.logAppStats("Image Captured",r.id,1),f(r,t),Z.start()},1e3),A=e.Hints.CAPTURE_OK,n()};return{configure:$,start:ee,stop:te,capture:re,destroy:ie,getOptions:d,getDefaultOptions:p,setOptions:g,resetOptions:v,checkSetOptionsAllowed:w}}(),function(){"use strict";function t(t,i){var a=e.GeneralSettings.getSettings(i);e.ImageUtils.checkMinSize(t.width,t.height,a.downscaleSize),this.data=t,this.settings=a,this.scaleData=e.ImageUtils.scaleToPixelSize(this.data,this.settings.downscaleSize),this.type=i,this.lines=null,this.imageByteArray=null}t.prototype.getLines=function(){if(null!==this.lines)return this.lines;var t=this.scaleData.imageData,i=e.ImageUtils.getRgbWithBlur(t,this.settings.gaussianBlur),a=i[0],r=i[1],n=i[2],o=a.cols,s=a.rows,l=i[3],u=e.LineExtractor.process,c=e.ImageUtils.adaptiveCanny,f=c(a);return u(f,o,s,this.settings,l),f=c(r),u(f,o,s,this.settings,l),f=c(n),u(f,o,s,this.settings,l),this.had=e.Hough.getAccumulator(l,o,s),this.lines=e.Hough.getLinesStandard(l,o,s,this.settings.houghThreshold,this.settings.houghLinesMax,this.had),this.imageByteArray=l,this.lines},t.prototype.process=function(){var t=this.getLines(),i=this.scaleData.imageData,a=this.scaleData.scaleFactor,r=i.width,n=i.height,o=new e.TetragonFinder(this.imageByteArray,r,n,this.type,this.had),s=o.find(t);if(this.settings.boundingCrop){var l=void 0===s?e.ImageUtils.getBound(this.imageByteArray,r,n):e.PointUtils.getBound([s.p1,s.p2,s.p3,s.p4]);l=e.PointUtils.scaleAll(l,a);var u=this.settings.boundingPadding,c=e.ImageUtils.getROICropData(this.data.width,this.data.height,l,u),f=e.ImageUtils.convertImageDataToCanvas(this.data),h=f.getContext("2d");return h.getImageData.apply(h,c)}if(void 0===s)throw Error("No document sides found");var d,p=new e.TetragonAligner(r,n),m=p.process(s);return d=m.getPerspectiveFraction()<this.settings.perspectiveThreshold?e.Deskew.process(this.data,m.getRectangleInterpolation(a)):e.Perspective.transform(this.data,m,a,this.type)},e.CannyDetector=t}(),e.Deskew=function(){"use strict";function t(t,a){var r=(t.width,t.height,new e.Rectangle(a)),n=e.ImageUtils.convertImageDataToCanvas(t).getContext("2d"),o=Math.abs,s=-r.radians,l=o(180*s/Math.PI);if(l>i){var u=Math.ceil(r.getRadius()),c=r.mx-u,f=r.my-u,h=2*u,d=e.ImageUtils.createEmptyCanvas(h,h);d.getContext("2d").putImageData(t,-c,-f);var p=e.ImageUtils.createEmptyCanvas(h,h).getContext("2d");p.translate(u,u),p.rotate(s),p.translate(-u,-u),p.drawImage(d,0,0,h,h),n=p,r=r.rotate(s).shift(-c,-f)}var m=e.PointUtils.getBound(r.rectangle),g=e.ImageUtils.getROICropData(n.canvas.width,n.canvas.height,m,0);return n.getImageData.apply(n,g)}var i=.49;return{process:t}}(),function(){"use strict";function t(t){var i=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();e.ImageUtils.checkMinSize(t.screenWidth,t.screenHeight,i.downscaleSize),this.width=t.screenWidth,this.height=t.screenHeight,this.contourRadius=i.contourRadius,this.gaussianBlurValue=i.gaussianBlurValue,this.sobelThreshold=i.sobelThreshold,this.dsFactor=Math.ceil(Math.sqrt(t.screenSquare/i.downscaleSize));var a=e.ImageUtils.getScalingData(this.width,this.height,i.downscaleSize);this.dsFactor=a.scaleFactor,this.dsContext=a.context,this.dsWidth=a.width,this.dsHeight=a.height,this.contourFinder=new e.ContourFinder(this.dsWidth,this.dsHeight,this.contourRadius),this.sobelManager=new e.Sobel(this.dsWidth,this.dsHeight,this.gaussianBlurValue,this.sobelThreshold,this.sobelMaxExpositionThreshold)}t.prototype.findEdgesRectangle=function(t){this.dsContext.drawImage(t,0,0,this.width,this.height);var i=this.dsContext.getImageData(0,0,this.dsWidth,this.dsHeight),a=this.sobelManager.process(i),r=this.contourFinder.find(a);if(void 0===r||r.length<3)throw new Error("Main contour either was not found or has less than 3 points");var n=e.ConvexHull.convexHull(r),o=e.RotatingCallipers.minBoundingRectangle(n);return o=e.PointUtils.scaleAll(o,this.dsFactor)},e.EdgeDetector=t}(),e.GeneralSettings=function(){"use strict";function t(t){return e.Utils.getOptions(r[t])}function i(){return e.Utils.getOptions(a)}var a={downscaleSize:12288,contourRadius:7,gaussianBlurValue:4,sobelThreshold:90,sobelMaxExpositionThreshold:70,minSquareThreshold:.1,maxRatioDeviationThreshold:1.8,maxRatioThreshold:5,maxGuidanceThreshold:3,outOfScreenDownscaledPadding:2.9,targetFrameCropEvrsPadding:50},r={};return r[KfxWebSDK.document.MOBILE_ID]={aspectRatio:2.125/3.375,downscaleSize:12e4,perspectiveThreshold:1.00016,gaussianBlur:4,houghThreshold:11,houghLinesMax:84,minTetragonRank:126,minTetragonSideRank:39,maxDiagonalFraction:1.059,maxAvgAspectRatio:3.966,minAvgAspectRatio:2.283,maxAngleDeviation:18,minAngleDeviation:14,maxRightAngleDeviation:10,maxDivineAngleDeviation:4,minSquareFraction:.191,maxOutOfSpaceIndex:.018,maxSidesDistances:1.086,minSidesDistances:.364,erectLinearThreshold:15,inclinedLinearThreshold:25},r[KfxWebSDK.document.CHECK_DEPOSIT]={downscaleSize:12e4,perspectiveThreshold:1.00074,gaussianBlur:4,runSecondPass:!0,secondPassHoughThreshold:5,secondPassHoughLinesMax:5,houghThreshold:18,houghLinesMax:70,minTetragonRank:176,minTetragonSideRank:57,maxDiagonalFraction:1.0463,maxAvgAspectRatio:7.641,minAvgAspectRatio:3.17,maxAngleDeviation:15,minAngleDeviation:3,maxRightAngleDeviation:9,maxDivineAngleDeviation:3,minSquareFraction:.392,maxOutOfSpaceIndex:.018,maxSidesDistances:1.175,minSidesDistances:.342,erectLinearThreshold:15,inclinedLinearThreshold:18},r[KfxWebSDK.document.PASSPORT]={boundingCrop:!0,boundingPadding:15,aspectRatio:142/202,downscaleSize:12e4,perspectiveThreshold:1.00202,gaussianBlur:4,houghThreshold:18,houghLinesMax:70,minTetragonRank:140,minTetragonSideRank:51,maxDiagonalFraction:1.116,maxAvgAspectRatio:3.596,minAvgAspectRatio:1.241,maxAngleDeviation:42,minAngleDeviation:8,maxRightAngleDeviation:24,maxDivineAngleDeviation:13,minSquareFraction:.432,maxOutOfSpaceIndex:.017,maxSidesDistances:1.141,minSidesDistances:.427,erectLinearThreshold:15,inclinedLinearThreshold:25},r[KfxWebSDK.document.BILL_PAY]={},{getSettings:t,getSettingsForRealTimeEdgeDetection:i}}(),function(){"use strict";function t(e,t,i,a,r){this.width=e,this.height=t,this.threshold=a,this.expThreshold=r,this.gaussianBlur=i,this.kernels={},this.kernels.r=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.kernels.g=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.kernels.b=new jsfeat.matrix_t(e,t,jsfeat.S32C2_t),this.gradients={},this.gradients.r=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.gradients.g=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.gradients.b=new jsfeat.matrix_t(e,t,jsfeat.S32C1_t),this.u8={},this.u8.r=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.g=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.b=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t),this.u8.main=new jsfeat.matrix_t(e,t,jsfeat.U8C1_t)}t.prototype.process=function(e){for(var t=e.data,i=t.length,a=this.u8.r.data,r=this.u8.g.data,n=this.u8.b.data,o=0,s=0;o<i;o+=4,s++)a[s]=t[o],r[s]=t[o+1],n[s]=t[o+2];i=this.width*this.height,jsfeat.imgproc.gaussian_blur(this.u8.r,this.u8.r,this.gaussianBlur),jsfeat.imgproc.gaussian_blur(this.u8.g,this.u8.g,this.gaussianBlur),jsfeat.imgproc.gaussian_blur(this.u8.b,this.u8.b,this.gaussianBlur),jsfeat.imgproc.sobel_derivatives(this.u8.r,this.kernels.r),jsfeat.imgproc.sobel_derivatives(this.u8.g,this.kernels.g),jsfeat.imgproc.sobel_derivatives(this.u8.b,this.kernels.b);var l,u,c=this.kernels.r.data,f=this.gradients.r.data,h=0,d=0,p=this.kernels.g.data,m=this.gradients.g.data,g=0,v=0,y=this.kernels.b.data,S=this.gradients.b.data,w=0,b=0;for(o=0;o<i;o++)l=o<<1,u=l+1,h=c[l],d=c[u],f[o]=h*h+d*d,g=p[l],v=p[u],m[o]=g*g+v*v,w=y[l],b=y[u],S[o]=w*w+b*b;var P,_,T,I,C,A,x,E,D,R,M,L,O,k,j,U,F,N,G,B,V,H,W,z,K,q,X,Y,Z,J,Q,$,ee,te,ie,ae,re,ne,oe,se,le,ue,ce=0,fe=0,he=0,de=0,pe=0,me=0,ge=0,ve=0,ye=0,Se=0,we=0,be=0,Pe=this.u8.main.data,_e=Pe[0],Te=this.u8.main.cols;for(o=0;o<i;o++)l=o<<1,h=c[l],d=c[l+1],P=h>>31,_=d>>31,he=(h^P)-P|0,de=(d^_)-_|0,ce=h>0?1:-1,fe=d>0?Te:-Te,T=o+ce,I=o+fe,C=he-de,B=f[T-fe],H=f[I-ce],he>de?(G=f[T],V=f[o-ce],W=C*G+de*B,z=C*V+de*H,A=he):(G=f[o-fe],V=f[I],C=-C,W=C*G+he*B,z=C*V+he*H,A=de),K=f[o]*A,g=p[l],v=p[l+1],x=g>>31,E=v>>31,ge=(g^x)-x|0,ve=(v^E)-E|0,pe=g>0?1:-1,me=v>0?Te:-Te,D=o+pe,R=o+me,M=ge-ve,Y=m[D-me],J=m[R-pe],ge>ve?(X=m[D],Z=m[o-pe],Q=M*X+ve*Y,$=M*Z+ve*J,L=ge):(X=m[o-me],Z=m[R],M=-M,Q=M*X+ge*Y,$=M*Z+ge*J,L=ve),ee=m[o]*L,w=y[l],b=y[l+1],O=w>>31,k=b>>31,we=(w^O)-O|0,be=(b^k)-k|0,ye=w>0?1:-1,Se=b>0?Te:-Te,j=o+ye,U=o+Se,F=we-be,ae=S[j-Se],ne=S[U-ye],we>be?(ie=S[j],re=S[o-ye],oe=F*ie+be*ae,se=F*re+be*ne,N=we):(ie=S[o-Se],re=S[U],F=-F,oe=F*ie+we*ae,se=F*re+we*ne,N=be),le=S[o]*N,q=K>=W&&K>z?255&A:0,te=ee>=Q&&ee>$?255&L:0,ue=le>=oe&&le>se?255&N:0,Pe[o]=Math.max.call(Math,q,te,ue),_e=Math.max(Pe[o],_e);if(_e<=this.expThreshold)throw Error("Image is too dark to process");var Ie,Ce=this.threshold*_e/255,Ae=new Array(i);for(o=0;o<i;o++)Ie=Pe[o]>=Ce?255:0,Ae[o]=Ie;return Ae},e.Sobel=t}(),function(){"use strict";function t(e,t,i,a,r,n,o){this.rho=e,this.angle=t,this.rank=void 0===a?0:a,this.ar=void 0===i?0:i,void 0===r||void 0===n||void 0===o?(this.sin=Math.sin(this.angle),this.cos=Math.cos(this.angle),this.cos=1===this.sin?0:this.cos,this.sin=1===this.cos?0:this.sin,this.t=Math.round(180*this.angle/Math.PI),180===this.t&&(this.t=0)):(this.sin=r,this.cos=n,this.t=o),this.isVertical=0===this.sin,this.isHorizontal=0===this.cos,this.b=this.rho/this.sin,this.k=-this.cos/this.sin,this.north=this.rho<0&&this.t>90,this.south=this.rho>0&&this.t>90}t.prototype.equals=function(e){return this.rho===e.rho&&this.angle===e.angle},t.prototype.isParallel=function(e){return this.rho!==e.rho&&this.angle===e.angle},t.prototype.intersect=function(e){if(this.equals(e)||this.isParallel(e))return[NaN,NaN];var t,i;return this.isVertical?(t=this.rho,i=e.get(t)):e.isVertical?(t=e.rho,i=this.get(t)):(t=(e.b-this.b)/(this.k-e.k),i=this.get(t)),[t,i]},t.prototype.get=function(e){return this.isHorizontal?this.rho:e*this.k+this.b},t.prototype.scale=function(e){return new t(e*this.rho,this.angle,this.ar,this.rank,this.sin,this.cos,this.t)},t.prototype.checkPoint=function(e,t){return t=void 0===t?0:t,Math.abs(e[0]*this.cos+e[1]*this.sin-this.rho)<=t},e.LinePolar=t}(),function(){"use strict";function t(e){var t=e[0],a=e[1],r=e[2];this.rectangle=e,this.length=this.rectangle.length,this.sideA=i(t,a),this.sideB=i(a,r),this.square=this.sideA*this.sideB;var n=t[0],o=t[1];this.mx=n+(r[0]-n)/2,this.my=o+(r[1]-o)/2;var s;this.sideA>this.sideB?(s=0,this["long"]=this.sideA,this["short"]=this.sideB):(s=1,this["long"]=this.sideB,this["short"]=this.sideA),this.ratio=this["long"]/this["short"],this.isSquareShape=this.ratio<=1.1;var l=s+1,u=this.rectangle[s],c=this.rectangle[l],f=u[0]-c[0];0===f?(this.tangens=NaN,this.radians=Math.PI/2,this.angle=90):(this.tangens=(u[1]-c[1])/f,this.radians=Math.atan(this.tangens),this.angle=180*this.radians/Math.PI)}var i=e.PointUtils.getDistance;t.prototype.shift=function(e,i){for(var a,r=[],n=0;n<this.length;n++)a=this.get(n),r.push([a[0]+e,a[1]+i]);return new t(r)},t.prototype.get=function(e){return this.rectangle[e]},t.prototype.getRadius=function(){for(var e,t,i,a=0,r=0;r<this.length;r++)e=this.get(r),t=e[0]-this.mx,i=e[1]-this.my,a=Math.max(a,t*t+i*i);return Math.sqrt(a)},t.prototype.rotate=function(e){for(var i,a,r,n=[],o=Math.sin(e),s=Math.cos(e),l=0;l<this.length;l++)i=this.get(l),a=i[0]-this.mx,r=i[1]-this.my,n.push([a*s-r*o+this.mx,r*s+a*o+this.my]);return new t(n)},e.Rectangle=t}(),function(){"use strict";function t(e,t,i,a){this.l1=e,this.l2=t,this.l3=i,this.l4=a,this.p1=this.l1.intersect(this.l2),this.p2=this.l2.intersect(this.l3),this.p3=this.l3.intersect(this.l4),this.p4=this.l4.intersect(this.l1),this.p12=o(this.p1,this.p2),this.p23=o(this.p2,this.p3),this.p34=o(this.p3,this.p4),this.p41=o(this.p4,this.p1),this.as1=this.p12+this.p34,this.as2=this.p23+this.p41,this.s12=this.as1*this.as2}var i=e.PointUtils.scale,a=e.PointUtils.getDistance,r=e.LineUtils.getLinesAngle,n=e.LineUtils.getLinesDistance,o=e.PointUtils.getSquareDistance,s=e.PointUtils.getOutOfSpaceLength,l=e.LineUtils.getLinePolarByPoints,u=e.LineUtils.getPointsOnLineByLengthFromAnotherPoint;t.prototype.getBound=function(t){var i=e.PointUtils.getBound([this.p1,this.p2,this.p3,this.p4]);return e.PointUtils.scaleAll(i,t)},t.prototype.getCenterPoint=function(e){var t=l(this.p1,this.p3),a=l(this.p2,this.p4);return i(t.intersect(a),e)},t.prototype.getRectangleInterpolation=function(e){var t,r=l(this.p1,this.p3),n=l(this.p2,this.p4),o=r.intersect(n),s=a(o,this.p1),c=a(o,this.p2),f=a(o,this.p3),h=a(o,this.p4),d=Math.min.apply(Math,[s,c,f,h]);t=u(r,o,d);var p=t[0],m=t[1];t=u(n,o,d);var g=t[0],v=t[1];return[i(p,e),i(g,e),i(m,e),i(v,e)]},t.prototype.getPerspectiveData=function(t,i){var r=this.getPoints(i);r=e.ConvexHull.convexHull(r).reverse();var n=a(r[0],r[1]),o=a(r[1],r[2]);if(n<o){var s=[];s.push(r[3]),s.push(r[0]),s.push(r[1]),s.push(r[2]),r=s,n=a(r[0],r[1]),o=a(r[1],r[2])}var l=a(r[2],r[3]),u=a(r[3],r[0]),c=Math.round((n+l)/2),f=Math.round((o+u)/2),h=Math.max(c,f),d=Math.min(c,f);return void 0!==t&&(d=Math.round(t*h)),{src:r,dst:[[0,0],[h,0],[h,d],[0,d]]}},t.prototype.getPerspectiveFraction=function(){var e=(Math.sqrt(this.p12)+Math.sqrt(this.p34))/2,t=(Math.sqrt(this.p23)+Math.sqrt(this.p41))/2,i=Math.sqrt(e*e+t*t),r=a(this.p1,this.p3),n=a(this.p2,this.p4),o=Math.min(r,n);return i>o?i/o:o/i},t.prototype.getPoints=function(t){for(var a=[this.p1,this.p2,this.p3,this.p4],r=e.PointUtils.roundToPoint,n=0,o=this.getCenterPoint(1);n<a.length;n++)a[n]=i(a[n],t),a[n]=r(a[n],o);return a},t.prototype.getConfidenceValue=function(){var e=this.l1.ar+this.l2.ar+this.l3.ar+this.l4.ar;return this.s12*e},t.prototype.getDiagonalFraction=function(){var e=o(this.p1,this.p3),t=o(this.p2,this.p4);return Math.max(e,t)/Math.min(e,t)},t.prototype.getAvgAspectRatio=function(){return Math.max(this.as1,this.as2)/Math.min(this.as1,this.as2)},t.prototype.getSidesAngleDeviation=function(){var e=r(this.l1,this.l3),t=r(this.l2,this.l4);return{max:Math.max(e,t),min:Math.min(e,t)}},t.prototype.getSquareFraction=function(e){return this.s12/e},t.prototype.getOutOfSpaceIndex=function(e,t,i){var a=s(this.p1,t,i);return a=Math.max(a,s(this.p2,t,i)),a=Math.max(a,s(this.p3,t,i)),a=Math.max(a,s(this.p4,t,i)),a/e},t.prototype.getSidesDistances=function(e){var t=n(this.l1,this.l3),i=n(this.l2,this.l4);return{max:Math.max(t,i)/e,min:Math.min(t,i)/e}},e.Tetragon=t}(),function(){"use strict";function t(e,t,i){this.width=e,this.height=t,this.radius=i,this.squareRadius=this.radius*this.radius;for(var a,r=new Array(e*t),n=0;n<r.length;n++)a=Math.floor(n/e),r[n]=[n-a*e,a];this.cache=r}function i(e){for(var t=-1,i={},r=0;r<e.length;r++)e[r]<0?a.call(this,e,i,e[r],r):e[r]>0&&(void 0===i[t]&&(i[t]=[]),a.call(this,e,i,t,r),t--);return i}function a(e,t,i,a){for(var r,n,o,s,l,u,c,f,h=this.cache[a],d=h[0],p=h[1],m=this.width,g=this.height,v=this.radius,y=this.squareRadius,S=Math.max(d-v,0),w=Math.max(p-v,0),b=Math.min(d+v,m-1),P=Math.min(p+v,g-1),_=S;_<=b;_++)for(var T=w;T<=P;T++)if(r=_-d,n=T-p,!(r*r+n*n>y))if(o=T*m+_,s=e[o],s>0)e[o]=i,t[i].push([_,T]);else if(s<0&&s!==i){for(l=t[s],u=l.length,f=0;f<u;f++)c=l[f],e[c[1]*m+c[0]]=i,t[i].push(c);delete t[s]}}t.prototype.find=function(e){var t,a=[],r=0,n=i.call(this,e);for(var o in n)n.hasOwnProperty(o)&&(t=n[o],t.length>r&&(r=t.length,a=t));return a},e.ContourFinder=t}(),e.ConvexHull=function(){"use strict";function t(t){if(t.length<3)return t;for(var i,a=[],r=t[0],n=e.PointUtils.equals,o=e.PointUtils.getSquareDistance,s=e.PointUtils.approximatePointToLineDistance,l=1;l<t.length;l++)i=t[l],(i[0]<r[0]||i[0]===r[0]&&i[1]<r[1])&&(r=i);var u,c,f,h;do{for(a.push(r),u=t[0],f=n(r,u),h=o(r,u),l=1;l<t.length;l++)i=t[l],c=s(r,u,i),(c>0||0===c&&o(r,i)>h||f)&&(u=i,f=n(r,u),h=o(r,u));r=u}while(!n(u,a[0]));return a}return{convexHull:t}}(),e.Hough=function(){"use strict";function t(e){return function(t,i){return e[i]-e[t]}}function i(e,t,i){var a,n,o,c,f,h=r,d=u(2*(t+i)+1),p=d+2,m=d-1,g=.5*m,v=(h+2)*p,y=new Array(v),S=new Array(v),w=new Array(v);for(a=0;a<v;a++)y[a]=0,S[a]=[-255,-255],w[a]=0;var b,P,_,T=0;for(a=0;a<i;a++)for(n=0;n<t;n++)if(e[a*t+n]>0)for(o=0;o<h;o++)c=u(n*l[o]+a*s[o])+g,f=(o+1)*p+c+1,y[f]++,b=S[f],P=b[0]-n,_=b[1]-a,-1<=P&&P<=1&&-1<=_&&_<=1&&w[f]++,b[0]=n,b[1]=a,w[f]>T&&(T=w[f]);return{c2:w,max_c2:T,accum:y}}function a(a,f,h,d,p,m,g){var v,y,S,w,b,P,_,T,I=[],C=r,A=u(2*(f+h)+1),x=A+2,E=A-2,D=A-1,R=.5*D,M=1/x,L=[];void 0===m&&(m=i(a,f,h)),_=m.c2,P=m.accum,T=m.max_c2;var O,k=100/T,j=d/k,U=e.Type.isFunction(g);for(S=0;S<A;S++)for(y=0;y<C;y++)b=(y+1)*x+S+1,O=P[b],_[b]>j&&O>P[b-1]&&O>=P[b+1]&&O>P[b-E]&&O>=P[b+x]&&(U?g(L,b,y*o,b-(y+1)*x-R-1):L.push(b));L.sort(t(_)),p=Math.min(p,L.length);var F,N,G,B=e.LinePolar;for(v=0;v<p;v++)w=L[v],y=c(w*M)-1,S=w-(y+1)*x-1,F=S-R,N=y*o,G=0<=N&&N<=n,F<0&&G||0===F&&!G||I.push(new B(F,N,_[w],u(k*_[w]),s[y],l[y],y));return I}for(var r=180,n=Math.PI/2,o=Math.PI/180,s=new Array(r),l=new Array(r),u=Math.round,c=Math.floor,f=0,h=0;f<r;h+=o,f++)s[f]=Math.sin(h),l[f]=Math.cos(h);return{getAccumulator:i,getLinesStandard:a}}(),e.LineExtractor=function(){"use strict";function e(e,t,i,a,r){for(var n,o,s=[],l={},u=0,c=t,f=-1,h=0;c<=i;c+=a)o=e[c],o>0&&(f===-1&&(f=c),h++),0!==o&&c!==i||f===-1||(n=o>0?c:c-1,l[f]=[f,h,n],f!==n&&(l[n]=l[f]),s.push(l[f]),u=Math.max(h,u),void 0===r[h]&&(r[h]=[]),r[h].push(l[f]),f=-1,h=0);return s.maxSize=u,s.map=l,s}function t(e,t,a){for(var r=0;r<e.length;r++)i(e[r],t,a)}function i(e,t,i){for(var a=e[0];a<=e[2];a+=t)i[a]=255}function a(e,i,a,r){for(var n,o=Object.keys(e),s=0;s<o.length;s++)(n=o[s])>i&&t(e[n],a,r)}function r(t,i,r,n,o){for(var l,u=[],c={},f=0,h=1,d=0,p=i-1;d<r;d++)u[d]=l=e(t,d*i,d*i+p,h,c),l.length>0&&(f=Math.max(l.maxSize,f));for(var m,g=[],v={},y=0,S=i,w=0,b=r-1;w<i;w++)g[w]=m=e(t,w,b*i+w,S,v),m.length>0&&(y=Math.max(m.maxSize,y));var P=Math.floor(f*n.erectLinearThreshold/100);P>5&&a(c,P,h,o);var _=Math.floor(y*n.erectLinearThreshold/100);_>5&&a(v,_,S,o),s(u,i,n,o)}function n(e,t,a){do i(e,1,a),e=e.track[t].next;while(null!==e)}function o(e){return{L:{next:null,size:e,referenced:!1},R:{next:null,size:e,referenced:!1}}}function s(e,t,i,a){for(var r,n,s,c,f,h,d,p,m=0;m<e.length;m++)for(var g=0;g<e[m].length;g++)r=e[m][g],n=r[1],c=r[0],f=r[2],r.track=o(n),s=e[m-1],void 0!==s&&0!==s.length&&(p=s.map,h=f-t,d=void 0!==p[h]?p[h]:void 0!==p[++h]?p[h]:void 0,u(r,d,"R"),h=c-t,d=void 0!==p[h]?p[h]:void 0!==p[--h]?p[h]:void 0,u(r,d,"L"));for(var v=[],y=0,S=[],w=0,m=0;m<e.length;m++)for(var g=0;g<e[m].length;g++)r=e[m][g],r.track.L.referenced||null===r.track.L.next||(S.push(r),w=Math.max(w,r.track.L.size)),r.track.R.referenced||null===r.track.R.next||(v.push(r),y=Math.max(y,r.track.R.size));l(v,Math.floor(y*i.inclinedLinearThreshold/100),"R",a),l(S,Math.floor(w*i.inclinedLinearThreshold/100),"L",a)}function l(e,t,i,a){if(e.length>0)for(var r=0;r<e.length;r++)e[r].track[i].size>t&&n(e[r],i,a)}function u(e,t,i){void 0!==t&&(e.track[i].next=t,e.track[i].size=t.track[i].size+e[1],e.track[i].referenced=!1,t.track[i].referenced=!0)}return{process:r}}(),e.Perspective=function(){"use strict";function t(t,a,r,n){var o=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),s=e.GeneralSettings.getSettings(n).aspectRatio,l=a.getPerspectiveData(s,r),u=l.src,c=l.dst,f=u[0][0],h=u[0][1],d=c[0][0],p=c[0][1],m=u[1][0],g=u[1][1],v=c[1][0],y=c[1][1],S=u[2][0],w=u[2][1],b=c[2][0],P=c[2][1],_=u[3][0],T=u[3][1],I=c[3][0],C=c[3][1];jsfeat.math.perspective_4point_transform(o,f,h,d,p,m,g,v,y,S,w,b,P,_,T,I,C),jsfeat.matmath.invert_3x3(o,o);var A=e.ImageUtils.createEmptyImageData(b,P);return i(t,A,o.data),A}function i(e,t,i){for(var a,r,n,o,s,l,u,c,f=0|t.width,h=0|t.height,d=0|e.width,p=0|e.height,m=0,g=0,v=0,y=0,S=0,w=0,b=0,P=0,_=0,T=0,I=0,C=0,A=0,x=0,E=0,D=0,R=0,M=i[0],L=i[1],O=i[2],k=i[3],j=i[4],U=i[5],F=i[6],N=i[7],G=i[8],B=d-1,V=p-1,H=4*d,W=4*f,z=e.data,K=t.data,q=0,X=0;X<h;++X){w=L*X+O,b=j*X+U,P=N*X+G,u=X*W;for(var Y=0;Y<f;Y++,q+=4,w+=M,b+=k,P+=F)_=1/P,y=w*_,S=b*_,g=0|y,v=0|S,c=0,l=u+4*Y+3,y>0&&S>0&&g<B&&v<V&&(T=Math.max(y-g,0),I=Math.max(S-v,0),m=H*v+4*g|0,a=m+H,r=m+1,n=m+2,o=a+1,s=a+2,C=z[m]+T*(z[m+4]-z[m]),A=z[a]+T*(z[a+4]-z[a]),x=z[r]+T*(z[m+5]-z[r]),E=z[o]+T*(z[a+5]-z[o]),D=z[n]+T*(z[m+6]-z[n]),R=z[s]+T*(z[a+6]-z[s]),K[q]=C+I*(A-C),K[q+1]=x+I*(E-x),K[q+2]=D+I*(R-D),c=255),K[l]=c}}return{transform:t}}(),e.RotatingCallipers=function(){"use strict";function t(e){for(var t,h,d,p,m,g=[],v=e.length,y=a,S=new Array(v),w=new Array(v),b=v-1,P=0;b>=0;b--,P++)m=e[b],
S[P]=[m[0],m[1]];var _,T,I,C,A=[a,a],x=[r,r];for(b=0;b<v;b++)h=S[b],d=h[0],p=h[1],w[b]=c(S[(b+1)%v],h),d<A[0]&&(A[0]=d,_=b),d>x[0]&&(x[0]=d,T=b),p<A[1]&&(A[1]=p,C=b),p>x[1]&&(x[1]=p,I=b);var E,D,R,M,L,O=n,k=o,j=s,U=l;for(b=0;b<v;b++){switch(t=[Math.acos(u(O,w[_])),Math.acos(u(k,w[T])),Math.acos(u(j,w[I])),Math.acos(u(U,w[C]))],t.indexOf(Math.min.apply(Math,t))){case 0:O=w[_],k=[-O[0],-O[1]],j=[O[1],-O[0]],U=[-j[0],-j[1]],_=(_+1)%v;break;case 1:k=w[T],O=[-k[0],-k[1]],j=[O[1],-O[0]],U=[-j[0],-j[1]],T=(T+1)%v;break;case 2:j=w[I],U=[-j[0],-j[1]],O=[U[1],-U[0]],k=[-O[0],-O[1]],I=(I+1)%v;break;case 3:U=w[C],j=[-U[0],-U[1]],O=[U[1],-U[0]],k=[-O[0],-O[1]],C=(C+1)%v}E=i(S[_],O,S[I],j),D=i(S[T],k,S[I],j),R=i(S[C],U,S[_],O),M=i(S[C],U,S[T],k),L=f(E,D)*f(E,R),L<y&&(g=[E,R,M,D],y=L)}return g}function i(e,t,i,a){var r=(i[0]-e[0])*a[1]-(i[1]-e[1])*a[0],n=t[0]*a[1]-t[1]*a[0],o=r/n;return[e[0]+o*t[0],e[1]+o*t[1]]}var a=Number.MAX_VALUE,r=Number.MIN_VALUE,n=[0,-1],o=[0,1],s=[-1,0],l=[1,0],u=e.PointUtils.dot,c=e.PointUtils.subtract,f=e.PointUtils.getSquareDistance;return{minBoundingRectangle:t}}(),function(){"use strict";function t(t,i){this.width=t,this.height=i,this.north=new e.LinePolar(0,Math.PI/2),this.south=new e.LinePolar(this.height,Math.PI/2),this.east=new e.LinePolar(this.width,0),this.west=new e.LinePolar(0,0)}function i(e){var t;return e[0]<0&&(t=this.west),e[0]>this.width&&(t=this.east),e[1]<0&&(t=this.north),e[1]>this.height&&(t=this.south),t}function a(e,t){var i;return t===this.west&&(i=[Math.ceil(e[0])+1,e[1]]),t===this.east&&(i=[Math.floor(e[0])-1,e[1]]),t===this.north&&(i=[e[0],Math.ceil(e[1])+1]),t===this.south&&(i=[e[0],Math.floor(e[1])-1]),i}function r(t,r,n,o,s,l){var u=i.call(this,l);if(void 0===u)return t;var c=e.PointUtils.getDistance,f=e.LineUtils.getParallelLineByPoint,h=[t.l1,t.l2,t.l3,t.l4],d=e.LineUtils.getLinesAngle(o,u),p=e.LineUtils.getLinesAngle(s,u),m=Math.sin(Math.PI*d/180),g=Math.sin(Math.PI*p/180),v=0===g?0:1/(1+m/g),y=o.intersect(u),S=s.intersect(u),w=0===v?y:1===v?S:null;if(null===w){var b=c(y,S),P=b*v,_=e.LineUtils.getPointsOnLineByLengthFromAnotherPoint(u,y,P);w=c(S,_[0])>c(S,_[1])?_[1]:_[0]}return w=a.call(this,w,u),h[r]=f(w,o),h[n]=f(w,s),new e.Tetragon(h[0],h[1],h[2],h[3])}t.prototype.process=function(e){var t=e;return t=r.call(this,t,0,1,t.l1,t.l2,t.p1),t=r.call(this,t,1,2,t.l2,t.l3,t.p2),t=r.call(this,t,2,3,t.l3,t.l4,t.p3),t=r.call(this,t,3,0,t.l4,t.l1,t.p4)},e.TetragonAligner=t}(),function(){"use strict";function t(t,i,a){this.width=t,this.height=i,this.square=this.width*this.height,this.squaredSquare=this.square*this.square,this.avgSize=(this.width+this.height)/2,this.settings=e.GeneralSettings.getSettings(a)}t.prototype.filter=function(e){if(e.getDiagonalFraction()>this.settings.maxDiagonalFraction)return!1;var t=e.getAvgAspectRatio();return!(t<this.settings.minAvgAspectRatio||t>this.settings.maxAvgAspectRatio)&&(!(e.getSquareFraction(this.squaredSquare)<this.settings.minSquareFraction)&&!(e.getOutOfSpaceIndex(this.avgSize,this.width,this.height)>this.settings.maxOutOfSpaceIndex))},e.TetragonFilter=t}(),function(){"use strict";function t(t,i,a,r,n){this.data=t,this.width=i,this.height=a,this.avgSize=(this.width+this.height)/2,this.type=r,this.settings=e.GeneralSettings.getSettings(this.type),this.had=n}function i(t,i){var a,r,s=this.settings.maxAngleDeviation,l=this.settings.minSidesDistances,u=this.settings.maxSidesDistances,c=u*this.avgSize,f=l*this.avgSize,h=e.LinePolar,d=function(e,t,l,u){a=new h(u,l),r=o(i,a),n(i,a)<=s&&r>=f&&r<=c&&e.push(t)},p=e.Hough.getLinesStandard(this.data,this.width,this.height,this.settings.secondPassHoughThreshold,this.settings.secondPassHoughLinesMax,this.had,d);return this.find(t.concat(p),!0)}var a=Math.abs,r=e.LineUtils.getLinesByAngle,n=e.LineUtils.getLinesAngle,o=e.LineUtils.getLinesDistance,s=e.LineUtils.getDivineAngle;t.prototype.find=function(t,l){for(var u,c,f,h,d,p,m,g,v,y,S,w,b,P=0,_=void 0!==l&&l,T=new e.TetragonFilter(this.width,this.height,this.type),I=this.settings.maxDivineAngleDeviation,C=this.settings.maxRightAngleDeviation,A=this.settings.minTetragonSideRank,x=this.settings.minAngleDeviation,E=this.settings.minSidesDistances,D=this.settings.maxSidesDistances,R=this.settings.maxAngleDeviation,M=this.settings.minTetragonRank,L=D*this.avgSize,O=E*this.avgSize,k=new Array(180),j=e.Tetragon,U=-1,F=!_,N=0;N<t.length&&t[N].rank>=A;N++){m=t[N];for(var G=N+1;G<t.length;G++)if(g=t[G],v=o(m,g),!(n(m,g)>x||v<O||v>L)){b=k[m.t],void 0===b&&(b=r(t,a(m.t+90)%180,C),k[m.t]=b),h=m.rank+g.rank;for(var B=0;B<b.length;B++)if(S=b[B],!(s(S,m,g)>I)){d=h+S.rank,U<d&&(U=d,p=S);for(var V=B+1;V<b.length;V++)w=b[V],y=o(S,w),n(S,w)>R||y<O||y>L||d+w.rank<M&&F||(u=new j(m,S,g,w),T.filter(u)&&(c=u.getConfidenceValue(),c>P&&(f=u,P=c)))}}}return _?f:(this.settings.runSecondPass&&void 0===f&&void 0!==S&&(f=i.call(this,t,p)),f)},e.TetragonFinder=t}(),function(){"use strict";function t(e,t,a,r){"string"==typeof e?(this.image=document.createElement("img"),this.image.src=e):this.image=e,this.font=t,this.textPadding=a,this.width=-1,this.height=-1,this.time=r,this.startTime=-1,i=!1}var i,a="Tap to Dismiss";t.prototype.setSize=function(e,t){this.width=e,this.height=t},t.prototype.isShown=function(){return this.startTime!==-1},t.prototype.isExpired=function(){if(this.startTime===-1)return!1;if(i)return!0;var e=(new Date).getTime(),t=this.startTime+this.time;return e>=t&&(i=!0,"function"==typeof this.callBack&&this.callBack()),i},t.prototype.draw=function(e){this.rememberStartTime(),this.drawImage(e),this.drawDismissText(e)},t.prototype.rememberStartTime=function(){this.startTime===-1&&this.image.complete&&(this.startTime=Date.now())},t.prototype.drawImage=function(e){var t=this.image;if(t.naturalWidth&&t.naturalHeight){var i;if(this.width!==-1&&this.height!==-1){var a=this.width/t.naturalWidth,r=this.height/t.naturalHeight;i=Math.min(a,r)}else i=1;var n=t.naturalWidth*i,o=t.naturalHeight*i,s=-(n>>1),l=-(o>>1);e.drawImage(t,s,l,n,o)}},t.prototype.drawDismissText=function(e){try{e.save(),e.rotate(Math.PI/2),e.font=this.font,e.fillStyle="white",e.textBaseline="top";var t=e.measureText(a),i=-(t.width>>1),r=(this.width>>1)+this.textPadding;e.fillText(a,i,r)}finally{e.restore()}},t.prototype.setExpireHandler=function(e){this.callBack=e},e.DocumentSample=t}(),e.Extraction=function(){function t(t){var i;if(null===t||"undefined"==typeof t)return i=new e.ValidationError("Please provide options needed for extraction."),e.report(g,i),!1;if("object"!=typeof t)return i=new e.ValidationError("Please provide valid options object"),e.report(g,i),!1;if(null===t.url||"undefined"==typeof t.url)return i=new e.ValidationError("Please provide url of the server."),e.report(g,i),!1;if("string"!=typeof t.url||0==t.url.length)return i=new e.ValidationError("Please provide valid url"),e.report(g,i),!1;if(null===t.images||"undefined"==typeof t.images)return i=new e.ValidationError("Please provide images for extraction."),e.report(g,i),!1;if("object"!=typeof t.images)return i=new e.ValidationError("Please provide array of images."),e.report(g,i),!1;if("[object Array]"!=Object.prototype.toString.call(t.images))return i=new e.ValidationError("Please provide array of images."),e.report(g,i),!1;if(0==t.images.length)return i=new e.ValidationError("Please provide atleast one image for extraction."),e.report(g,i),!1;if(null===t.serverParameters||"undefined"==typeof t.serverParameters)return i=new e.ValidationError("Please provide serverParameters for extraction."),e.report(g,i),!1;if("object"!=typeof t.serverParameters)return i=new e.ValidationError("Please provide valid server parameters."),e.report(g,i),!1;if(null==t.timingInfo&&"undefined"==typeof t.timingInfo)return i=new e.ValidationError("Please provide timingInfo."),e.report(g,i),!1;if("boolean"!=typeof t.timingInfo)return i=new e.ValidationError("Please provide valid timing info."),e.report(g,i),!1;for(var a=0;a<t.images.length;a++)if("[object Uint8Array]"!=Object.prototype.toString.call(t.images[a]))return i=new e.ValidationError("The image should be of Uint8Array format."),e.report(g,i),!1;return!0}function i(e,t,i){if(a(e,i)){var r={userIdentityWithPassword:{UserId:e.username,LogOnProtocol:7,UnconditionalLogOn:!0,Password:e.password}},n={url:e.url+y,serverParameters:r};F(n,function(e){t(e)},function(e){i(e)})}}function a(t,i){return f(t)?null===t.url||"undefined"==typeof t.url?(error=new e.ValidationError("Please provide the URL needed for KTA login."),e.report(i,error),!1):"string"!=typeof t.url||0==t.url.length?(error=new e.ValidationError("Please provide valid url"),e.report(i,error),!1):null===t.username||"undefined"==typeof t.username?(error=new e.ValidationError("Please provide the username needed for KTA login."),e.report(i,error),!1):"string"!=typeof t.username||0==t.username.length?(error=new e.ValidationError("Please provide valid username"),e.report(i,error),!1):null===t.password||"undefined"==typeof t.password?(error=new e.ValidationError("Please provide the password needed for KTA login."),e.report(i,error),!1):"string"==typeof t.password&&0!=t.password.length||(error=new e.ValidationError("Please provide valid password"),e.report(i,error),!1):(error=new e.ValidationError("Please provide valid login options"),e.report(i,error),!1)}function r(){var e={jobWithDocsInitialization:{InputVariables:[{Value:null,Id:"Barcode"},{Value:!0,Id:"ProcessImage"},{Value:!0,Id:"Verification"}],Documents:[{DocumentName:null,RuntimeFields:null,FieldsToReturn:null,Base64Data:null,DocumentGroup:{Version:0,Id:null,Name:""},Data:null,MimeType:"image/jpeg",FolderTypeId:null,DocumentTypeId:null,ReturnFullTextOcr:!1,ReturnAllFields:!0,PageDataList:[],FilePath:null,PageDataCollection:null,FolderId:null}],StartDate:null,StoreFolderAndDocuments:!0},sessionId:"",processIdentity:{Version:0,Id:null,Name:""},variablesToReturn:{}};return e}function n(t){if(null==t)return null;for(var i=null,a={authenticationResult:null,VerificationPhoto64:null,transactionId:null,documentAlerts:null,documentTests:null,documentImageAnalysis:null,documentRiskVectorAnalysis:null,documentClassification:null},r=0;r<t.length;r++)"VerificationReserved"==t[r].Name&&(i=t[r].Value),"VerificationResult"==t[r].Name&&(a.authenticationResult=t[r].Value),"VerificationPhoto64"==t[r].Name&&(a.VerificationPhoto64=t[r].Value),"VerificationTransactionID"==t[r].Name&&(a.transactionId=t[r].Value);if(null!=i&&"undefined"!==i&&0!=e.Utils.isJSONValid(i)&&(i=JSON.parse(i),null!=i.DocumentInfo)){var n=i.DocumentInfo;n.DocumentAlerts.length<=0&&(n.DocumentAlerts=""),n.DocumentTests.length<=0&&(n.DocumentTests=""),n.DocumentImageAnalysis.length<=0&&(n.DocumentImageAnalysis=""),n.DocumentRiskVectorAnalysis.length<=0&&(n.DocumentRiskVectorAnalysis=""),n.DocumentClassification.length<=0&&(n.DocumentClassification=""),a.documentAlerts=n.DocumentAlerts,a.documentTests=n.DocumentTests,a.documentImageAnalysis=n.DocumentImageAnalysis,a.documentRiskVectorAnalysis=n.DocumentRiskVectorAnalysis,a.documentClassification=n.DocumentClassification}return a}function o(e){var t={sessionKey:m,words:[],"classificationResult ":[],documentId:e.d.DocumentId,extractionClass:p.serverParameters.documentName,JobId:e.d.JobIdentity.Id,fields:[]},i=O(e);return t.fields=s(i),t}function s(e){for(var t=[],i=e,a=0;a<i.length;a++){var r=i[a],n={id:null===r.Id?"":r.Id,text:null===r.Value?"":r.Value,name:null===r.Name?"":r.Name,confidence:null===r.Confidence?"":r.Confidence,errorDescription:null===r.ErrorDescription?"":r.ErrorDescription,valid:null===r.Valid?"":r.Valid};t.push(n)}return t}function l(){var e={jobWithDocsInitialization:{InputVariables:[],Documents:[{DocumentName:null,RuntimeFields:null,FieldsToReturn:null,Base64Data:null,DocumentGroup:{Version:0,Id:null,Name:""},Data:null,MimeType:"image/jpeg",ReturnFullTextOcr:!1,FolderTypeId:null,DocumentTypeId:null,ReturnAllFields:!0,PageDataList:[],FilePath:null,PageDataCollection:null,FolderId:null}],StartDate:null,StoreFolderAndDocuments:!0},sessionId:"",processIdentity:{Version:0,Id:null,Name:""},variablesToReturn:{}};return e}function u(e){for(var t=e.d,i=t.ReturnedDocumentFields[0].ReturnedDocumentFields,a={sessionKey:m,words:[],"classificationResult ":[],documentId:t.DocumentId,extractionClass:p.serverParameters.documentName,JobId:t.JobIdentity.Id,fields:[]},r=[],n=0;n<i.length;n++){var o=i[n],s={id:null===o.Id?"":o.Id,text:null===o.Value?"":o.Value,name:null===o.Name?"":o.Name,confidence:null===o.Confidence?"":o.Confidence,errorDescription:null===o.ErrorDescription?"":o.ErrorDescription,valid:null===o.Valid?"":o.Valid};r.push(s)}return a.fields=r,a}function c(t,i){var a;return f(t)?null===t.url||"undefined"==typeof t.url?(a=new e.ValidationError("Please provide the url needed for KTA extraction."),e.report(i,a),!1):"string"!=typeof t.url?(a=new e.ValidationError("Please provide valid url."),e.report(i,a),!1):0==t.url.length?(a=new e.ValidationError("Please provide valid url."),e.report(i,a),!1):null===t.serverParameters||"undefined"==typeof t.serverParameters?(a=new e.ValidationError("Please provide the server parameters needed for KTA extraction."),e.report(i,a),!1):"object"!=typeof t.serverParameters?(a=new e.ValidationError("Please provide valid server parameters."),e.report(i,a),!1):null===t.serverParameters.processIdentityName||"undefined"==typeof t.serverParameters.processIdentityName?(a=new e.ValidationError("Please provide the process identity name needed for KTA extraction."),e.report(i,a),!1):"string"!=typeof t.serverParameters.processIdentityName?(a=new e.ValidationError("Please provide valid process identity name needed for KTA extraction."),e.report(i,a),!1):0==t.serverParameters.processIdentityName.length?(a=new e.ValidationError("Please provide valid process identity name needed for KTA extraction."),e.report(i,a),!1):null===t.images||"undefined"==typeof t.images?(a=new e.ValidationError("Please provide array of images."),e.report(i,a),!1):"object"!=typeof t.images?(a=new e.ValidationError("Please provide array of images."),e.report(i,a),!1):"[object Array]"!=Object.prototype.toString.call(t.images)?(a=new e.ValidationError("Please provide array of images."),e.report(i,a),!1):0==t.images.length?(a=new e.ValidationError("Please provide atleast one image for extraction."),e.report(i,a),!1):null==t.timingInfo&&"undefined"==typeof t.timingInfo?(a=new e.ValidationError("Please provide timingInfo."),e.report(i,a),!1):"boolean"!=typeof t.timingInfo?(a=new e.ValidationError("Please provide valid timing info."),e.report(i,a),!1):"undefined"!=typeof t.serverParameters.sessionId&&null!=t.serverParameters.sessionId&&0!=t.serverParameters.sessionId.length||(a=new e.ValidationError("Please provide valid KTA sessionId"),e.report(i,a),!1):(a=new e.ValidationError("Please provide valid options object"),e.report(i,a),!1)}function f(e){return null!==e&&"undefined"!=typeof e&&"object"==typeof e}function h(e){var t=e.d;return null===t||"undefined"===t?null:t.DocumentId}function d(e){var t=e.d;return null===t||"undefined"===t?null:t.SessionId}var p,m,g,v,y="/UserService.svc/json/LogOnWithPassword2",S="/JobService.svc/json/CreateJobSyncWithDocuments",w="ErrorDetails",b="VerificationErrorInfo",P=function(i,a,r){v&&(v=null),v=new XMLHttpRequest,g=r;var n=t(i);if(n){var o,s={StartTime:new Date,Duration:null,FinishTime:null,message:""},l=i.serverParameters;v.addEventListener("load",function(t){if(i.timingInfo){s.FinishTime=new Date,s.Duration=(s.FinishTime-s.StartTime)/1e3;var r="Time: "+s.Duration+" seconds.";s.message=r}if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var n=new Error(v.responseText);return void e.report(g,n)}var n=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,n)}try{o=JSON.parse(this.response)}catch(l){o=null}if(null==o){var n=new Error("We didn't receive a valid server response.");return void e.report(g,n)}if(o.exceptionMessage||o.Message&&o.Message.length>0){var n=new Error(o.Message);return void e.report(g,n)}"function"==typeof a&&(i.timingInfo?a(o,s):a(o,null))}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}var i=new Error(t.Message);return void e.report(g,i)}),v.open("POST",i.url,!0),v.setRequestHeader("Accept","application/json");var u=new FormData;if(l)for(var c in l)l.hasOwnProperty(c)&&u.append(c,l[c]);for(var f=0;f<i.images.length;f++)u.append("file"+f,new Blob([i.images[f]],{type:"image/jpeg"}));v.send(u)}},_=function(i,a,r){v&&(v=null),v=new XMLHttpRequest,g=r;var n=t(i);if(n){var o={StartTime:new Date,Duration:null,FinishTime:null,message:""},s=i.serverParameters;v.addEventListener("load",function(t){if(i.timingInfo){o.FinishTime=new Date,o.Duration=(o.FinishTime-o.StartTime)/1e3;var r="Time: "+o.Duration+" seconds.";o.message=r}if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var n=new Error(v.responseText);return void e.report(g,n)}var n=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,n)}a(this.response,o)}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The RTTI server may be offline or does not exist.");return void e.report(g,i)}var i=new Error(t.Message);return void e.report(g,i)}),v.open("POST",i.url,!0),v.setRequestHeader("Accept","application/json");var l=new FormData;if(s)for(var u in s)s.hasOwnProperty(u)&&l.append(u,s[u]);for(var c=0;c<i.images.length;c++)l.append("file"+c,new Blob([i.images[c]],{type:"image/jpeg"}));v.send(l)}},T=function(e,t,a){return i(e,t,a)},I=function(t,a,r){p=t;var n=c(t,r);if(n){var o=function(t){if(m=d(t),null===m||"undefined"==typeof m){var i=new Error("Session id is not defined.");return void e.report(errorCallBackForKTA,i)}var n=R(p);F(n,function(e){L(e,a,r)},function(e){r(e)})},s=function(t){var i=new Error(t);e.report(r,i)};if("undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId){m=p.serverParameters.sessionId;var l=R(p);F(l,function(e){L(e,a,r)},function(e){r(e)})}else i(t,o,s)}},C=function(t,a,r){p=t;var n=c(t,r);if(n){var o=function(t){if(m=d(t),null===m||"undefined"==typeof m){var i=new Error("Session id is not defined.");return void e.report(r,i)}var n=A(p);F(n,function(e){x(e,a,r)},function(e){r(e)})},s=function(t){var i=new Error(t);e.report(r,i)};if("undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId){m=p.serverParameters.sessionId;var l=A(p);F(l,function(e){x(e,a,r)},function(e){r(e)})}else i(t,o,s)}},A=function(e){delete e.serverParameters.sessionId;var t=r(),i=t.jobWithDocsInitialization,a=i.Documents;U(e.images,a[0].PageDataList),t.sessionId=m,t.processIdentity.Name=e.serverParameters.processIdentityName,e.serverParameters.ktaDeleteDocument&&"YES"===e.serverParameters.ktaDeleteDocument?t.jobWithDocsInitialization.StoreFolderAndDocuments=!1:t.jobWithDocsInitialization.StoreFolderAndDocuments=!0,j(e);for(var n=i.InputVariables,o=Object.keys(e.serverParameters),s=0;s<o.length;s++){var l={Value:e.serverParameters[o[s]],Id:o[s]};n.push(l)}var u={url:e.url+S,serverParameters:t};return u},x=function(t,i,a){if(!k(t,a,!1)){var r=E(t);if(null==r){var n=new Error("Authentication Results not found in Server response");return void e.report(a,n)}var o=N(p);null!=o?i(r,o):i(r,null)}},E=function(e){var t=O(e),i=n(t);if(null==i)return null;var a=o(e),r={authenticationResponse:i,extractionResponse:a};return r},D=function(e,t,i){p=e;var a=c(e,i);if(a&&"undefined"!=typeof p.serverParameters.sessionId&&null!=p.serverParameters.sessionId){m=p.serverParameters.sessionId;var r=R(p);F(r,function(e){M(e,t)},function(e){i(e)})}},R=function(e){delete e.serverParameters.sessionId;var t=l(),i=t.jobWithDocsInitialization,a=i.Documents;U(e.images,a[0].PageDataList),t.sessionId=m,t.processIdentity.Name=e.serverParameters.processIdentityName,e.serverParameters.ktaDeleteDocument&&"YES"===e.serverParameters.ktaDeleteDocument?t.jobWithDocsInitialization.Documents[0].DeleteDocument=!0:t.jobWithDocsInitialization.Documents[0].DeleteDocument=!1,j(e);for(var r=i.InputVariables,n=Object.keys(e.serverParameters),o=0;o<n.length;o++){var s={Value:e.serverParameters[n[o]],Id:n[o]};r.push(s)}var u={url:e.url+S,serverParameters:t};return u},M=function(e,t){var i=N(p);t(e,i)},L=function(t,i,a){var r=h(t);if(null===r||"undefined"==typeof r){var n=new Error("Document id is not defined.");return void e.report(a,n)}if(!k(t,a,!0)){var o=u(t),s=N(p);return void(null!=s?i(o,s):i(o))}},O=function(e){var t=e.d;return null===t||"undefined"===t?null:t.ReturnedDocumentFields[0].ReturnedDocumentFields},k=function(t,i,a){var r=O(t);if(null==r)return!0;for(var n=0;n<r.length;n++)if(r[n].Name==w&&a||r[n].Name==b){var o=r[n].Value;if(null!=o){var s;if("string"==typeof o){if(0===o.length)return!1;s=JSON.parse(o)}else s=o;var l=new Error(a?s.errordescription:s.ErrorMessage);return e.report(i,l),!0}return!1}return!1},j=function(e){delete e.serverParameters.processIdentityName,delete e.serverParameters.username,delete e.serverParameters.password,delete e.serverParameters.documentGroupName,delete e.serverParameters.documentName,delete e.serverParameters.ktaDeleteDocument},U=function(e,t){for(var i=0;i<e.length;i++){var a={Data:null,Base64Data:e[i],RuntimeFields:{},MimeType:"image/jpeg"};t.push(a)}},F=function(t,i,a){v&&(v=null),v=new XMLHttpRequest;var r,n=t.serverParameters;v.addEventListener("load",function(t){if(null==v||4!=v.readyState||200!=v.status){if(v.responseText.length>0){var n=new Error(v.responseText);return void e.report(a,n)}var n=new Error("The KTA server may be offline or does not exist.");return void e.report(a,n)}try{r=JSON.parse(this.response)}catch(o){r=null}if(null==r){var n=new Error("We didn't receive a valid server response.");return void e.report(a,n)}if(r.exceptionMessage||r.Message&&r.Message.length>0){var n=new Error(r.Message);return void e.report(a,n)}"function"==typeof i&&i(r)}),v.addEventListener("error",function(t){if(0==v.status){var i=new Error("The KTA server may be offline or does not exist.");return void e.report(a,i)}if(null==t.Message||"undefined"==t.Message){var i=new Error("The KTA server may be offline or does not exist.");return void e.report(a,i)}var i=new Error(t.Message);return void e.report(a,i)}),v.open("POST",t.url,!0),v.setRequestHeader("Accept","application/json"),v.setRequestHeader("Content-Type","application/json;charset=utf-8"),v.timeout=6e4,v.ontimeout=function(){var t=new Error("Session Timeout occurred.");e.report(a,t)},v.send(JSON.stringify(n))},N=function(e){var t=null;if(p.timingInfo){t={StartTime:new Date,Duration:null,FinishTime:null,message:""},t.FinishTime=new Date,t.Duration=(t.FinishTime-t.StartTime)/1e3;var i="Time: "+t.Duration+" seconds.";t.message=i}return t},G=function(){v&&null!=v&&(v.abort(),v=null)};return{extractWithRttiServer:P,performExtractionWithRttiServer:_,loginToKTAServer:T,authenticateIDWithKtaServer:C,extractWithKtaServer:I,executeRequestOnKtaServer:D,cancelExtraction:G}}(),function(){"use strict";function t(e,t,i){if(this.screenWidth=e,this.screenHeight=t,this.screenSquare=this.screenWidth*this.screenHeight,this.padding=i.framePadding,this.aspectRatio=i.frameAspectRatio,this.color=i.frameCornerColor,this.transparency=i.outOfFrameTransparency,this.cornerWidth=i.frameCornerWidth,this.cornerHeight=i.frameCornerHeight,0===this.aspectRatio)this.x=this.padding*this.screenWidth/100,this.y=this.padding*this.screenHeight/100,this.width=this.screenWidth-2*this.x,this.height=this.screenHeight-2*this.y;else{var a=this.padding*this.screenWidth/100,r=this.padding*this.screenHeight/100,n=(this.screenWidth-this.aspectRatio*this.screenHeight)/2,o=a,s=(o-n)/this.aspectRatio,l=this.screenWidth-2*o,u=this.screenHeight-2*s,c=o>=0&&s>=r&&l>0&&u>0,f=l*u,h=r,d=n+h*this.aspectRatio,p=this.screenWidth-2*d,m=this.screenHeight-2*h,g=d>=a&&h>=0&&p>0&&m>0,v=p*m;if(c&&g)this.x=f>v?o:d,this.y=f>v?s:h,this.width=f>v?l:p,this.height=f>v?u:m;else if(c&&!g)this.x=o,this.y=s,this.width=l,this.height=u;else{if(c||!g)throw Error("Aspect ratio "+this.aspectRatio+" and padding "+this.padding+" are incorrect");this.x=d,this.y=h,this.width=p,this.height=m}}this.x=Math.round(this.x),this.y=Math.round(this.y),this.width=Math.round(this.width),this.height=Math.round(this.height),this.mx=this.x+this.width/2,this.my=this.y+this.height/2,this.square=this.width*this.height;var y=this.x,S=this.y,w=y+this.width,b=S+this.height,P=this.screenWidth,_=this.screenHeight,T=this.cornerWidth,I=this.cornerHeight,C=y-I,A=S-I,x=T-I,E=w-x,D=b-x;this.boostParamsForOutOfFrameRender=[[0,0,y,_],[y,0,P,S],[P-y,S,y,_],[y,_-S,P-2*y,S]],this.boostParamsForFrameCornersRender=[[C,A,T,I],[C,A,I,T],[E,A,T,I],[w,A,I,T],[C,D,I,T],[C,b,T,I],[E,b,T,I],[w,D,I,T]]}function i(e,t){for(var i=0;i<t.length;i++)e.fillRect.apply(e,t[i])}t.prototype.getTargetFrameCropData=function(t,i){var a,r,n=Math.sqrt(t*i/this.screenSquare),o=e.GeneralSettings.getSettingsForRealTimeEdgeDetection().targetFrameCropEvrsPadding,s=Math.floor(n*this.x-o),l=Math.floor(n*this.y-o);if(s<0||l<0)s=0,l=0,a=t,r=i;else{var u=2*o;a=Math.ceil(n*this.width+u),r=Math.ceil(n*this.height+u)}return[s,l,a,r]},t.prototype.draw=function(t,a){t.beginPath(),t.fillStyle="#000000",t.globalAlpha=this.transparency,i(t,this.boostParamsForOutOfFrameRender),t.globalAlpha=1,a===e.Hints.HOLD_STEADY||a===e.Hints.CAPTURE_OK?(t.strokeStyle=this.color,t.lineWidth=this.cornerHeight,t.rect(this.x,this.y,this.width,this.height)):(t.fillStyle=this.color,i(t,this.boostParamsForFrameCornersRender)),t.closePath(),t.stroke()},e.Frame=t}(),e.Guidance=function(){"use strict";function t(t){(t.square<z||0===b&&t.ratio>H||b>0&&Math.abs(t.ratio-b)>W)&&l(e.Hints.FILL_AREA)}function i(t){for(var i,a,r,n=0;n<t.length;n++)if(i=t.get(n),a=i[0],r=i[1],a<G||a>B||r<G||r>V){l(e.Hints.FILL_AREA);break}}function a(t){(Math.abs(T-t.mx)>C||Math.abs(I-t.my)>A)&&l(e.Hints.CENTER)}function r(t){D/t.square<q.minFillFraction&&l(e.Hints.ZOOM_OUT)}function n(t){if(D/t.square>q.maxFillFraction)return void l(e.Hints.ZOOM_IN);var i=q.longAxisThreshold,a=q.shortAxisThreshold;if(0!==i||0!==a){var r=0!==i&&t["long"]>=x,n=0!==a&&t["short"]>=E;r||n||l(e.Hints.ZOOM_IN)}}function o(t){if(!t.isSquareShape&&90!==q.turnSkewAngleTolerance){var i=Math.abs(t.angle)%180;i=Math.min(i,180-i);var a=_>P?90-i:i;a>q.turnSkewAngleTolerance&&l(e.Hints.ROTATE)}}function s(){te&&(45!==q.pitchThreshold&&ee>q.pitchThreshold&&l(e.Hints.HOLD_LEVEL),45!==q.rollThreshold&&$>q.rollThreshold&&l(e.Hints.HOLD_LEVEL))}function l(t){if(void 0===J[t]?J[t]=1:J[t]++,U=!0,N<K)N++;else{var i,a=0;for(var r in J)J.hasOwnProperty(r)&&a<J[r]&&(a=J[r],i=r);i===e.Hints.HOLD_STEADY?void 0===F&&(F=setTimeout(function(){i=e.Hints.CAPTURE_OK,e.CaptureEventAppStats.logCaptureGuidanceEvents(i,"",1),j(i),u(),F=void 0},q.captureTimeout)):(clearTimeout(F),F=void 0),e.CaptureEventAppStats.logCaptureGuidanceEvents(i,"",1),j(i),u()}}function u(){J={},N=1}function c(t){e.Utils.validateOptions(t,Y)}function f(){return e.Utils.getOptions(q)}function h(){return e.Utils.getOptions(X)}function d(t){c(t),e.Utils.setOptions(q,t,X)}function p(){e.Utils.resetOptions(q,X)}function m(e){j=e,ie.addListener(ne)}function g(){j=void 0,ie.removeListener(ne)}function v(e,t){void 0!==t&&e.drawImage(Z[t],R,M,L,L)}function y(t){void 0===k&&(k={},k[e.Hints.FILL_AREA]="fit-document.png",k[e.Hints.ZOOM_IN]="zoom-in.png",k[e.Hints.ZOOM_OUT]="zoom-out.png",k[e.Hints.CENTER]="center.png",k[e.Hints.ROTATE]="rotate.png",k[e.Hints.HOLD_LEVEL]="hold-parallel.png",k[e.Hints.HOLD_STEADY]="hold-steady.png",k[e.Hints.CAPTURE_OK]="done.png");var i=0,a={},r=Object.keys(k).length;for(var n in k)if(k.hasOwnProperty(n)){var o=new Image;o.src=e.Utils.getImageUrl(k[n]);var s=function(n,o){return function(){var s=e.ImageUtils.createEmptyCanvas(L,L),l=s.getContext("2d"),u=L/2;l.beginPath(),l.globalAlpha=O,l.arc(u,u,u-2,0,2*Math.PI),l.fillStyle="#000000",l.fill(),l.globalAlpha=1,l.globalCompositeOperation="source-over",l.drawImage(o,0,0,L,L),l.closePath(),Z[n]=s,i++,o.removeEventListener("load",a[n]),delete a[n],i===r&&t()}}(n,o);a[n]=s,o.addEventListener("load",s)}}e.Hints={FILL_AREA:"0",ZOOM_IN:"1",ZOOM_OUT:"2",CENTER:"3",ROTATE:"4",HOLD_LEVEL:"5",HOLD_STEADY:"6",CAPTURE_OK:"7"};var S,w,b,P,_,T,I,C,A,x,E,D,R,M,L,O,k,j,U,F,N,G,B,V,H,W,z,K,q={minFillFraction:.65,maxFillFraction:1.8,longAxisThreshold:85,shortAxisThreshold:60,centerToleranceFraction:.19,captureTimeout:1700,turnSkewAngleTolerance:10,pitchThreshold:15,rollThreshold:15},X={minFillFraction:.65,maxFillFraction:1.8,longAxisThreshold:85,shortAxisThreshold:60,centerToleranceFraction:.19,captureTimeout:1700,turnSkewAngleTolerance:10,pitchThreshold:15,rollThreshold:15},Y={minFillFraction:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},maxFillFraction:{type:"number",min:{value:1,include:!1}},longAxisThreshold:{type:"number",min:{value:0,include:!0},max:{value:100,include:!0}},shortAxisThreshold:{type:"number",min:{value:0,include:!0},max:{value:100,include:!0}},centerToleranceFraction:{type:"number",min:{value:0,include:!1},max:{value:1,include:!1}},captureTimeout:{type:"number",min:{value:0,include:!1}},turnSkewAngleTolerance:{type:"number",min:{value:0,include:!0},max:{value:90,include:!0}},pitchThreshold:{type:"number",min:{value:0,include:!0},max:{value:45,include:!0}},rollThreshold:{type:"number",min:{value:0,include:!0},max:{value:45,include:!0}}},Z={},J={},Q=[t,i,s,o,r,a,n],$=0,ee=0,te=!1,ie=new e.LevelSensor,ae=function(t,i,a,r){S=t.screenWidth,w=t.screenHeight,P=t.width,_=t.height,T=t.mx,I=t.my,D=t.square;var n=L!==a.guidanceSize||O!==a.outOfFrameTransparency;L=a.guidanceSize,O=a.outOfFrameTransparency,R=(S-L)/2,M=(w-L)/2,u();var o=e.GeneralSettings.getSettingsForRealTimeEdgeDetection();return G=i*o.outOfScreenDownscaledPadding,B=S-G,V=w-G,C=P*q.centerToleranceFraction,A=_*q.centerToleranceFraction,x=Math.max(P,_)*q.longAxisThreshold/100,E=Math.min(P,_)*q.shortAxisThreshold/100,b=e.Math.getLongToShortAspectRatio(t.aspectRatio),H=o.maxRatioThreshold,W=o.maxRatioDeviationThreshold,z=D*o.minSquareThreshold,K=o.maxGuidanceThreshold,n?void y(r):void r()},re=function(t){U=!1;var i=new e.Rectangle(t);for(var a in Q)if(Q.hasOwnProperty(a)&&(Q[a](i),U))return;l(e.Hints.HOLD_STEADY)},ne=function(e){if(!te){if(!e)return;te=!0}ee=Math.abs(e.beta),$=Math.abs(e.gamma)};return{configure:ae,draw:v,processRectangle:re,processGuidance:l,clearGuidance:u,start:m,stop:g,getOptions:f,getDefaultOptions:h,setOptions:d,resetOptions:p}}(),e.ImageProcessor=function(){"use strict";function t(t,n){var o=a(t),s=t.width,l=t.height,u=s>>4,c=.85,f=t.data,h=i(s,l),d=h.data,p=new Uint32Array(d.buffer),m=0,g=0,v=0;for(g=0;g<l;g++,v+=s)for(m=0;m<s;m++){var y=f[v+m<<2],w=Math.max(m-u,0),b=Math.max(g-u,0),P=Math.min(m+u,s-1),_=Math.min(g+u,l-1),T=(P-w+1)*(_-b+1),I=r(o,s,w,b,P,_);y*T>I*c?p[v+m]=4294967295:p[v+m]=4278190080}"function"==typeof n&&(e.ProcessEventAppStats.logAppStats({ProcessingProfile:S.BITONAL}),n(h))}function i(e,t){var i=document.createElement("canvas");return i.getContext("2d").createImageData(e,t)}function a(e){var t=e.data,i=e.width,a=e.height,r=new Int32Array(i*a),n=0,o=0,s=0,l=0;for(n=0;n<i;n++)l+=t[n<<2],r[n]=l;for(o=1,s=i;o<a;o++,s+=i)for(l=0,n=0;n<i;n++)l+=t[s+n<<2],r[s+n]=r[s-i+n]+l;return r}function r(e,t,i,a,r,n){var o=e[r+n*t];return a>0&&(o-=e[r+(a-1)*t],i>0&&(o+=e[i-1+(a-1)*t])),i>0&&(o-=e[i-1+n*t]),o}var n,o=1024,s=1048576,l=function(t,i,a){e.Utils.verifyImageData("imageData",t);var r=t.width,n=t.height,o=new jsfeat.matrix_t(r,n,jsfeat.U8_t|jsfeat.C1_t),s=jsfeat.COLOR_RGBA2GRAY;jsfeat.imgproc.grayscale(t.data,r,n,o,s);for(var l=new Uint32Array(t.data.buffer),u=255<<24,c=o.cols*o.rows,f=0;--c>=0;)f=o.data[c],
l[c]=u|f<<16|f<<8|f;i(t)},u=function(t,i,a){e.Utils.verifyImageData("imageData",t),n=i,e.ProcessEventAppStats.logProcessStartTime(S.BITONAL),l(t,f,a)},c=function(t,i,a,r){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(S.SETDPI),e.Utils.validateOptions(i,{dpi:{mandatory:!0,type:"number",min:{value:0,include:!1}}});var n=t.width,o=t.height,s=document.createElement("canvas"),l=s.getContext("2d");s.width=n,s.height=o,l.putImageData(t,0,0);var u=s.toDataURL("image/jpeg"),c={};c[piexif.ImageIFD.XResolution]=[i.dpi,1],c[piexif.ImageIFD.YResolution]=[i.dpi,1];var f={"0th":c},h=piexif.dump(f),d=piexif.insert(h,u);return e.ProcessEventAppStats.logAppStats({ProcessingProfile:S.SETDPI}),a(d)},f=function(e){t(e,n)},h=function(t,i,a,r){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(S.AUTOCROP);for(var n=[],o=Object.keys(KfxWebSDK.document),s=0;s<o.length;s++)n.push(KfxWebSDK.document[o[s]]);e.Utils.validateOptions(i,{type:{type:"number",options:n,mandatory:!0}});var l=[KfxWebSDK.document.MOBILE_ID,KfxWebSDK.document.CHECK_DEPOSIT,KfxWebSDK.document.PASSPORT];if(l.indexOf(i.type)<0)return void a(t);var u=new e.CannyDetector(t,i.type),c=u.process();e.ProcessEventAppStats.logAppStats({ProcessingProfile:S.AUTOCROP}),a(c)},d=function(t,i,a,r){e.Utils.verifyImageData("imageData",t),e.ProcessEventAppStats.logProcessStartTime(S.SCALE),e.Utils.validateOptions(i,{scaleMegapixels:{mandatory:!0,type:"number",min:{value:0,include:!1}}});var n=1,l=i.scaleMegapixels,u=t.width,c=t.height,f=u,h=c;if(l){var d=f*h/s;n=d<=l?1:Math.sqrt(l/d)}if(1===n)return void a(t);f*=n,h*=n;for(var p=e.ImageUtils.createEmptyCanvas(f,h),m=p.getContext("2d"),g=o,v=e.ImageUtils.createEmptyCanvas(g,g),y=v.getContext("2d"),w=Math.ceil(g*f/u),b=Math.ceil(g*h/c),P=0,_=0,T=0,I=0;P<c;){for(T=0,I=0;T<u;)y.clearRect(0,0,g,g),y.putImageData(t,-T,-P),m.drawImage(v,0,0,g,g,I,_,w,b),T+=g,I+=w;P+=g,_+=b}var C=m.getImageData(0,0,f,h);e.ProcessEventAppStats.logAppStats({ProcessingProfile:S.SCALE}),a(C)};return{processImageToBitonal:u,autoCrop:h,scaleImage:d,changeDPIForImage:c}}();var P={APP_STATS_UNINITIALIZED:"APP_STATS_UNINITIALIZED",APP_STATS_INITIALIZING:"APP_STATS_INITIALIZING",APP_STATS_INITIALIZED:"APP_STATS_INITIALIZED",APP_STATS_RECORDING:"APP_STATS_RECORDING",APP_STATS_EXPORTING:"APP_STATS_EXPORTING",APP_STATS_BEGINNING_SESSION:"APP_STATS_BEGINNING_SESSION"},_={ERROR_STATS_ALLREADY_INIT:"App Stats Already Initialized",ERROR_STATS_NOT_INIT:"App Stats Not Initialized. Please initialize first",ERROR_STATS_ALLREADY_RECORDING:"App Stats Already started recording",ERROR_STATS_BEGIN_SESSION_NOT_ALLOWED:"App Stats begin session not allowed in this state",ERROR_STATS_STARTED_BEGIN_SESSION_NOT_ALLOWED:"App Stats Session Started , Please stop session first",ERROR_STATS_END_SESSION_NOT_ALLOWED:"App Stats end session not allowed in this state",ERROR_STATS_LOG_SESSION_NOT_ALLOWED:"App Stats log session not allowed in this state",ERROR_STATS_LOG_FIELDCHANGE_NOT_ALLOWED:"App Stats log field change event not allowed in this state",ERROR_STATS_EXPORT_NOT_ALLOWED:"App Stats export not allowed in this state",ERROR_STATS_NOT_ALLOWED:"App Stats not allowed in this state",ERROR_STATS_STOP_NOT_ALLOWED:"App Stats stop record not allowed in this state",ERROR_STATS_EMPTY_PARAMS:"Parameters should not be empty"},T={SESSION_LOGGED:"session logged",FIELD_CHANGE_LOGGED:"field change event logged"},I=P.APP_STATS_UNINITIALIZED,C=function(){return I};KfxWebSDK.AppStats=function(){"use strict";var a=!1,r=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),I!==P.APP_STATS_UNINITIALIZED){var a=new e.StateError(_.ERROR_STATS_ALLREADY_INIT);return void e.report(i,a)}I=P.APP_STATS_INITIALIZING,e.AppStats.initAppStats(t,i)},n=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),I===P.APP_STATS_UNINITIALIZED){var r=new e.StateError(_.ERROR_STATS_NOT_INIT);return void e.report(i,r)}if(I===P.APP_STATS_RECORDING||I===P.APP_STATS_BEGINNING_SESSION||I===P.APP_STATS_EXPORTING){var n=new e.StateError(_.ERROR_STATS_ALLREADY_RECORDING);return void e.report(i,n)}0==h.length&&h.push(e.AppStats.prepareEnvironment()),I=P.APP_STATS_RECORDING,a=!0,f=!0,"function"==typeof t&&t(I)},o=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),I!==P.APP_STATS_RECORDING){var r=new e.StateError(_.ERROR_STATS_STOP_NOT_ALLOWED+" "+C());return void e.report(i,r)}I=P.APP_STATS_INITIALIZED,a=!1,f=!1,"function"==typeof t&&t(I)},s=function(){return f},l=function(a,r,n){e.Utils.verifyCallbacks({successCallBack:r,errorCallBack:n});try{if(I===P.APP_STATS_UNINITIALIZED||I===P.APP_STATS_INITIALIZED||I===P.APP_STATS_EXPORTING||I===P.APP_STATS_BEGINNING_SESSION){var o=new e.StateError(_.ERROR_STATS_BEGIN_SESSION_NOT_ALLOWED+" "+C());return void e.report(n,o)}e.Utils.validateOptions(a,{sessionkey:{type:"string",mandatory:!0},category:{type:"string",mandatory:!0}}),t=a.sessionkey,i=a.category,I=P.APP_STATS_BEGINNING_SESSION,e.AppStats.logSessionEvent("BeginSession","",""),"function"==typeof r&&r(I)}catch(s){e.report(n,s)}},u=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a});try{if(I!==P.APP_STATS_BEGINNING_SESSION){var r=new e.StateError(_.ERROR_STATS_LOG_SESSION_NOT_ALLOWED+" "+C());return void e.report(a,r)}e.Utils.validateOptions(t,{sessionType:{type:"string",mandatory:!0},response:{type:"string",mandatory:!1}}),e.AppStats.logSessionEvent(t.sessionType,t.response,t.DocumentID),"function"==typeof i&&i(T.SESSION_LOGGED)}catch(n){e.report(a,n)}},c=function(a,r,n){e.Utils.verifyCallbacks({successCallBack:r,errorCallBack:n});try{if(I===P.APP_STATS_UNINITIALIZED||I===P.APP_STATS_INITIALIZED||I===P.APP_STATS_EXPORTING||I===P.APP_STATS_RECORDING){var o=new e.StateError(_.ERROR_STATS_END_SESSION_NOT_ALLOWED+" "+C());return void e.report(n,o)}e.Utils.validateOptions(a,{success:{type:"boolean",mandatory:!0},message:{type:"string",mandatory:!1}}),a.success?e.AppStats.logSessionEvent("SessionCompleteSuccess",a.message,a.DocumentID):e.AppStats.logSessionEvent("SessionCompleteError",a.message,""),t=null,i=null,I=P.APP_STATS_RECORDING,"function"==typeof r&&r(I)}catch(s){e.report(n,s)}},d=function(t,i){if(e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i}),I===P.APP_STATS_UNINITIALIZED||I===P.APP_STATS_RECORDING||I===P.APP_STATS_EXPORTING||I===P.APP_STATS_BEGINNING_SESSION){var a=new e.StateError(_.ERROR_STATS_EXPORT_NOT_ALLOWED+" "+C());return void e.report(i,a)}I=P.APP_STATS_EXPORTING,e.AppStats.exportAppStats(function(e){I=P.APP_STATS_INITIALIZED,t(e)},i)},p=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a});try{if(I!==P.APP_STATS_RECORDING&&I!==P.APP_STATS_BEGINNING_SESSION){var r=new e.StateError(_.ERROR_STATS_LOG_FIELDCHANGE_NOT_ALLOWED+" "+C());return void e.report(a,r)}e.LogisticsEventAppStats.logAppStats(t),"function"==typeof i&&i(T.FIELD_CHANGE_LOGGED)}catch(n){e.report(a,n)}};return{initAppStats:r,startRecord:n,stopRecord:o,isRecording:s,beginSession:l,endSession:c,logSessionEvent:u,logFieldChangeEvent:p,exportAppStats:d}}(),KfxWebSDK.Capture=function(){"use strict";var t=!1,i=function(i,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{e.Utils.validateOptions(i,{useVideoStream:{mandatory:!0,type:"boolean"}}),e.AppStats.prepareInstance(w.CAPTURE);var n=function(n){t=n,t?(e.Utils.validateOptions(i,{preference:{mandatory:!0,type:"string",options:["camera","gallery"]}}),e.CaptureEventAppStats.logAppStats(b.CAPTURE_FALLBACK,"",1),e.CaptureFallback.configure(i,a,r)):(e.Utils.validateOptions(i,{containerId:{mandatory:!0,type:"string",html:{tag:"div",hasChild:!1}},preview:{type:"boolean"}}),e.CaptureEventAppStats.logAppStats(b.ADVANCE_CAPTURE,"",1),e.WebCapture.configure(i,a,r))};KfxWebSDK.Utilities.supportsAutoCapture(function(){n(!i.useVideoStream)},function(){n(!0)})}catch(o){var s=function(){e.report(r,o)};h(s,s,!0)}},a=function(i,a,r){if(e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r}),!t)try{e.WebCapture.checkSetOptionsAllowed(),e.WebCapture.setOptions(i),void 0!==i.criteria&&e.Guidance.setOptions(i.criteria),a()}catch(n){e.report(r,n)}},r=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var a=e.WebCapture.getOptions(),r=e.Guidance.getOptions(),n=a;n.criteria=r,t(n)},n=function(t,i){e.Utils.verifyCallbacks({successCallBack:t,errorCallBack:i});var a=e.WebCapture.getDefaultOptions(),r=e.Guidance.getDefaultOptions(),n=a;n.criteria=r,t(n)},o=function(i,a){if(e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),!t)try{e.WebCapture.capture(i,a)}catch(r){e.report(a,r)}},s=function(i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a});try{t?e.CaptureFallback.choosePicture(i,a):e.WebCapture.start(i,a,!1)}catch(r){e.report(a,r)}},l=function(i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a});try{t&&e.CaptureFallback.choosePictureAsBase64(i,a)}catch(r){e.report(a,r)}},u=function(i,a){if(e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),!t)try{e.WebCapture.start(i,a,!0)}catch(r){e.report(a,r)}},c=function(i,a){if(e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),!t)try{e.WebCapture.stop(i,a)}catch(r){e.report(a,r)}},f=function(e,t){h(e,t,!1)},h=function(i,a,r){try{t?e.CaptureFallback.destroy():e.WebCapture.destroy(r),i()}catch(n){e.report(a,n)}};return{create:i,setOptions:a,getOptions:r,getDefaultOptions:n,takePicture:s,takePictureContinually:u,forceTakePicture:o,choosePictureAsBase64:l,stopCapture:c,destroy:f}}(),KfxWebSDK.DocumentExtractor=function(){"use strict";var t=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.extractWithRttiServer(t,i,a)},i=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.performExtractionWithRttiServer(t,i,a)},a=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.loginToKTAServer(t,i,a)},r=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.authenticateIDWithKtaServer(t,i,a)},n=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.extractWithKtaServer(t,i,a)},o=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a}),e.Extraction.executeRequestOnKtaServer(t,i,a)},s=function(){e.Extraction.cancelExtraction()};return{extractionWithRttiServer:t,performExtractionWithRttiServer:i,loginToKTAServer:a,extractionWithKtaServer:n,authenticateIDWithKtaServer:r,executeRequestOnKtaServer:o,cancelExtraction:s}}(),KfxWebSDK.ImageProcessor=function(){"use strict";var t=function(t,i,a){e.Utils.verifyCallbacks({successCallBack:i,errorCallBack:a});try{e.ImageProcessor.processImageToBitonal(t,i,a)}catch(r){e.report(a,r)}},i=function(t,i,a,r){if(e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r}),e.Utils.isClassInstance(t,"HTMLImageElement"))return void e.report(r,new e.ValidationError("HTMLImageElement is deprecated, use ImageData instead"));try{e.ImageProcessor.scaleImage(t,i,a,r)}catch(n){e.report(r,n)}},a=function(t,i,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{e.ImageProcessor.autoCrop(t,i,a,r)}catch(n){e.report(r,n)}},r=function(t,i,a,r){e.Utils.verifyCallbacks({successCallBack:a,errorCallBack:r});try{e.ImageProcessor.changeDPIForImage(t,i,a,r)}catch(n){e.report(r,n)}};return{bitonal:t,autoCrop:a,scale:i,setDPI:r}}(),function(){"use strict";function t(t){e.Utils.validateOptions({containerId:t},{containerId:{type:"string",html:{tag:"div"}}}),this.containerId=t,this.container=document.getElementById(this.containerId),this.isActive=!1;var i=e.Utils.createElement,r=i("div","kfx-layout kfx-review"),n=i("div","kfx-content"),o=i("canvas","kfx-image"),s=new a;n.appendChild(o),r.appendChild(n),r.appendChild(s.element),this.element=r,this.canvas=o,this.toolbarView=s}function i(t,i){for(var a=e.Utils.toggleElement,r=0;r<t.children.length;r++)a(t.children[r],i)}function a(){function t(e){var t=i("button","kfx-button "+e),a=i("div","kfx-text");return t.appendChild(a),t}var i=e.Utils.createElement,a=i("div","kfx-toolbar"),r=t("kfx-accept");a.appendChild(r);var n=t("kfx-retake");a.appendChild(n),this.element=a,this.acceptButton=r,this.retakeButton=n}t.prototype.review=function(t,a,r){e.Utils.verifyArgument("imageData",t,"ImageData"),e.Utils.verifyCallbacks({acceptCallBack:a,retakeCallBack:r}),i(this.container,!1);var n=this.canvas;n.width=t.width,n.height=t.height;var o=n.getContext("2d");o.putImageData(t,0,0);var s=this.element;this.container.appendChild(s);var l=this.toolbarView,u=function(){l.acceptButton.removeEventListener("click",h),l.retakeButton.removeEventListener("click",d)},c=this,f=function(){o.clearRect(0,0,n.width,n.height);var e=document.getElementById(this.containerId);e&&(e.removeChild(s),i(e,!0)),c.isActive=!1},h=function(){u.call(c);try{a()}finally{f.call(c)}},d=function(){u.call(c);try{r()}finally{f.call(c)}};l.acceptButton.addEventListener("click",h),l.retakeButton.addEventListener("click",d),c.isActive=!0},a.prototype.disable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!0)},a.prototype.enable=function(){e.Utils.toggleClass(this.element,"kfx-invisible",!1)},KfxWebSDK.ReviewControl=t}(),KfxWebSDK.Utilities=function(){"use strict";function t(){if(void 0!==o)return o;if(!i())return!1;if(!a())return!1;var e,t,r=n,s=window.navigator.userAgent;s=s.substring(0,s.indexOf(" AppleWebKit"));for(var l in r)if(r.hasOwnProperty(l)){e=r[l];for(var u in e)if(e.hasOwnProperty(u)){t=e[u];for(var c=0;c<t.length;c++)if(s.indexOf(t[c])>=0)return!1}}return!0}function i(){return window.location.protocol.indexOf("https")>=0}function a(){var t=window.navigator,i=t.getUserMedia||t.mozGetUserMedia||t.webkitGetUserMedia||t.msGetUserMedia;return e.Type.isFunction(i)}function r(i,a){var r=e.Utils.isIOSDevice();if(r===!0)return s=!1,void a();if(null!==s)return void(s?i:a)();if(!t())return s=!1,void a();var n=new e.UserMediaManager(document.createElement("video")),o=function(){n.destroy(),n=null,s=!0,i()},l=function(){n.destroy(),n=null,s=!1,a()};n.configure(o,l)}var n={Samsung:{"Galaxy S2":["GT-I9100","SPH-D710","SC-02C","SC-03D","Galaxy S2"],"Galaxy S3":["GT-I9300","GT-I9305","SC-06D","SC-03E","Galaxy S3"],"Galaxy Note 3":["SM-N900","GT-N9000","SCL22","SC-01F","SM-W900W8"],"Galaxy S4":["GT-I9505","GT-I9500","GT-I9515","GT-I9506","GT-I9502","SCH-I545","SPH-L720","SGH-M919","SGH-I337","SHV-E300","SC-04E","GT-I9192","SGH-i337","Galaxy S4"],"Galaxy S4 Mini":["GT-I9195","GT-I9190"],"Galaxy Note 4":["SM-N910C","SM-N910P","SM-N910G","SM-N910V"],"Galaxy S5":["SM-G900","Galaxy S5"],"Galaxy S6":["SM-G925F","SM-G928X","SM-G920V","Galaxy S6"],"Galaxy S7":["SM-G935F","SM-G930V","SM-G930F","Galaxy S7"],"Galaxy Tab S":["SM-T800","SM-T700","SM-T805","SM-T705","SCT21"]},LG:{G2:["LG-D802","VS980 4G","LG-D800","LG-D801","LG-LS980"],G4:["LG-H815","LG-H540","LG-H818"]},HTC:{"One M8":["HTC_0P6B","HTC6525LVW","HTC_PN071","HTC_P4550","HTC One M8"],"One M9":["HTC One M9"]},Motorola:{"Moto X 2nd Gen":["XT1092","XT1093","XT1094","XT1095","XT1096","XT1097"],"Moto G":["XT1033","XT1032","XT1034","XT1028","XT1068","XT1031","XT1039"]},Nexus:{"Nexus 4":["Nexus 4"],"Nexus 9":["Nexus 9"]},Asus:{"Asus ZenFone 2(E)":["ASUS ZenFone 2"],"Asus ZenFone Zoom":["ASUS_Z00XS"]},Sony:{"Xperia Tablet Z":["SGP311","SGP312","SGP321","SGP511","SO-03E"],"Xperia Z1":["C6916","C6903","SO-02F","Xperia Z1","SOL23"]},Microsoft:{"Surface Pro4":["Windows NT"]}},o=t(),s=null;return{supportsAutoCapture:r}}()}();
//# sourceMappingURL=KfxWebSDK.js.map
